import{n as T,m as E,o as I,p as M,q as H,r as Q,v as W,t as G,w as X,x as Y,g as Z,y as ee,z as ae,h as te,A as le,i as ne,B as oe}from"./vendor-4e66f90e.js";import{d as x,a as c,l as R,m as U,M as a,Q as e,q as r,U as _,O as B,ai as N,aj as q,R as se,ak as re,V as P,u as O,f as de}from"./@vue-8492d132.js";import{_ as F}from"./index-7c3b7b71.js";const ce=async n=>{try{await navigator.clipboard.writeText(n),T.success("Page URL copied to clipboard")}catch(v){console.error("Failed to copy: ",v)}},A=n=>(N("data-v-483e5b80"),n=n(),q(),n),ie={class:"card-header"},ue={class:"card-header__title"},pe=A(()=>r("h3",null,"用户1操作区",-1)),fe=A(()=>r("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),_e=A(()=>r("div",{class:"card-header"},[r("div",{class:"card-header__title"},[r("h3",null,"用户2操作区")]),r("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),me=A(()=>r("div",{class:"card-header"},[r("div",{class:"card-header__title"},[r("h3",null,"用户1操作区")]),r("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),ve=x({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(n,{emit:v}){const f=c(""),o=c(""),l=s=>{ce(s)};return(s,t)=>{const m=E,b=I,w=M;return R(),U(B,null,[a(w,{shadow:"always"},{header:e(()=>[r("div",ie,[r("div",ue,[pe,a(m,{type:"primary",onClick:t[0]||(t[0]=p=>v("createOffer"))},{default:e(()=>[_("create offer")]),_:1})]),fe])]),default:e(()=>[a(b,{value:s.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:e(()=>[a(m,{onClick:t[1]||(t[1]=p=>l(s.localOffer)),disabled:!s.localOffer},{default:e(()=>[_("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(w,{shadow:"always",class:"margin-top-10"},{header:e(()=>[_e]),default:e(()=>[a(b,{placeholder:"请粘贴用户1 SDP offer",modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=p=>f.value=p),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{disabled:!f.value,onClick:t[2]||(t[2]=p=>v("createAnswer",f.value))},{default:e(()=>[_("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(b,{placeholder:"SDP answer",value:s.remoteAnswer,disabled:"",class:"margin-top-10"},{append:e(()=>[a(m,{onClick:t[4]||(t[4]=p=>l(s.remoteAnswer)),disabled:!s.remoteAnswer},{default:e(()=>[_("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(w,{shadow:"always",class:"margin-top-10"},{header:e(()=>[me]),default:e(()=>[a(b,{placeholder:"请粘贴用户2 SDP answer",modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=p=>o.value=p),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{onClick:t[5]||(t[5]=p=>v("addAnswer",o.value)),disabled:!o.value},{default:e(()=>[_("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const be=F(ve,[["__scopeId","data-v-483e5b80"]]),we=r("label",{class:"operation-label"},"指令：",-1),ye=x({__name:"console-form",props:{localStream:{type:MediaStream,required:!0},dataChannel:{type:RTCDataChannel,required:!0},peerConnection:{type:RTCPeerConnection,required:!0},btnDiabled:{type:Boolean,required:!0}},setup(n,{expose:v}){const f=n,o=c(""),l=c(""),s=c(!1),t=c(!0),m=h=>{l.value+=`${h}
`},b=()=>{f.dataChannel.send(o.value),m(`发送指令：${o.value}`),o.value=""},w=()=>{f.peerConnection.close()},p=()=>{s.value=!s.value,f.localStream.getAudioTracks().forEach(h=>{h.enabled=s.value})},V=()=>{t.value=!t.value,f.localStream.getVideoTracks().forEach(h=>{h.enabled=t.value})};return v({writeInfo:m}),(h,C)=>{const k=I,d=E,u=X,g=M;return R(),se(g,{class:"box-card"},{default:e(()=>[we,a(k,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=i=>o.value=i),style:{width:"200px","margin-right":"20px"},placeholder:"要发送的指令",clearable:"",disabled:n.btnDiabled,onKeyup:re(b,["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(d,{type:"primary",onClick:b,disabled:n.btnDiabled},{default:e(()=>[_("发送指令")]),_:1},8,["disabled"]),a(d,{type:s.value?"warning":"primary",onClick:p,disabled:n.btnDiabled,icon:s.value?O(H):O(Q)},{default:e(()=>[_(P(s.value?"关闭":"打开")+"麦克风 ",1)]),_:1},8,["type","disabled","icon"]),a(d,{type:t.value?"warning":"primary",onClick:V,disabled:n.btnDiabled,icon:t.value?O(W):O(G)},{default:e(()=>[_(P(t.value?"关闭":"打开")+"视频",1)]),_:1},8,["type","disabled","icon"]),a(d,{type:"danger",onClick:w,disabled:n.btnDiabled},{default:e(()=>[_("关闭通信")]),_:1},8,["disabled"]),a(u,{placement:"bottom",title:"指令面板",width:500,trigger:"click"},{reference:e(()=>[a(d,{disabled:n.btnDiabled},{default:e(()=>[_("打开对话框")]),_:1},8,["disabled"])]),default:e(()=>[a(k,{modelValue:l.value,"onUpdate:modelValue":C[1]||(C[1]=i=>l.value=i),readonly:"",placeholder:"Please input",rows:6,"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})}}}),J=n=>(N("data-v-1ae068b3"),n=n(),q(),n),he=J(()=>r("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),ge=J(()=>r("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),Ce=x({__name:"index",setup(n){const v=c(),f=c(),o=c(new MediaStream),l=c(new RTCPeerConnection({iceServers:[{urls:"stun:1.119.169.85:10042"}]})),s=c(l.value.createDataChannel("message")),t=c(),m=c(""),b=c(""),w=c(!1),p=c(!0),V=async()=>{const d=v.value,u=f.value;o.value=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),d.srcObject=o.value,o.value.getTracks().forEach(i=>{l.value.addTrack(i,o.value)}),o.value.getAudioTracks().forEach(i=>{i.enabled=!1}),l.value.ondatachannel=function(i){T.success("建立连接"),p.value=!1;const y=i.channel;y.onopen=function(){y.send("建立连接!")},y.onmessage=D=>{var S;console.log(D.data),(S=t.value)==null||S.writeInfo(`接收到的指令：${D.data}`)}};const g=new MediaStream;l.value.ontrack=i=>{i.streams[0].getTracks().forEach(y=>{g.addTrack(y)}),u.srcObject=g}},h=async()=>{const d=await l.value.createOffer();await l.value.setLocalDescription(d),l.value.onicecandidate=async u=>{u.candidate&&(m.value=JSON.stringify(l.value.localDescription))}},C=async d=>{if(!d)return;const u=JSON.parse(d);l.value.onicecandidate=async i=>{if(i.candidate){const y=JSON.stringify(l.value.localDescription);b.value=y}},await l.value.setRemoteDescription(u);const g=await l.value.createAnswer();await l.value.setLocalDescription(g)},k=async d=>{if(!d)return;const u=JSON.parse(d);l.value.currentRemoteDescription||l.value.setRemoteDescription(u)};return de(()=>{V()}),(d,u)=>{const g=Y,i=E,y=Z,D=ee,S=ae,L=te,j=le,K=ne,z=oe;return R(),U(B,null,[a(K,{class:"p2p-main"},{default:e(()=>[a(y,{class:"p2p-header"},{default:e(()=>[a(g,{type:"warning",size:"large"},{default:e(()=>[_("Webrtc-P2P通话")]),_:1}),a(i,{onClick:u[0]||(u[0]=$=>w.value=!0),type:"primary"},{default:e(()=>[_("打开操作面板")]),_:1})]),_:1}),a(L,null,{default:e(()=>[a(S,null,{default:e(()=>[a(D,{span:12,class:"p2p-video"},{default:e(()=>[he,r("video",{class:"p2p-video__dom",ref_key:"localRef",ref:v,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),a(D,{span:12,class:"p2p-video"},{default:e(()=>[ge,r("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:f,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),a(j,null,{default:e(()=>[a(ye,{localStream:o.value,peerConnection:l.value,dataChannel:s.value,btnDiabled:p.value,ref_key:"consoleRef",ref:t},null,8,["localStream","peerConnection","dataChannel","btnDiabled"])]),_:1})]),_:1}),a(z,{modelValue:w.value,"onUpdate:modelValue":u[1]||(u[1]=$=>w.value=$),title:"本地操作区域-打开2个tab页"},{default:e(()=>[a(be,{localOffer:m.value,remoteAnswer:b.value,onCreateOffer:h,onCreateAnswer:C,onAddAnswer:k},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const Oe=F(Ce,[["__scopeId","data-v-1ae068b3"]]);export{Oe as default};

import{H as $,d as g,a as m,o as A,e as x,f as t,w as a,z as o,j as w,F,y as B,I as J,J as M,D as C,G as D,b as T,c as U,p as L,K as j,L as H,M as q,N as z,q as G,O as K,s as W}from"./vendor-e3c25a1d.js";import{_ as S}from"./index-cb004c85.js";const Q=async s=>{try{await navigator.clipboard.writeText(s),$.success("Page URL copied to clipboard")}catch(i){console.error("Failed to copy: ",i)}},O=s=>(C("data-v-f5fdf386"),s=s(),D(),s),X={class:"card-header"},Y={class:"card-header__title"},Z=O(()=>o("h3",null,"用户1操作区",-1)),ee=O(()=>o("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),ae=O(()=>o("div",{class:"card-header"},[o("div",{class:"card-header__title"},[o("h3",null,"用户2操作区")]),o("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),te=O(()=>o("div",{class:"card-header"},[o("div",{class:"card-header__title"},[o("h3",null,"用户1操作区")]),o("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),oe=g({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(s,{emit:i}){const p=m(""),f=m(""),y=l=>{Q(l)};return(l,e)=>{const _=B,v=J,h=M;return A(),x(F,null,[t(h,{shadow:"always"},{header:a(()=>[o("div",X,[o("div",Y,[Z,t(_,{type:"primary",onClick:e[0]||(e[0]=n=>i("createOffer"))},{default:a(()=>[w("create offer")]),_:1})]),ee])]),default:a(()=>[t(v,{value:l.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:a(()=>[t(_,{onClick:e[1]||(e[1]=n=>y(l.localOffer)),disabled:!l.localOffer},{default:a(()=>[w("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(h,{shadow:"always",class:"margin-top-10"},{header:a(()=>[ae]),default:a(()=>[t(v,{placeholder:"请粘贴用户1 SDP offer",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=n=>p.value=n),clearable:"",class:"input-with-select"},{append:a(()=>[t(_,{disabled:!p.value,onClick:e[2]||(e[2]=n=>i("createAnswer",p.value))},{default:a(()=>[w("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),t(v,{placeholder:"SDP answer",value:l.remoteAnswer,disabled:"",class:"margin-top-10"},{append:a(()=>[t(_,{onClick:e[4]||(e[4]=n=>y(l.remoteAnswer)),disabled:!l.remoteAnswer},{default:a(()=>[w("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(h,{shadow:"always",class:"margin-top-10"},{header:a(()=>[te]),default:a(()=>[t(v,{placeholder:"请粘贴用户1 SDP offer",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=n=>f.value=n),clearable:"",class:"input-with-select"},{append:a(()=>[t(_,{onClick:e[5]||(e[5]=n=>i("addAnswer",f.value)),disabled:!f.value},{default:a(()=>[w("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const se=S(oe,[["__scopeId","data-v-f5fdf386"]]),E=s=>(C("data-v-3e2600ac"),s=s(),D(),s),le=E(()=>o("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),ne=E(()=>o("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),re=g({__name:"index",setup(s){const i=m(),p=m(),f=m(""),y=m(""),l=m(""),e=new RTCPeerConnection,_=async()=>{const r=i.value,c=p.value,u=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});r.srcObject=u,u.getTracks().forEach(d=>{e.addTrack(d,u)}),e.ontrack=d=>{c.srcObject=d.streams[0]}},v=async()=>{const r=await e.createOffer();await e.setLocalDescription(r),e.onicecandidate=async c=>{c.candidate&&(y.value=JSON.stringify(e.localDescription))}},h=async r=>{if(!r)return;const c=JSON.parse(r);e.onicecandidate=async d=>{if(d.candidate){const b=JSON.stringify(e.localDescription);l.value=b}},await e.setRemoteDescription(c);const u=await e.createAnswer();await e.setLocalDescription(u)},n=async r=>{if(!r)return;const c=JSON.parse(r);e.currentRemoteDescription||e.setRemoteDescription(c)};return T(()=>{_()}),(r,c)=>{const u=L,d=j,b=H,V=q,k=z,P=G,R=K,I=W;return A(),U(I,null,{default:a(()=>[t(u,{class:"p2p-header"},{default:a(()=>[w("Webrtc-P2P通话")]),_:1}),t(P,null,{default:a(()=>[t(b,null,{default:a(()=>[t(d,{span:16},{default:a(()=>[t(b,null,{default:a(()=>[t(d,{span:12,class:"p2p-video"},{default:a(()=>[le,o("video",{class:"p2p-video__dom",ref_key:"localRef",ref:i,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),t(d,{span:12,class:"p2p-video"},{default:a(()=>[ne,o("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:p,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),t(d,{span:8},{default:a(()=>[t(k,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=N=>f.value=N)},{default:a(()=>[t(V,{title:"本地操作区域-打开2个tab页",name:"1"},{default:a(()=>[t(se,{localOffer:y.value,remoteAnswer:l.value,onCreateOffer:v,onCreateAnswer:h,onAddAnswer:n},null,8,["localOffer","remoteAnswer"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(R)]),_:1})}}});const ie=S(re,[["__scopeId","data-v-3e2600ac"]]);export{ie as default};

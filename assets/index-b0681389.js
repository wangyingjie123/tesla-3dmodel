import{n as P,m as E,o as I,p as U,q as H,r as Q,v as W,t as G,w as X,x as Y,g as Z,y as ee,z as ae,h as te,A as le,i as oe,B as ne}from"./vendor-4e66f90e.js";import{d as x,a as c,l as R,m as M,M as a,Q as e,q as d,U as _,O as B,ai as N,aj as q,R as se,ak as re,V as $,u as O,f as de,I as ce}from"./@vue-8492d132.js";import{_ as F}from"./index-e85eb244.js";const ie=async o=>{try{await navigator.clipboard.writeText(o),P.success("Page URL copied to clipboard")}catch(v){console.error("Failed to copy: ",v)}},A=o=>(N("data-v-483e5b80"),o=o(),q(),o),ue={class:"card-header"},pe={class:"card-header__title"},fe=A(()=>d("h3",null,"用户1操作区",-1)),_e=A(()=>d("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),me=A(()=>d("div",{class:"card-header"},[d("div",{class:"card-header__title"},[d("h3",null,"用户2操作区")]),d("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),ve=A(()=>d("div",{class:"card-header"},[d("div",{class:"card-header__title"},[d("h3",null,"用户1操作区")]),d("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),be=x({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(o,{emit:v}){const p=c(""),n=c(""),t=r=>{ie(r)};return(r,l)=>{const m=E,b=I,y=U;return R(),M(B,null,[a(y,{shadow:"always"},{header:e(()=>[d("div",ue,[d("div",pe,[fe,a(m,{type:"primary",onClick:l[0]||(l[0]=f=>v("createOffer"))},{default:e(()=>[_("create offer")]),_:1})]),_e])]),default:e(()=>[a(b,{value:r.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:e(()=>[a(m,{onClick:l[1]||(l[1]=f=>t(r.localOffer)),disabled:!r.localOffer},{default:e(()=>[_("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(y,{shadow:"always",class:"margin-top-10"},{header:e(()=>[me]),default:e(()=>[a(b,{placeholder:"请粘贴用户1 SDP offer",modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=f=>p.value=f),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{disabled:!p.value,onClick:l[2]||(l[2]=f=>v("createAnswer",p.value))},{default:e(()=>[_("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(b,{placeholder:"SDP answer",value:r.remoteAnswer,disabled:"",class:"margin-top-10"},{append:e(()=>[a(m,{onClick:l[4]||(l[4]=f=>t(r.remoteAnswer)),disabled:!r.remoteAnswer},{default:e(()=>[_("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(y,{shadow:"always",class:"margin-top-10"},{header:e(()=>[ve]),default:e(()=>[a(b,{placeholder:"请粘贴用户2 SDP answer",modelValue:n.value,"onUpdate:modelValue":l[6]||(l[6]=f=>n.value=f),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{onClick:l[5]||(l[5]=f=>v("addAnswer",n.value)),disabled:!n.value},{default:e(()=>[_("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const we=F(be,[["__scopeId","data-v-483e5b80"]]),ye=d("label",{class:"operation-label"},"指令：",-1),he=x({__name:"console-form",props:{localStream:{type:MediaStream,required:!0},dataChannel:{type:RTCDataChannel,required:!0},peerConnection:{type:RTCPeerConnection,required:!0},btnDiabled:{type:Boolean,required:!0}},setup(o,{expose:v}){const p=o,n=c(""),t=c(""),r=c(!1),l=c(!0),m=w=>{t.value+=`${w}
`},b=()=>{p.dataChannel.send(n.value),m(`发送指令：${n.value}`),n.value=""},y=()=>{p.localStream.getTracks().forEach(w=>{w.stop()}),p.peerConnection.close()},f=()=>{r.value=!r.value,p.localStream.getAudioTracks().forEach(w=>{w.enabled=r.value})},V=()=>{l.value=!l.value,p.localStream.getVideoTracks().forEach(w=>{w.enabled=l.value})};return v({writeInfo:m}),(w,C)=>{const D=I,s=E,u=X,g=U;return R(),se(g,{class:"box-card"},{default:e(()=>[ye,a(D,{modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=i=>n.value=i),style:{width:"200px","margin-right":"20px"},placeholder:"要发送的指令",clearable:"",disabled:o.btnDiabled,onKeyup:re(b,["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(s,{type:"primary",onClick:b,disabled:o.btnDiabled},{default:e(()=>[_("发送指令")]),_:1},8,["disabled"]),a(s,{type:r.value?"warning":"primary",onClick:f,disabled:o.btnDiabled,icon:r.value?O(H):O(Q)},{default:e(()=>[_($(r.value?"关闭":"打开")+"麦克风 ",1)]),_:1},8,["type","disabled","icon"]),a(s,{type:l.value?"warning":"primary",onClick:V,disabled:o.btnDiabled,icon:l.value?O(W):O(G)},{default:e(()=>[_($(l.value?"关闭":"打开")+"视频",1)]),_:1},8,["type","disabled","icon"]),a(s,{type:"danger",onClick:y,disabled:o.btnDiabled},{default:e(()=>[_("关闭")]),_:1},8,["disabled"]),a(u,{placement:"bottom",title:"指令面板",width:500,trigger:"click"},{reference:e(()=>[a(s,{disabled:o.btnDiabled},{default:e(()=>[_("打开对话框")]),_:1},8,["disabled"])]),default:e(()=>[a(D,{modelValue:t.value,"onUpdate:modelValue":C[1]||(C[1]=i=>t.value=i),readonly:"",placeholder:"Please input",rows:6,"show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})}}}),J=o=>(N("data-v-d4ec3587"),o=o(),q(),o),ge=J(()=>d("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),Ce=J(()=>d("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),ke=x({__name:"index",setup(o){const v=c(),p=c(),n=c(new MediaStream),t=c(new RTCPeerConnection({iceServers:[{urls:"stun:172.16.40.202:3478"}]})),r=c(t.value.createDataChannel("message")),l=c(),m=c(""),b=c(""),y=c(!1),f=c(!0),V=async()=>{const s=v.value,u=p.value;n.value=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}),s.srcObject=n.value,n.value.getTracks().forEach(i=>{t.value.addTrack(i,n.value)}),n.value.getAudioTracks().forEach(i=>{i.enabled=!1}),t.value.ondatachannel=i=>{P.success("建立连接"),f.value=!1;const h=i.channel;h.onopen=()=>{h.send("建立连接!")},h.onmessage=k=>{var S;console.log(k.data),(S=l.value)==null||S.writeInfo(`接收到的指令：${k.data}`)}};const g=new MediaStream;t.value.ontrack=i=>{i.streams[0].getTracks().forEach(h=>{g.addTrack(h)}),u.srcObject=g}},w=async()=>{const s=await t.value.createOffer();await t.value.setLocalDescription(s),t.value.onicecandidate=async u=>{u.candidate&&(m.value=JSON.stringify(t.value.localDescription))}},C=async s=>{if(!s)return;const u=JSON.parse(s);t.value.onicecandidate=async i=>{if(i.candidate){const h=JSON.stringify(t.value.localDescription);b.value=h}},await t.value.setRemoteDescription(u);const g=await t.value.createAnswer();await t.value.setLocalDescription(g)},D=async s=>{if(!s)return;const u=JSON.parse(s);t.value.currentRemoteDescription||t.value.setRemoteDescription(u)};return de(()=>{V()}),ce(()=>{n.value.getTracks().forEach(s=>{s.stop()}),t.value.close()}),(s,u)=>{const g=Y,i=E,h=Z,k=ee,S=ae,L=te,j=le,K=oe,z=ne;return R(),M(B,null,[a(K,{class:"p2p-main"},{default:e(()=>[a(h,{class:"p2p-header"},{default:e(()=>[a(g,{type:"warning",size:"large"},{default:e(()=>[_("Webrtc-P2P通话")]),_:1}),a(i,{onClick:u[0]||(u[0]=T=>y.value=!0),type:"primary"},{default:e(()=>[_("打开操作面板")]),_:1})]),_:1}),a(L,null,{default:e(()=>[a(S,null,{default:e(()=>[a(k,{span:12,class:"p2p-video"},{default:e(()=>[ge,d("video",{class:"p2p-video__dom",ref_key:"localRef",ref:v,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),a(k,{span:12,class:"p2p-video"},{default:e(()=>[Ce,d("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:p,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),a(j,null,{default:e(()=>[a(he,{localStream:n.value,peerConnection:t.value,dataChannel:r.value,btnDiabled:f.value,ref_key:"consoleRef",ref:l},null,8,["localStream","peerConnection","dataChannel","btnDiabled"])]),_:1})]),_:1}),a(z,{modelValue:y.value,"onUpdate:modelValue":u[1]||(u[1]=T=>y.value=T),title:"本地操作区域-打开2个tab页"},{default:e(()=>[a(we,{localOffer:m.value,remoteAnswer:b.value,onCreateOffer:w,onCreateAnswer:C,onAddAnswer:D},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const Ae=F(ke,[["__scopeId","data-v-d4ec3587"]]);export{Ae as default};

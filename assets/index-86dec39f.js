import{n as D,m as k,o as L,p as q,q as z,g as H,r as Q,t as W,h as G,v as K,i as X,w as Y}from"./vendor-fdf6ba46.js";import{d as A,a as c,l as E,m as V,M as a,Q as e,q as l,U as b,O as R,ai as $,aj as P,f as Z,I as ee}from"./@vue-8492d132.js";import{_ as T}from"./index-f32ca7fa.js";import{_ as ae}from"./console-form.vue_vue_type_script_setup_true_lang-e40e1a9b.js";const te=async d=>{try{await navigator.clipboard.writeText(d),D.success("Page URL copied to clipboard")}catch(_){console.error("Failed to copy: ",_)}},O=d=>($("data-v-483e5b80"),d=d(),P(),d),oe={class:"card-header"},le={class:"card-header__title"},ne=O(()=>l("h3",null,"用户1操作区",-1)),se=O(()=>l("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),re=O(()=>l("div",{class:"card-header"},[l("div",{class:"card-header__title"},[l("h3",null,"用户2操作区")]),l("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),ce=O(()=>l("div",{class:"card-header"},[l("div",{class:"card-header__title"},[l("h3",null,"用户1操作区")]),l("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),de=A({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(d,{emit:_}){const v=c(""),n=c(""),t=p=>{te(p)};return(p,o)=>{const m=k,w=L,h=q;return E(),V(R,null,[a(h,{shadow:"always"},{header:e(()=>[l("div",oe,[l("div",le,[ne,a(m,{type:"primary",onClick:o[0]||(o[0]=i=>_("createOffer"))},{default:e(()=>[b("create offer")]),_:1})]),se])]),default:e(()=>[a(w,{value:p.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:e(()=>[a(m,{onClick:o[1]||(o[1]=i=>t(p.localOffer)),disabled:!p.localOffer},{default:e(()=>[b("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(h,{shadow:"always",class:"margin-top-10"},{header:e(()=>[re]),default:e(()=>[a(w,{placeholder:"请粘贴用户1 SDP offer",modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=i=>v.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{disabled:!v.value,onClick:o[2]||(o[2]=i=>_("createAnswer",v.value))},{default:e(()=>[b("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(w,{placeholder:"SDP answer",value:p.remoteAnswer,disabled:"",class:"margin-top-10"},{append:e(()=>[a(m,{onClick:o[4]||(o[4]=i=>t(p.remoteAnswer)),disabled:!p.remoteAnswer},{default:e(()=>[b("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(h,{shadow:"always",class:"margin-top-10"},{header:e(()=>[ce]),default:e(()=>[a(w,{placeholder:"请粘贴用户2 SDP answer",modelValue:n.value,"onUpdate:modelValue":o[6]||(o[6]=i=>n.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{onClick:o[5]||(o[5]=i=>_("addAnswer",n.value)),disabled:!n.value},{default:e(()=>[b("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const ie=T(de,[["__scopeId","data-v-483e5b80"]]),I=d=>($("data-v-d4ec3587"),d=d(),P(),d),ue=I(()=>l("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),pe=I(()=>l("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),fe=A({__name:"index",setup(d){const _=c(),v=c(),n=c(new MediaStream),t=c(new RTCPeerConnection({iceServers:[{urls:"stun:172.16.40.202:3478"}]})),p=c(t.value.createDataChannel("message")),o=c(),m=c(""),w=c(""),h=c(!1),i=c(!0),x=async()=>{const s=_.value,r=v.value;n.value=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}),s.srcObject=n.value,n.value.getTracks().forEach(u=>{t.value.addTrack(u,n.value)}),n.value.getAudioTracks().forEach(u=>{u.enabled=!1}),t.value.ondatachannel=u=>{D.success("建立连接"),i.value=!1;const f=u.channel;f.onopen=()=>{f.send("建立连接!")},f.onmessage=g=>{var C;console.log(g.data),(C=o.value)==null||C.writeInfo(`接收到的指令：${g.data}`)}};const y=new MediaStream;t.value.ontrack=u=>{u.streams[0].getTracks().forEach(f=>{y.addTrack(f)}),r.srcObject=y}},M=async()=>{const s=await t.value.createOffer();await t.value.setLocalDescription(s),t.value.onicecandidate=async r=>{r.candidate&&(m.value=JSON.stringify(t.value.localDescription))}},N=async s=>{if(!s)return;const r=JSON.parse(s);t.value.onicecandidate=async u=>{if(u.candidate){const f=JSON.stringify(t.value.localDescription);w.value=f}},await t.value.setRemoteDescription(r);const y=await t.value.createAnswer();await t.value.setLocalDescription(y)},U=async s=>{if(!s)return;const r=JSON.parse(s);t.value.currentRemoteDescription||t.value.setRemoteDescription(r)};return Z(()=>{x()}),ee(()=>{n.value.getTracks().forEach(s=>{s.stop()}),t.value.close()}),(s,r)=>{const y=z,u=k,f=H,g=Q,C=W,F=G,B=K,J=X,j=Y;return E(),V(R,null,[a(J,{class:"p2p-main"},{default:e(()=>[a(f,{class:"p2p-header"},{default:e(()=>[a(y,{type:"warning",size:"large"},{default:e(()=>[b("Webrtc-P2P通话")]),_:1}),a(u,{onClick:r[0]||(r[0]=S=>h.value=!0),type:"primary"},{default:e(()=>[b("打开操作面板")]),_:1})]),_:1}),a(F,null,{default:e(()=>[a(C,null,{default:e(()=>[a(g,{span:12,class:"p2p-video"},{default:e(()=>[ue,l("video",{class:"p2p-video__dom",ref_key:"localRef",ref:_,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),a(g,{span:12,class:"p2p-video"},{default:e(()=>[pe,l("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:v,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),a(B,null,{default:e(()=>[a(ae,{localStream:n.value,peerConnection:t.value,dataChannel:p.value,btnDiabled:i.value,ref_key:"consoleRef",ref:o},null,8,["localStream","peerConnection","dataChannel","btnDiabled"])]),_:1})]),_:1}),a(j,{modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=S=>h.value=S),title:"本地操作区域-打开2个tab页"},{default:e(()=>[a(ie,{localOffer:m.value,remoteAnswer:w.value,onCreateOffer:M,onCreateAnswer:N,onAddAnswer:U},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const he=T(fe,[["__scopeId","data-v-d4ec3587"]]);export{he as default};

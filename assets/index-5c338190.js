import{n as F,m as C,o as M,p as B,q as J,g as j,r as L,t as q,h as z,v as H,i as Q,w as W}from"./vendor-8b414e32.js";import{d as S,a as m,l as D,m as E,M as t,Q as a,q as o,U as w,O as V,ai as k,aj as P,f as G}from"./@vue-8492d132.js";import{_ as R}from"./index-17f5d053.js";const K=async l=>{try{await navigator.clipboard.writeText(l),F.success("Page URL copied to clipboard")}catch(d){console.error("Failed to copy: ",d)}},h=l=>(k("data-v-4cf87fdb"),l=l(),P(),l),X={class:"card-header"},Y={class:"card-header__title"},Z=h(()=>o("h3",null,"用户1操作区",-1)),ee=h(()=>o("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),ae=h(()=>o("div",{class:"card-header"},[o("div",{class:"card-header__title"},[o("h3",null,"用户2操作区")]),o("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),te=h(()=>o("div",{class:"card-header"},[o("div",{class:"card-header__title"},[o("h3",null,"用户1操作区")]),o("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),oe=S({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(l,{emit:d}){const i=m(""),p=m(""),y=s=>{K(s)};return(s,e)=>{const _=C,v=M,b=B;return D(),E(V,null,[t(b,{shadow:"always"},{header:a(()=>[o("div",X,[o("div",Y,[Z,t(_,{type:"primary",onClick:e[0]||(e[0]=r=>d("createOffer"))},{default:a(()=>[w("create offer")]),_:1})]),ee])]),default:a(()=>[t(v,{value:s.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:a(()=>[t(_,{onClick:e[1]||(e[1]=r=>y(s.localOffer)),disabled:!s.localOffer},{default:a(()=>[w("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(b,{shadow:"always",class:"margin-top-10"},{header:a(()=>[ae]),default:a(()=>[t(v,{placeholder:"请粘贴用户1 SDP offer",modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=r=>i.value=r),clearable:"",class:"input-with-select"},{append:a(()=>[t(_,{disabled:!i.value,onClick:e[2]||(e[2]=r=>d("createAnswer",i.value))},{default:a(()=>[w("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),t(v,{placeholder:"SDP answer",value:s.remoteAnswer,disabled:"",class:"margin-top-10"},{append:a(()=>[t(_,{onClick:e[4]||(e[4]=r=>y(s.remoteAnswer)),disabled:!s.remoteAnswer},{default:a(()=>[w("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(b,{shadow:"always",class:"margin-top-10"},{header:a(()=>[te]),default:a(()=>[t(v,{placeholder:"请粘贴用户2 SDP answer",modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=r=>p.value=r),clearable:"",class:"input-with-select"},{append:a(()=>[t(_,{onClick:e[5]||(e[5]=r=>d("addAnswer",p.value)),disabled:!p.value},{default:a(()=>[w("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const se=R(oe,[["__scopeId","data-v-4cf87fdb"]]),$=l=>(k("data-v-c93cce7b"),l=l(),P(),l),ne=$(()=>o("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),le=$(()=>o("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),re=S({__name:"index",setup(l){const d=m(),i=m(),p=m(""),y=m(""),s=m(!1),e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.voipbuster.com"}]}),_=async()=>{const c=d.value,n=i.value,f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});c.srcObject=f,f.getTracks().forEach(u=>{e.addTrack(u,f)}),e.ontrack=u=>{n.srcObject=u.streams[0]}},v=async()=>{const c=await e.createOffer();await e.setLocalDescription(c),e.onicecandidate=async n=>{n.candidate&&(p.value=JSON.stringify(e.localDescription))}},b=async c=>{if(!c)return;const n=JSON.parse(c);e.onicecandidate=async u=>{if(u.candidate){const g=JSON.stringify(e.localDescription);y.value=g}},await e.setRemoteDescription(n);const f=await e.createAnswer();await e.setLocalDescription(f)},r=async c=>{if(!c)return;const n=JSON.parse(c);e.currentRemoteDescription||e.setRemoteDescription(n)};return G(()=>{_()}),(c,n)=>{const f=J,u=C,g=j,O=L,x=q,I=z,N=H,T=Q,U=W;return D(),E(V,null,[t(T,null,{default:a(()=>[t(g,{class:"p2p-header"},{default:a(()=>[t(f,{type:"warning",size:"large"},{default:a(()=>[w("Webrtc-P2P通话")]),_:1}),t(u,{onClick:n[0]||(n[0]=A=>s.value=!0),type:"primary"},{default:a(()=>[w("打开操作面板")]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(x,null,{default:a(()=>[t(O,{span:12,class:"p2p-video"},{default:a(()=>[ne,o("video",{class:"p2p-video__dom",ref_key:"localRef",ref:d,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),t(O,{span:12,class:"p2p-video"},{default:a(()=>[le,o("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:i,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),t(N)]),_:1}),t(U,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=A=>s.value=A),title:"本地操作区域-打开2个tab页"},{default:a(()=>[t(se,{localOffer:p.value,remoteAnswer:y.value,onCreateOffer:v,onCreateAnswer:b,onAddAnswer:r},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const pe=R(re,[["__scopeId","data-v-c93cce7b"]]);export{pe as default};

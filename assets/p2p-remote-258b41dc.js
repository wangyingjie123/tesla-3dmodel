import{n as _,x as T,q as N,r as R,o as B,m as M}from"./vendor-3df4b7f5.js";import{d as j,a as I,f as J,l as L,m as A,L as i,P as l,q as c,aa as K,T as g,U,ai as q,aj as P}from"./@vue-c739fbfa.js";import{_ as $}from"./index-9152b748.js";const f=v=>(q("data-v-2a0a62db"),v=v(),P(),v),z={class:"p2p-container"},F=f(()=>c("div",{class:"remote-video margin-top-10"},[c("video",{id:"remote-video",class:"remote-video__dom",autoplay:"",playsinline:""})],-1)),G=f(()=>c("div",{class:"video-title"},"远程视频",-1)),H=f(()=>c("div",{class:"local-video"},[c("video",{id:"local",class:"local-video__dom",autoplay:"",playsinline:""})],-1)),Q=f(()=>c("div",{class:"video-title"},"我",-1)),W={class:"operation"},X=f(()=>c("label",{class:"operation-label"},"房间号：",-1)),Y=j({__name:"p2p-remote",setup(v){const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.voipbuster.com"}]}),r=Math.random().toString(36).substring(2),a=I("");let o,d,y,p="";function h(){if(!a.value){_.error("请输入房间号");return}o=T("https://10.1.60.61:3333"),o.on("connect",()=>{S()}),o.on("disconnect",e=>{e==="io server disconnect"&&o.connect(),_.warning("您已断开连接")}),o.on("error",e=>{_.error(e)}),o.on("welcome",e=>{_.success(e.userId===r?"🦄成功加入房间":`🦄${e.userId}加入房间`)}),o.on("leave",e=>{_.warning(e.userId===r?"🦄成功离开房间":`🦄${e.userId}离开房间`)}),o.on("message",e=>{console.log(e)}),o.on("createOffer",()=>{if(p){o.emit("offer",{userId:r,roomId:a.value,sdp:p});return}b()}),o.on("offer",e=>{C(e.sdp)}),o.on("answer",e=>{E(e.sdp)})}function S(){o.emit("join",{userId:r,roomId:a.value})}const k=async()=>{const e=document.getElementById("local"),n=document.getElementById("remote-video");d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),y=new MediaStream,e.srcObject=d,n.srcObject=y,d.getTracks().forEach(s=>{t.addTrack(s,d)}),t.ontrack=s=>{s.streams[0].getTracks().forEach(m=>{y.addTrack(m)})}};async function b(){t.onicecandidate=async e=>{e.candidate&&(p=JSON.stringify(t.localDescription),p&&o.emit("offer",{userId:r,roomId:a.value,sdp:p}))};try{const e=await t.createOffer();await t.setLocalDescription(e)}catch(e){console.log(e)}}async function C(e){const n=JSON.parse(e);t.onicecandidate=async m=>{m.candidate&&o.emit("answer",{userId:r,roomId:a.value,sdp:JSON.stringify(t.localDescription)})},await t.setRemoteDescription(n);const s=await t.createAnswer();await t.setLocalDescription(s)}async function E(e){const n=JSON.parse(e);t.currentRemoteDescription||t.setRemoteDescription(n)}const u=I(!0);function O(){u.value=!u.value,d.getVideoTracks().forEach(e=>{e.enabled=u.value})}function x(){t.close(),o.emit("leave",{userId:r,roomId:a.value}),o.disconnect()}return J(()=>{k()}),(e,n)=>{const s=N,m=R,D=B,w=M;return L(),A("div",z,[i(m,{class:"p2p-container__row"},{default:l(()=>[i(s,{span:17,class:"remote__left"},{default:l(()=>[F,G]),_:1}),i(s,{span:7,class:"local__right"},{default:l(()=>[H,Q]),_:1})]),_:1}),c("div",W,[X,i(D,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=V=>a.value=V),style:{width:"150px","margin-right":"20px"},placeholder:"要加入的房间号",clearable:"",onKeyup:K(h,["enter"])},null,8,["modelValue","onKeyup"]),i(w,{type:"primary",onClick:h},{default:l(()=>[g("加入")]),_:1}),i(w,{type:u.value?"warning":"primary",onClick:O},{default:l(()=>[g(U(u.value?"关闭":"打开")+"视频",1)]),_:1},8,["type"]),i(w,{type:"danger",onClick:x},{default:l(()=>[g("离开")]),_:1})])])}}});const te=$(Y,[["__scopeId","data-v-2a0a62db"]]);export{te as default};

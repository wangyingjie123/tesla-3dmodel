import{n as _,C as R,y as B,z as A,o as j,m as J}from"./vendor-4e66f90e.js";import{d as U,a as I,f as K,I as L,l as $,m as q,M as c,Q as d,q as r,ak as z,U as w,V as S,ai as P,aj as Q}from"./@vue-8492d132.js";import{_ as F}from"./index-e85eb244.js";const f=v=>(P("data-v-12886a74"),v=v(),Q(),v),G={class:"p2p-container"},H=f(()=>r("div",{class:"remote-video margin-top-10"},[r("video",{id:"remote-video",class:"remote-video__dom",autoplay:"",playsinline:""})],-1)),W=f(()=>r("div",{class:"video-title"},"远程视频",-1)),X=f(()=>r("div",{class:"local-video"},[r("video",{id:"local",class:"local-video__dom",autoplay:"",playsinline:""})],-1)),Y=f(()=>r("div",{class:"video-title"},"我",-1)),Z={class:"operation"},ee=f(()=>r("label",{class:"operation-label"},"房间号：",-1)),oe=U({__name:"p2p-remote",setup(v){const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.voipbuster.com"}]}),i=Math.random().toString(36).substring(2),a=I("");let o,l,h,p="";function k(){if(!a.value){_.error("请输入房间号");return}o=R("https://10.1.60.61:3333"),o.on("connect",()=>{E()}),o.on("disconnect",e=>{e==="io server disconnect"&&o.connect(),_.warning("您已断开连接")}),o.on("error",e=>{_.error(e)}),o.on("welcome",e=>{_.success(e.userId===i?"🦄成功加入房间":`🦄${e.userId}加入房间`)}),o.on("leave",e=>{_.warning(e.userId===i?"🦄成功离开房间":`🦄${e.userId}离开房间`)}),o.on("message",e=>{console.log(e)}),o.on("createOffer",()=>{if(p){o.emit("offer",{userId:i,roomId:a.value,sdp:p});return}V()}),o.on("offer",e=>{b(e.sdp)}),o.on("answer",e=>{D(e.sdp)})}function E(){o.emit("join",{userId:i,roomId:a.value})}const O=async()=>{const e=document.getElementById("local"),n=document.getElementById("remote-video");l=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),h=new MediaStream,e.srcObject=l,n.srcObject=h,l.getTracks().forEach(s=>{t.addTrack(s,l)}),t.ontrack=s=>{s.streams[0].getTracks().forEach(m=>{h.addTrack(m)})}};async function V(){t.onicecandidate=async e=>{e.candidate&&(p=JSON.stringify(t.localDescription),p&&o.emit("offer",{userId:i,roomId:a.value,sdp:p}))};try{const e=await t.createOffer();await t.setLocalDescription(e)}catch(e){console.log(e)}}async function b(e){const n=JSON.parse(e);t.onicecandidate=async m=>{m.candidate&&o.emit("answer",{userId:i,roomId:a.value,sdp:JSON.stringify(t.localDescription)})},await t.setRemoteDescription(n);const s=await t.createAnswer();await t.setLocalDescription(s)}async function D(e){const n=JSON.parse(e);t.currentRemoteDescription||t.setRemoteDescription(n)}const u=I(!0);function T(){u.value=!u.value,l.getVideoTracks().forEach(e=>{e.enabled=u.value})}const y=I(!0);function x(){l.getAudioTracks().forEach(e=>{e.stop()}),y.value=!y.value}function C(){l.getTracks().forEach(e=>{e.stop()}),t.close(),o.emit("leave",{userId:i,roomId:a.value}),o.disconnect()}return K(()=>{O()}),L(()=>{C()}),(e,n)=>{const s=B,m=A,M=j,g=J;return $(),q("div",G,[c(m,{class:"p2p-container__row"},{default:d(()=>[c(s,{span:17,class:"remote__left"},{default:d(()=>[H,W]),_:1}),c(s,{span:7,class:"local__right"},{default:d(()=>[X,Y]),_:1})]),_:1}),r("div",Z,[ee,c(M,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=N=>a.value=N),style:{width:"150px","margin-right":"20px"},placeholder:"要加入的房间号",clearable:"",onKeyup:z(k,["enter"])},null,8,["modelValue","onKeyup"]),c(g,{type:"primary",onClick:k},{default:d(()=>[w("加入")]),_:1}),c(g,{type:y.value?"warning":"primary",onClick:x},{default:d(()=>[w(S(y.value?"关闭":"打开")+"麦克风 ",1)]),_:1},8,["type"]),c(g,{type:u.value?"warning":"primary",onClick:T},{default:d(()=>[w(S(u.value?"关闭":"打开")+"视频",1)]),_:1},8,["type"]),c(g,{type:"danger",onClick:C},{default:d(()=>[w("离开")]),_:1})])])}}});const se=F(oe,[["__scopeId","data-v-12886a74"]]);export{se as default};

import{n as S,m as k,o as z,p as W,q as G,g as K,r as Q,t as X,h as Y,v as Z,i as ee,w as ae}from"./vendor-bd744d8f.js";import{d as E,b as d,m as V,q as R,O as a,R as e,t as l,V as b,P as T,ai as $,aj as P,r as te,j as oe,J as ne}from"./@vue-30559afa.js";import{_ as x}from"./index-190ed622.js";import{_ as se}from"./console-form.vue_vue_type_script_setup_true_lang-76aee368.js";const le=async c=>{try{await navigator.clipboard.writeText(c),S.success("Page URL copied to clipboard")}catch(_){console.error("Failed to copy: ",_)}},A=c=>($("data-v-483e5b80"),c=c(),P(),c),re={class:"card-header"},de={class:"card-header__title"},ce=A(()=>l("h3",null,"用户1操作区",-1)),ie=A(()=>l("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),ue=A(()=>l("div",{class:"card-header"},[l("div",{class:"card-header__title"},[l("h3",null,"用户2操作区")]),l("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),pe=A(()=>l("div",{class:"card-header"},[l("div",{class:"card-header__title"},[l("h3",null,"用户1操作区")]),l("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),fe=E({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(c,{emit:_}){const m=d(""),r=d(""),t=p=>{le(p)};return(p,n)=>{const v=k,w=z,h=W;return V(),R(T,null,[a(h,{shadow:"always"},{header:e(()=>[l("div",re,[l("div",de,[ce,a(v,{type:"primary",onClick:n[0]||(n[0]=i=>_("createOffer"))},{default:e(()=>[b("create offer")]),_:1})]),ie])]),default:e(()=>[a(w,{value:p.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:e(()=>[a(v,{onClick:n[1]||(n[1]=i=>t(p.localOffer)),disabled:!p.localOffer},{default:e(()=>[b("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(h,{shadow:"always",class:"margin-top-10"},{header:e(()=>[ue]),default:e(()=>[a(w,{placeholder:"请粘贴用户1 SDP offer",modelValue:m.value,"onUpdate:modelValue":n[3]||(n[3]=i=>m.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(v,{disabled:!m.value,onClick:n[2]||(n[2]=i=>_("createAnswer",m.value))},{default:e(()=>[b("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(w,{placeholder:"SDP answer",value:p.remoteAnswer,disabled:"",class:"margin-top-10"},{append:e(()=>[a(v,{onClick:n[4]||(n[4]=i=>t(p.remoteAnswer)),disabled:!p.remoteAnswer},{default:e(()=>[b("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(h,{shadow:"always",class:"margin-top-10"},{header:e(()=>[pe]),default:e(()=>[a(w,{placeholder:"请粘贴用户2 SDP answer",modelValue:r.value,"onUpdate:modelValue":n[6]||(n[6]=i=>r.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(v,{onClick:n[5]||(n[5]=i=>_("addAnswer",r.value)),disabled:!r.value},{default:e(()=>[b("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const _e=x(fe,[["__scopeId","data-v-483e5b80"]]),I=c=>($("data-v-aa6ad34b"),c=c(),P(),c),ve=I(()=>l("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),me=I(()=>l("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),we=E({__name:"index",setup(c){const _=d(),m=d(),r=d(new MediaStream),t=d(new RTCPeerConnection({iceServers:[{urls:"stun:172.16.40.202:3478"}]})),p=d(t.value.createDataChannel("message")),n=d(),v=d(""),w=d(""),h=d(!1),i=d(!0),D=te({audio:!1,video:!0}),N=async()=>{const o=_.value,s=m.value;r.value=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}),o.srcObject=r.value,r.value.getTracks().forEach(u=>{t.value.addTrack(u,r.value)}),r.value.getAudioTracks().forEach(u=>{u.enabled=!1}),t.value.ondatachannel=u=>{S.success("建立连接"),i.value=!1;const f=u.channel;f.onopen=()=>{f.send("建立连接!")},f.onmessage=g=>{var C;console.log(g.data),(C=n.value)==null||C.writeInfo(`接收到的指令：${g.data}`)}};const y=new MediaStream;t.value.ontrack=u=>{u.streams[0].getTracks().forEach(f=>{y.addTrack(f)}),s.srcObject=y}},M=async()=>{const o=await t.value.createOffer();await t.value.setLocalDescription(o),t.value.onicecandidate=async s=>{s.candidate&&(v.value=JSON.stringify(t.value.localDescription))}},U=async o=>{if(!o)return;const s=JSON.parse(o);t.value.onicecandidate=async u=>{if(u.candidate){const f=JSON.stringify(t.value.localDescription);w.value=f}},await t.value.setRemoteDescription(s);const y=await t.value.createAnswer();await t.value.setLocalDescription(y)},F=async o=>{if(!o)return;const s=JSON.parse(o);t.value.currentRemoteDescription||t.value.setRemoteDescription(s)},J=o=>{D.audio=o,r.value.getAudioTracks().forEach(s=>{s.enabled=o})},j=o=>{D.video=o,r.value.getVideoTracks().forEach(s=>{s.enabled=o})};return oe(()=>{N()}),ne(()=>{r.value.getTracks().forEach(o=>{o.stop()}),t.value.close()}),(o,s)=>{const y=G,u=k,f=K,g=Q,C=X,B=Y,H=Z,L=ee,q=ae;return V(),R(T,null,[a(L,{class:"p2p-main"},{default:e(()=>[a(f,{class:"p2p-header"},{default:e(()=>[a(y,{type:"warning",size:"large"},{default:e(()=>[b("Webrtc-P2P通话")]),_:1}),a(u,{onClick:s[0]||(s[0]=O=>h.value=!0),type:"primary"},{default:e(()=>[b("打开操作面板")]),_:1})]),_:1}),a(B,null,{default:e(()=>[a(C,null,{default:e(()=>[a(g,{span:12,class:"p2p-video"},{default:e(()=>[ve,l("video",{class:"p2p-video__dom",ref_key:"localRef",ref:_,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),a(g,{span:12,class:"p2p-video"},{default:e(()=>[me,l("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:m,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),a(H,null,{default:e(()=>[a(se,{localStream:r.value,peerConnection:t.value,dataChannel:p.value,btnDiabled:i.value,mediaDevices:D,experiment:!0,onHandleAudio:J,onHandleVideo:j,ref_key:"consoleRef",ref:n},null,8,["localStream","peerConnection","dataChannel","btnDiabled","mediaDevices"])]),_:1})]),_:1}),a(q,{modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=O=>h.value=O),title:"本地操作区域-打开2个tab页"},{default:e(()=>[a(_e,{localOffer:v.value,remoteAnswer:w.value,onCreateOffer:M,onCreateAnswer:U,onAddAnswer:F},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const Ce=x(we,[["__scopeId","data-v-aa6ad34b"]]);export{Ce as default};

import{n as D,m as k,o as L,p as q,q as z,g as H,r as W,t as G,h as K,v as Q,i as X,w as Y}from"./vendor-5fa84e51.js";import{d as A,b as c,m as E,q as V,O as a,R as e,t as n,V as h,P as R,ai as $,aj as P,j as Z,J as ee}from"./@vue-30559afa.js";import{_ as T}from"./index-07453016.js";import{_ as ae}from"./console-form.vue_vue_type_script_setup_true_lang-a26b2ebf.js";const te=async d=>{try{await navigator.clipboard.writeText(d),D.success("Page URL copied to clipboard")}catch(f){console.error("Failed to copy: ",f)}},O=d=>($("data-v-483e5b80"),d=d(),P(),d),oe={class:"card-header"},ne={class:"card-header__title"},le=O(()=>n("h3",null,"用户1操作区",-1)),se=O(()=>n("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),re=O(()=>n("div",{class:"card-header"},[n("div",{class:"card-header__title"},[n("h3",null,"用户2操作区")]),n("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),ce=O(()=>n("div",{class:"card-header"},[n("div",{class:"card-header__title"},[n("h3",null,"用户1操作区")]),n("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),de=A({__name:"offer-form",props:{localOffer:{},remoteAnswer:{}},emits:["createOffer","createAnswer","addAnswer"],setup(d,{emit:f}){const v=c(""),l=c(""),t=p=>{te(p)};return(p,o)=>{const m=k,w=L,b=q;return E(),V(R,null,[a(b,{shadow:"always"},{header:e(()=>[n("div",oe,[n("div",ne,[le,a(m,{type:"primary",onClick:o[0]||(o[0]=i=>f("createOffer"))},{default:e(()=>[h("create offer")]),_:1})]),se])]),default:e(()=>[a(w,{value:p.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:e(()=>[a(m,{onClick:o[1]||(o[1]=i=>t(p.localOffer)),disabled:!p.localOffer},{default:e(()=>[h("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(b,{shadow:"always",class:"margin-top-10"},{header:e(()=>[re]),default:e(()=>[a(w,{placeholder:"请粘贴用户1 SDP offer",modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=i=>v.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{disabled:!v.value,onClick:o[2]||(o[2]=i=>f("createAnswer",v.value))},{default:e(()=>[h("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),a(w,{placeholder:"SDP answer",value:p.remoteAnswer,disabled:"",class:"margin-top-10"},{append:e(()=>[a(m,{onClick:o[4]||(o[4]=i=>t(p.remoteAnswer)),disabled:!p.remoteAnswer},{default:e(()=>[h("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),a(b,{shadow:"always",class:"margin-top-10"},{header:e(()=>[ce]),default:e(()=>[a(w,{placeholder:"请粘贴用户2 SDP answer",modelValue:l.value,"onUpdate:modelValue":o[6]||(o[6]=i=>l.value=i),clearable:"",class:"input-with-select"},{append:e(()=>[a(m,{onClick:o[5]||(o[5]=i=>f("addAnswer",l.value)),disabled:!l.value},{default:e(()=>[h("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const ie=T(de,[["__scopeId","data-v-483e5b80"]]),x=d=>($("data-v-ac4be671"),d=d(),P(),d),ue=x(()=>n("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),pe=x(()=>n("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),_e=A({__name:"index",setup(d){const f=c(),v=c(),l=c(new MediaStream),t=c(new RTCPeerConnection({iceServers:[{urls:"stun:172.16.40.202:3478"}]})),p=c(t.value.createDataChannel("message")),o=c(),m=c(""),w=c(""),b=c(!1),i=c(!0),I=async()=>{const s=f.value,r=v.value;l.value=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}),s.srcObject=l.value,l.value.getTracks().forEach(u=>{t.value.addTrack(u,l.value)}),l.value.getAudioTracks().forEach(u=>{u.enabled=!1}),t.value.ondatachannel=u=>{D.success("建立连接"),i.value=!1;const _=u.channel;_.onopen=()=>{_.send("建立连接!")},_.onmessage=g=>{var C;console.log(g.data),(C=o.value)==null||C.writeInfo(`接收到的指令：${g.data}`)}};const y=new MediaStream;t.value.ontrack=u=>{u.streams[0].getTracks().forEach(_=>{y.addTrack(_)}),r.srcObject=y}},N=async()=>{const s=await t.value.createOffer();await t.value.setLocalDescription(s),t.value.onicecandidate=async r=>{r.candidate&&(m.value=JSON.stringify(t.value.localDescription))}},M=async s=>{if(!s)return;const r=JSON.parse(s);t.value.onicecandidate=async u=>{if(u.candidate){const _=JSON.stringify(t.value.localDescription);w.value=_}},await t.value.setRemoteDescription(r);const y=await t.value.createAnswer();await t.value.setLocalDescription(y)},U=async s=>{if(!s)return;const r=JSON.parse(s);t.value.currentRemoteDescription||t.value.setRemoteDescription(r)};return Z(()=>{I()}),ee(()=>{l.value.getTracks().forEach(s=>{s.stop()}),t.value.close()}),(s,r)=>{const y=z,u=k,_=H,g=W,C=G,F=K,J=Q,j=X,B=Y;return E(),V(R,null,[a(j,{class:"p2p-main"},{default:e(()=>[a(_,{class:"p2p-header"},{default:e(()=>[a(y,{type:"warning",size:"large"},{default:e(()=>[h("Webrtc-P2P通话")]),_:1}),a(u,{onClick:r[0]||(r[0]=S=>b.value=!0),type:"primary"},{default:e(()=>[h("打开操作面板")]),_:1})]),_:1}),a(F,null,{default:e(()=>[a(C,null,{default:e(()=>[a(g,{span:12,class:"p2p-video"},{default:e(()=>[ue,n("video",{class:"p2p-video__dom",ref_key:"localRef",ref:f,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),a(g,{span:12,class:"p2p-video"},{default:e(()=>[pe,n("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:v,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),a(J,null,{default:e(()=>[a(ae,{localStream:l.value,peerConnection:t.value,dataChannel:p.value,btnDiabled:i.value,experiment:!0,ref_key:"consoleRef",ref:o},null,8,["localStream","peerConnection","dataChannel","btnDiabled"])]),_:1})]),_:1}),a(B,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=S=>b.value=S),title:"本地操作区域-打开2个tab页"},{default:e(()=>[a(ie,{localOffer:m.value,remoteAnswer:w.value,onCreateOffer:N,onCreateAnswer:M,onAddAnswer:U},null,8,["localOffer","remoteAnswer"])]),_:1},8,["modelValue"])],64)}}});const be=T(_e,[["__scopeId","data-v-ac4be671"]]);export{be as default};

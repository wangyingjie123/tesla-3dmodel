import{aI as Ir,d as Hr,f as Fr,o as jr,c as Wr,_ as Vr}from"./index-94e44db4.js";var Hn={},zr={get exports(){return Hn},set exports(It){Hn=It}};/*! GoldPlay built @6/28/2020, 11:46:42 AM */(function(It,cr){(function(F,te){It.exports=te()})(window,function(){return function(F){var te={};function m(P){if(te[P])return te[P].exports;var g=te[P]={i:P,l:!1,exports:{}};return F[P].call(g.exports,g,g.exports,m),g.l=!0,g.exports}return m.m=F,m.c=te,m.d=function(P,g,C){m.o(P,g)||Object.defineProperty(P,g,{enumerable:!0,get:C})},m.r=function(P){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})},m.t=function(P,g){if(1&g&&(P=m(P)),8&g||4&g&&typeof P=="object"&&P&&P.__esModule)return P;var C=Object.create(null);if(m.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:P}),2&g&&typeof P!="string")for(var k in P)m.d(C,k,function(V){return P[V]}.bind(null,k));return C},m.n=function(P){var g=P&&P.__esModule?function(){return P.default}:function(){return P};return m.d(g,"a",g),g},m.o=function(P,g){return Object.prototype.hasOwnProperty.call(P,g)},m.p="",m(m.s=162)}([function(F,te){F.exports=function(m,P,g){return P in m?Object.defineProperty(m,P,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[P]=g,m}},function(F,te){F.exports=function(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}},function(F,te){F.exports=function(m,P){if(!(m instanceof P))throw new TypeError("Cannot call a class as a function")}},function(F,te){function m(P,g){for(var C=0;C<g.length;C++){var k=g[C];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(P,k.key,k)}}F.exports=function(P,g,C){return g&&m(P.prototype,g),C&&m(P,C),P}},function(F,te){function m(P){return F.exports=m=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)},m(P)}F.exports=m},function(F,te,m){var P=m(11),g=m(1);F.exports=function(C,k){return!k||P(k)!=="object"&&typeof k!="function"?g(C):k}},function(F,te,m){var P=m(48);F.exports=function(g,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(C&&C.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),C&&P(g,C)}},,function(F,te){F.exports=function(m,P){return P||(P=m.slice(0)),Object.freeze(Object.defineProperties(m,{raw:{value:Object.freeze(P)}}))}},function(F,te,m){m.d(te,"c",function(){return P}),m.d(te,"b",function(){return g}),m.d(te,"a",function(){return C}),m.d(te,"d",function(){return k});var P={projectName:"GOLDPLAY",projectAbbreviation:"GP",mode:"production",basePath:"./",get distPath(){var V="";return(this.mode=="development"||this.mode=="test")&&(V="/dist/"),V},get libPath(){return this.distPath+"lib/"},hideBarBoxTime:300,speedList:[{name:"0.5X",value:.5},{name:"1.0X",value:1},{name:"1.5X",value:1.5},{name:"2.0X",value:2},{name:"3.0X",value:3}]},g={maxDuration:30,maxSize:1024e6,maxRetryCount:3},C=1/9e4,k={READYBUFFERLENGTH:1e3,MAXBUFFERLENGTH:5e3}},function(F,te,m){var P=m(2),g=m.n(P),C=m(3),k=m.n(C),V=m(0),L=m.n(V),$=m(9),c=console||{};function K(I,T){if(c[I]){if(this.disabled||this.level<0||$.c.mode==="production"&&(I!=="error"||I!=="warn")||this.level===1&&["info"].includes(I)||this.level===2&&["log","info"].includes(I)||this.level>2&&I!=="error")return;for(var ne=new Date().toLocaleString(),h=arguments.length,q=new Array(h>2?h-2:0),Y=2;Y<h;Y++)q[Y-2]=arguments[Y];var N=["\x1B[32m".concat(T,"\x1B[39m")].concat(q,[ne]);I!=="error"&&I!=="warn"||(N=[T].concat(q,[ne])),typeof c[I]=="function"&&c[I].apply(c,N)}}var p=function(){function I(T){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};g()(this,I),L()(this,"prefix",$.c.projectName),L()(this,"joiner",">"),L()(this,"left","["),L()(this,"right","]"),L()(this,"disabled",!1),L()(this,"level",0),Object.assign(this,ne),typeof T=="string"?this.file=T:T&&T.constructor&&(this.file=T.constructor.name)}return k()(I,[{key:"setDisabled",value:function(T){this.disabled=T}},{key:"setLevel",value:function(T){this.level=T}}],[{key:"get",value:function(T,ne){return new I(T,ne)}}]),I}();["info","log","debug","warn","error"].forEach(function(I){p.prototype[I]=function(T,ne){ne=ne===void 0?"":this.joiner+ne;for(var h=this.left+T+ne+this.right,q=this.left+this.prefix+" "+this.file+this.right+h,Y=arguments.length,N=new Array(Y>2?Y-2:0),ae=2;ae<Y;ae++)N[ae-2]=arguments[ae];K.apply(this,[I,q].concat(N))}}),te.a=p},function(F,te){function m(P){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?F.exports=m=function(g){return typeof g}:F.exports=m=function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},m(P)}F.exports=m},,,,,,,function(F,te,m){F.exports=m(88)},,,,,function(F,te,m){m.d(te,"a",function(){return p});var P=m(2),g=m.n(P),C=m(3),k=m.n(C),V=m(0),L=m.n(V),$=m(9),c={eval:EvalError,range:RangeError,reference:ReferenceError,syntax:SyntaxError,type:TypeError,uri:URIError,default:Error},K=null,p=(K||(K=new(function(){function I(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"default",ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1001;return g()(this,I),L()(this,"type",""),L()(this,"errorName","DefaultError"),L()(this,"code",null),L()(this,"message",""),L()(this,"stack",""),this.type=T,this.code=ne,this.throws.bind(this)}return k()(I,[{key:"throws",value:function(T){for(var ne="",h=Error,q=arguments.length,Y=new Array(q>1?q-1:0),N=1;N<q;N++)Y[N-1]=arguments[N];if(T instanceof Error){for(var ae in c)if(T instanceof c[ae]){this.errorName=c[ae].name,h=T.constructor;break}this.stack=T.stack,Y&&Y.splice&&(ne=Y[0],Y.splice(0,1))}else ne=T.toString();this.message="[".concat($.c.projectName," ERROR:")+this.type+"-"+this.code+"]"+ne;try{throw new h(this.message,"[args]:",Y)}catch(de){this.stack=this.stack||de.stack,console.error(de,"[message]:",ne,"[args]:",Y)}}}]),I}())),K)},function(F,te){F.exports=function(m,P){var g=P.get(m);if(!g)throw new TypeError("attempted to get private field on non-instance");return g.get?g.get.call(m):g.value}},,,function(F,te,m){var P=m(48),g=m(86);function C(k,V,L){return g()?F.exports=C=Reflect.construct:F.exports=C=function($,c,K){var p=[null];p.push.apply(p,c);var I=new(Function.bind.apply($,p));return K&&P(I,K.prototype),I},C.apply(null,arguments)}F.exports=C},function(F,te){function m(P,g,C,k,V,L,$){try{var c=P[L]($),K=c.value}catch(p){return void C(p)}c.done?g(K):Promise.resolve(K).then(k,V)}F.exports=function(P){return function(){var g=this,C=arguments;return new Promise(function(k,V){var L=P.apply(g,C);function $(K){m(L,k,V,$,c,"next",K)}function c(K){m(L,k,V,$,c,"throw",K)}$(void 0)})}}},function(F,te){F.exports=function(m,P,g){var C=P.get(m);if(!C)throw new TypeError("attempted to set private field on non-instance");if(C.set)C.set.call(m,g);else{if(!C.writable)throw new TypeError("attempted to set read only private field");C.value=g}return g}},,,,,function(F,te,m){var P=m(4),g=m(48),C=m(87),k=m(27);function V(L){var $=typeof Map=="function"?new Map:void 0;return F.exports=V=function(c){if(c===null||!C(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if($!==void 0){if($.has(c))return $.get(c);$.set(c,K)}function K(){return k(c,arguments,P(this).constructor)}return K.prototype=Object.create(c.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),g(K,c)},V(L)}F.exports=V},,,,,,,,,,function(F,te,m){function P(L){var $={};function c(p){if($[p])return $[p].exports;var I=$[p]={i:p,l:!1,exports:{}};return L[p].call(I.exports,I,I.exports,c),I.l=!0,I.exports}c.m=L,c.c=$,c.i=function(p){return p},c.d=function(p,I,T){c.o(p,I)||Object.defineProperty(p,I,{configurable:!1,enumerable:!0,get:T})},c.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},c.n=function(p){var I=p&&p.__esModule?function(){return p.default}:function(){return p};return c.d(I,"a",I),I},c.o=function(p,I){return Object.prototype.hasOwnProperty.call(p,I)},c.p="/",c.oe=function(p){throw console.error(p),p};var K=c(c.s=ENTRY_MODULE);return K.default||K}var g="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function C(L){return(L+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function k(L,$,c){var K={};K[c]=[];var p=$.toString(),I=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!I)return K;for(var T,ne=I[1],h=new RegExp("(\\\\n|\\W)"+C(ne)+g,"g");T=h.exec(p);)T[3]!=="dll-reference"&&K[c].push(T[3]);for(h=new RegExp("\\("+C(ne)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+g,"g");T=h.exec(p);)L[T[2]]||(K[c].push(T[1]),L[T[2]]=m(T[1]).m),K[T[2]]=K[T[2]]||[],K[T[2]].push(T[4]);for(var q,Y=Object.keys(K),N=0;N<Y.length;N++)for(var ae=0;ae<K[Y[N]].length;ae++)q=K[Y[N]][ae],isNaN(1*q)||(K[Y[N]][ae]=1*K[Y[N]][ae]);return K}function V(L){return Object.keys(L).reduce(function($,c){return $||L[c].length>0},!1)}F.exports=function(L,$){$=$||{};var c={main:m.m},K=$.all?{main:Object.keys(c.main)}:function(h,q){for(var Y={main:[q]},N={main:[]},ae={main:{}};V(Y);)for(var de=Object.keys(Y),fe=0;fe<de.length;fe++){var he=de[fe],re=Y[he].pop();if(ae[he]=ae[he]||{},!ae[he][re]&&h[he][re]){ae[he][re]=!0,N[he]=N[he]||[],N[he].push(re);for(var oe=k(h,h[he][re],he),Z=Object.keys(oe),j=0;j<Z.length;j++)Y[Z[j]]=Y[Z[j]]||[],Y[Z[j]]=Y[Z[j]].concat(oe[Z[j]])}}return N}(c,L),p="";Object.keys(K).filter(function(h){return h!=="main"}).forEach(function(h){for(var q=0;K[h][q];)q++;K[h].push(q),c[h][q]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+h+" = ("+P.toString().replace("ENTRY_MODULE",JSON.stringify(q))+")({"+K[h].map(function(Y){return JSON.stringify(Y)+": "+c[h][Y].toString()}).join(",")+`});
`}),p=p+"new (("+P.toString().replace("ENTRY_MODULE",JSON.stringify(L))+")({"+K.main.map(function(h){return JSON.stringify(h)+": "+c.main[h].toString()}).join(",")+"}))(self);";var I=new window.Blob([p],{type:"text/javascript"});if($.bare)return I;var T=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(I),ne=new window.Worker(T);return ne.objectURL=T,ne}},function(F,te,m){var P,g,C;g=[],(C=typeof(P=function(){var k=function(){},V={},L={},$={};function c(T,ne){if(T){var h=$[T];if(L[T]=ne,h)for(;h.length;)h[0](T,ne),h.splice(0,1)}}function K(T,ne){T.call&&(T={success:T}),ne.length?(T.error||k)(ne):(T.success||k)(T)}function p(T,ne,h,q){var Y,N,ae=document,de=h.async,fe=(h.numRetries||0)+1,he=h.before||k,re=T.replace(/[\?|#].*$/,""),oe=T.replace(/^(css|img)!/,"");q=q||0,/(^css!|\.css$)/.test(re)?((N=ae.createElement("link")).rel="stylesheet",N.href=oe,(Y="hideFocus"in N)&&N.relList&&(Y=0,N.rel="preload",N.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(re)?(N=ae.createElement("img")).src=oe:((N=ae.createElement("script")).src=T,N.async=de===void 0||de),N.onload=N.onerror=N.onbeforeload=function(Z){var j=Z.type[0];if(Y)try{N.sheet.cssText.length||(j="e")}catch(G){G.code!=18&&(j="e")}if(j=="e"){if((q+=1)<fe)return p(T,ne,h,q)}else if(N.rel=="preload"&&N.as=="style")return N.rel="stylesheet";ne(T,j,Z.defaultPrevented)},he(T,N)!==!1&&ae.head.appendChild(N)}function I(T,ne,h){var q,Y;if(ne&&ne.trim&&(q=ne),Y=(q?h:ne)||{},q){if(q in V)throw"LoadJS";V[q]=!0}function N(ae,de){(function(fe,he,re){var oe,Z,j=(fe=fe.push?fe:[fe]).length,G=j,S=[];for(oe=function(x,D,R){if(D=="e"&&S.push(x),D=="b"){if(!R)return;S.push(x)}--j||he(S)},Z=0;Z<G;Z++)p(fe[Z],oe,re)})(T,function(fe){K(Y,fe),ae&&K({success:ae,error:de},fe),c(q,fe)},Y)}if(Y.returnPromise)return new Promise(N);N()}return I.ready=function(T,ne){return function(h,q){h=h.push?h:[h];var Y,N,ae,de=[],fe=h.length,he=fe;for(Y=function(re,oe){oe.length&&de.push(re),--he||q(de)};fe--;)N=h[fe],(ae=L[N])?Y(N,ae):($[N]=$[N]||[]).push(Y)}(T,function(h){K(ne,h)}),I},I.done=function(T){c(T,[])},I.reset=function(){V={},L={},$={}},I.isDefined=function(T){return T in V},I})=="function"?P.apply(te,g):P)===void 0||(F.exports=C)},,,function(F,te){function m(P,g){return F.exports=m=Object.setPrototypeOf||function(C,k){return C.__proto__=k,C},m(P,g)}F.exports=m},function(F,te){(function(){function m(P,g){throw new Error("abstract")}m.prototype.drawFrame=function(P){throw new Error("abstract")},m.prototype.clear=function(){throw new Error("abstract")},F.exports=m})()},,,,,,,,,,,function(F,te){var m={validateDimension:function(P){if(P<=0||P!==(0|P))throw"YUV plane dimensions must be a positive integer"},validateOffset:function(P){if(P<0||P!==(0|P))throw"YUV plane offsets must be a non-negative integer"},format:function(P){var g=P.width,C=P.height,k=P.chromaWidth||g,V=P.chromaHeight||C,L=P.cropLeft||0,$=P.cropTop||0,c=P.cropWidth||g-L,K=P.cropHeight||C-$,p=P.displayWidth||c,I=P.displayHeight||K;return this.validateDimension(g),this.validateDimension(C),this.validateDimension(k),this.validateDimension(V),this.validateOffset(L),this.validateOffset($),this.validateDimension(c),this.validateDimension(K),this.validateDimension(p),this.validateDimension(I),{width:g,height:C,chromaWidth:k,chromaHeight:V,cropLeft:L,cropTop:$,cropWidth:c,cropHeight:K,displayWidth:p,displayHeight:I}},allocPlane:function(P,g){return m.validateDimension(P),m.validateDimension(g),{bytes:new Uint8Array(P*g),stride:P}},suitableStride:function(P){m.validateDimension(P);var g=P%4;return g==0?P:P+(4-g)},allocPlane:function(P,g,C,k,V){var L,$;if(this.validateDimension(P),this.validateDimension(g),V=V||0,k=k||this.suitableStride(P),this.validateDimension(k),k<P)throw"Invalid input stride for YUV plane; must be larger than width";if(L=k*g,C){if(C.length-V<L)throw"Invalid input buffer for YUV plane; must be large enough for stride times height";$=C.slice(V,V+L)}else $=new Uint8Array(L),k=k||this.suitableStride(P);return{bytes:$,stride:k}},lumaPlane:function(P,g,C,k){return this.allocPlane(P.width,P.height,g,C,k)},chromaPlane:function(P,g,C,k){return this.allocPlane(P.chromaWidth,P.chromaHeight,g,C,k)},frame:function(P,g,C,k){return{format:P,y:g=g||this.lumaPlane(P),u:C=C||this.chromaPlane(P),v:k=k||this.chromaPlane(P)}},copyPlane:function(P){return{bytes:P.bytes.slice(),stride:P.stride}},copyFrame:function(P){return{format:P.format,y:this.copyPlane(P.y),u:this.copyPlane(P.u),v:this.copyPlane(P.v)}},transferables:function(P){return[P.y.bytes.buffer,P.u.bytes.buffer,P.v.bytes.buffer]}};F.exports=m},function(F,te,m){var P=m(95),g=m(96),C=m(97),k=m(99);F.exports=function(V,L){return P(V)||g(V,L)||C(V,L)||k()}},,,,,,,,,,,function(F,te,m){(function(){var P=m(49),g=m(89),C=m(92),k={FrameSink:P,SoftwareFrameSink:g,WebGLFrameSink:C,attach:function(V,L){return("webGL"in(L=L||{})?L.webGL:C.isAvailable())?new C(V,L):new g(V,L)}};F.exports=k})()},,,,,,,,,,,,,function(F,te,m){m.r(te);var P=m(2),g=m.n(P),C=m(3),k=m.n(C),V=m(5),L=m.n(V),$=m(4),c=m.n($),K=m(1),p=m.n(K),I=m(6),T=m.n(I),ne=m(0),h=m.n(ne),q=m(24),Y=m.n(q),N=m(29),ae=m.n(N),de=m(10),fe=de.a.get("Events.js"),he=function(){function i(n){g()(this,i),h()(this,"eventsQueue",{}),h()(this,"target",{}),h()(this,"disallowRepeat",!1),this.target=n}return k()(i,[{key:"add",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,r=!0,a=!1,l=void 0;try{for(var f,v=n[Symbol.iterator]();!(r=(f=v.next()).done);r=!0){var w=f.value;this.on(w,e,t)}}catch(A){a=!0,l=A}finally{try{r||v.return==null||v.return()}finally{if(a)throw l}}}},{key:"on",value:function(n,e,t){if(this.eventsQueue[n]===void 0&&(this.eventsQueue[n]={methods:[],once:!1}),typeof e=="function"){if(!this.disallowRepeat||!this.eventsQueue[n].methods.includes(e))return this.eventsQueue[n].methods.push(e),t!==void 0&&(this.eventsQueue[n].once=t),this.target}else fe.error("on","the argument is not function.",e)}},{key:"once",value:function(n,e){this.on(n,e,!0)}},{key:"off",value:function(n,e){var t=this.eventsQueue[n];if(t){var r=t.methods;if(e)for(var a=r.length;a--;)r[a]===e&&r.splice(a,1);else delete this.eventsQueue[n];return this.target}}},{key:"emit",value:function(n){for(var e=this,t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var l=this.eventsQueue[n];if(l){var f=l.methods;return f.forEach(function(v){v.apply(e.target,r)}),l.once&&this.off(n),this.target}}},{key:"clear",value:function(n){delete this.eventsQueue[n]}},{key:"clearAll",value:function(){this.eventsQueue={}}}]),i}(),re=function(i){var n=new he(i);return function(e){return n.target=e,n}},oe=m(11),Z=m.n(oe),j=de.a.get("Element.js"),G=function(){function i(){g()(this,i)}return k()(i,null,[{key:"createEl",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",e=arguments.length>1?arguments[1]:void 0;if(typeof n!="string")return j.error("please input element name"),null;var t=document.createElement(n,e);return t}},{key:"registerElement",value:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HTMLElement,t=arguments.length>2?arguments[2]:void 0,r=document.registerElement(n,{prototype:Object.create(e.prototype),extends:t});return r}},{key:"addEl",value:function(n,e){if(n&&e)try{e.appendChild(n)}catch(t){j.error(t)}}},{key:"removeEl",value:function(n){try{var e=n.parentNode;e&&e.removeChild(n)}catch(t){j.error(t)}}},{key:"addClass",value:function(n){try{for(var e,t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];(e=n.classList).add.apply(e,r)}catch(l){j.error(l)}}},{key:"removeClass",value:function(){}},{key:"hasClass",value:function(){}},{key:"isElement",value:function(n){try{return n instanceof HTMLElement}catch(e){return Z()(n)==="object"&&n.nodeType===1&&Z()(n.style)==="object"&&Z()(n.ownerDocument)==="object"}}},{key:"setAttributes",value:function(n,e){if(i.isElement(n))for(var t=0,r=e.length;t<r;t++){var a=e[t],l=a.name;l=a.name.replace(/["|']/g,""),n.setAttribute(l,a.value)}}},{key:"syncAttributes",value:function(n,e){var t=e.attributes;i.setAttributes(n,t);var r=n.attributes;i.setAttributes(e,r)}},{key:"getClientWidth",value:function(){return document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth}},{key:"getClientHeight",value:function(){return document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight}},{key:"adaptSizeElement",value:function(n,e,t,r){var a=t,l=r;l.width=n||l.width||a.offsetWidth,l.height=e||l.height||a.offsetHeight;var f=l.width,v=l.height,w=0;l.style.position="absolute",a.offsetWidth<=0&&(a.style.width=f+"px"),a.offsetHeight<=0&&(a.style.height=v+"px");var A=a.offsetWidth/f,H=a.offsetHeight/v;w=H>A?A:H,l.style.top=a.offsetTop+(a.offsetHeight-v*w)/2+"px",l.style.left=a.offsetLeft+(a.offsetWidth-f*w)/2+"px",l.style.transform="scale(".concat(w,", ").concat(w,")"),l.style["transform-origin"]="top left",l.style.display="inline-block"}}]),i}(),S=m(27),x=m.n(S),D=function(){function i(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g()(this,i),h()(this,"logger",null),h()(this,"__instance__",null),h()(this,"__singleton__",null),this.options=n,this.setLogger(this.constructor.name+".js")}return k()(i,[{key:"setLogger",value:function(n){this.logger=new de.a(n)}},{key:"getLogger",value:function(){return this.logger}},{key:"setOptions",value:function(n){Object.assign(this.options,n)}},{key:"toString",value:function(){return JSON.stringify(this)}},{key:"events",get:function(){return this.options&&this.options.events?this.options.events(this):re(this)}}],[{key:"getInstance",value:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return this.__instance__=x()(this,e),this.__instance__}},{key:"getSingleton",value:function(){if(!this.__singleton__){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];this.__singleton__=x()(this,e)}return this.__singleton__}}]),i}(),R=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this)),h()(p()(t),"component",null),t.component=e.component,t}return T()(n,i),k()(n,[{key:"confirm",value:function(){}},{key:"show",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this.component.data.content=e,this.component.data.display!=="default"&&this.component.data.display!==""||this.component.showBox(),this.component.data.display!=="show"&&this.component.show()}},{key:"hide",value:function(){this.component.hide()}}]),n}(D),M=m(23),z=function(){function i(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g()(this,i),h()(this,"logger",null),this.options=n,this.debug=n.debug||!1,this.setLogger(this.constructor.name+".js")}return k()(i,[{key:"setLogger",value:function(n){this.logger=new de.a(n)}},{key:"getLogger",value:function(){return this.logger}},{key:"setOptions",value:function(n){Object.assign(this.options,n)}},{key:"toString",value:function(){return JSON.stringify(this)}},{key:"events",get:function(){return this.options&&this.options.events?this.options.events(this):re(this)}},{key:"alert",get:function(){var n="";return this.options&&this.options.alertError&&(n=this.options.alertError),n}}]),i}(),Q=m(9),ue=function(i){function n(){var e;return g()(this,n),e=L()(this,c()(n).call(this)),h()(p()(e),"loadData",null),h()(p()(e),"sourceURL",""),e}return T()(n,i),k()(n,[{key:"init",value:function(){}},{key:"setLoadData",value:function(e){this.loadData=e}},{key:"setSourceURL",value:function(e){this.sourceURL=e}},{key:"getLoadData",value:function(){return this.getLoadData}},{key:"getSourceURL",value:function(){return this.getSourceURL}}]),n}(z),pe={LOAD_PLAYLIST:10,get 10(){return"loading playlist"},LOADED_PLAYLIST:11,get 11(){return"playlist is loaded"},IDLE:0,get 0(){return"is free"},LOADING:1,get 1(){return"loading segment"},DONE:2,get 2(){return"segment is loaded"},ERROR:3,get 3(){return"load get error"}},le=de.a.get("M3U8Parser.js",{level:2}),ve={lineDelimiter:/\r?\n/,extensionHeader:"#EXTM3U",tagPrefix:"#EXT",segmentPrefix:"#EXTINF",segmentParse:/^#EXTINF: *([0-9.]+)(, *(.+?)?)?$/,tagParse:/^#EXT-X-([A-Z-]+)(:(.+))?$/,version:"VERSION",allowCache:"ALLOW-CACHE",combined:"COMBINED",endList:"ENDLIST",targetDuration:"TARGETDURATION",mediaSequence:"MEDIA-SEQUENCE",discontinuity:"DISCONTINUITY",steamInf:"STREAM-INF",isComment:function(i){return i&&i[0]==="#"&&!i.startsWith(ve.tagPrefix)},isBlank:function(i){return i===""},canStrip:function(i){return ve.isBlank(i)||ve.isComment(i)}},Pe=0,Se=1,Ae={file:void 0,name:void 0,start:0,end:0,discontinuity:void 0,duration:void 0},De=function(){function i(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};g()(this,i),h()(this,"source",""),h()(this,"segments",[]),h()(this,"_currentSegment",null),h()(this,"discontinuous",null),h()(this,"tags",{VERSION:void 0,TARGETDURATION:void 0}),h()(this,"_state",null),this.source=n,this.options=e,this.parse(this.source)}return k()(i,[{key:"readSegment",value:function(n){var e=ve.segmentParse.exec(n);if(e!==null){var t=parseFloat(e[1],10),r=e[3];t%1!=0&&this.tags.VERSION>=3&&le.info("readsegment","Version must be 3 or higher to support floating.","duration:",t),t<this.tags.TARGETDURATION&&le.info("readsegment","Segment duration must be less than the TARGETDURATION","duration:",t),t*=1e3,this._currentSegment=Object.assign({},Ae,{duration:t,name:r,discontinuity:this.discontinuous});var a=this.segments[this.segments.length-1]||{start:0,end:0};this._currentSegment.start=a.end,this._currentSegment.end=a.end+t,this.discontinuous=!1,this._state=Se}else le.warn("readsegment","read segment failed","line:",n)}},{key:"readTag",value:function(n){var e=ve.tagParse.exec(n);if(e!==null)return{name:e[1],value:e[3]}}},{key:"readLine",value:function(n){if(n.startsWith(ve.segmentPrefix))return this.readSegment(n);var e=this.readTag(n);if(e)switch(e.name){case ve.version:this.tags.VERSION=parseFloat(e.value,10);break;case ve.mediaSequence:this.tags.MEDIA_SEQUENCE=parseFloat(e.value,10);break;case ve.allowCache:this.tags.ALLOW_CACHE=!!/\s*(YES|yes)\s*/.test(e.value);break;case ve.discontinuity:this.tags.DISCONTINUITY=!0,this.discontinuous=!0;break;case ve.targetDuration:this.tags.TARGETDURATION=parseFloat(e.value,10);break;case ve.combined:this.tags.COMBINED=e.value;break;case ve.streamInf:this.tags.STREAM_INF=e.value;break;case ve.endList:this.tags.ENDLIST="EOF";break;default:le.warn("readLine","unknow line","line:",n)}}},{key:"addFile",value:function(n){if(n[0]!=="#"){this._currentSegment.file=n;var e=this.parseSDParam(n);if(e>=0){this._currentSegment.start=e,this._currentSegment.end=e+this._currentSegment.duration;var t=this.segments[this.segments.length-1]||{sd:0,start:0,end:0};t.duration=e-t.start,t.end=e}this._currentSegment.name||(this._currentSegment.name=n.substr(Math.max(0,n.lastIndexOf("/")),n.lastIndexOf("."))),this.segments.push(this._currentSegment),this._state=Pe}else{var r=this.readTag(n);switch(r.name){case"PROGRAM-DATE-TIME":var a=new Date(r.value);this._currentSegment.time=a;break;default:le.warn("addFile","Invalid tag.","tag.name:",r.name)}}}},{key:"parseSDParam",value:function(n){var e=-1;try{var t=new URL(n).searchParams.get("sd");t&&(e=parseInt(t,10))}catch(r){}return e}},{key:"parse",value:function(n){var e=this;if(typeof(n=n||this.source)=="string"){this._state=Pe,this.discontinuous=!1;var t=n.split(ve.lineDelimiter);if(t[0]==ve.extensionHeader)return t.forEach(function(r){if(!ve.canStrip(r))switch(e._state){case Pe:e.readLine(r);break;case Se:e.addFile(r);break;default:Object(M.a)("parsing m3u8 get an error, it is unknow state.")}}),this;le.error("parse","it is not a valid  m3u8 header","header:",t[0])}else Object(M.a)("m3u8 file is not text.",n)}},{key:"version",get:function(){return this.tags.VERSION}},{key:"duration",get:function(){return this.segments.length?this.segments.reduce(function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,t=typeof n=="number"?n:n.duration;return t+e.duration}):0}},{key:"targetDuration",get:function(){return this.tags.TARGETDURATION}},{key:"mediaSequence",get:function(){return this.tags.MEDIA_SEQUENCE}},{key:"allowCache",get:function(){return this.tags.ALLOW_CACHE}},{key:"length",get:function(){return this.segments.length}}]),i}(),Ce=m(45),He=m.n(Ce);function ft(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Object";return function(n){var e="[object "+i+"]";return Object.prototype.toString.call(n)==e}}var Ue=function(){function i(){g()(this,i)}return k()(i,null,[{key:"importScripts",value:function(n,e,t){var r="ready"+Date.now();n instanceof Array?He()(n,r):He()([n],r),He.a.ready(r,{success:e,error:t})}},{key:"blobData",value:function(n){var e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}},{key:"escapeHTML",value:function(n){if(i.isString(n))return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"getInnerWidthHeight",value:function(){return{width:window.innerWidth,height:window.innerHeight}}},{key:"Fullscreen",value:function(){var n=document.documentElement;n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&(n.webkitRequestFullScreen(),setTimeout(function(){console.error("fullscreen success"),document.dispatchEvent(new Event("fullscreenchange"))},0))}},{key:"exitFullscreen",value:function(){var n=document;n.exitFullscreen?n.exitFullscreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitExitFullscreen&&(n.webkitExitFullscreen(),setTimeout(function(){console.error("exitfullscreen success"),document.dispatchEvent(new Event("fullscreenchange"))},0))}},{key:"buildFilePath",value:function(n,e){return n.map(function(t){return e+t})}},{key:"insertSort",value:function(n,e,t){var r,a,l=n.length;if(l!==0)if(t){var f=t(e);r=f.key,a=f.value;for(var v=0;v<l;v++)if(a<n[v][r]){for(var w=l;w>v;)n[w]=n[w-1],w--;return void(n[v]=e)}n.push(e)}else{a=e;for(var A=0;A<l;A++)if(a<n[A]){for(var H=l;H>A;)n[H]=n[H-1],H--;return void(n[A]=a)}n.push(a)}else n.push(e)}},{key:"isSafari",value:function(){var n=navigator.userAgent;return/Safari/.test(n)&&!/Chrome/.test(n)}},{key:"msec2sec",value:function(n){var e=(n/1e3).toFixed(3);return parseFloat(e,10)}}]),i}();h()(Ue,"isObject",function(){return ft("Object")}),h()(Ue,"isString",function(){return ft("String")}),h()(Ue,"isFunction",function(){return ft("Function")});var wt=m(34),dt=m.n(wt),pt=function(i){function n(){return g()(this,n),L()(this,c()(n).call(this))}return T()(n,i),k()(n,[{key:"add",value:function(e){this.push(Object.freeze(e))}},{key:"addAll",value:function(e){var t=this;e.forEach(function(r){t.add(r)})}},{key:"get",value:function(e){return this[e]}},{key:"getLast",value:function(){return this[this.length-1]}},{key:"getBy",value:function(e){var t=this;if(typeof e=="function"){var r=new this.constructor;return this.every(function(a,l){return e.call(t,a,l,t)===!0&&r.add(a),!0}),r}}},{key:"indexOfByTime",value:function(e,t){t||(t=function(v){return e>=v.start&&e<v.end});for(var r=this.length-1,a=0;a<=r;){var l=Math.floor((r+a)/2),f=this[l];if(t(f))return l;f.start>e?r=l-1:a=l+1}return-1}},{key:"getByTime",value:function(e){var t=this.indexOfByTime(e);if(t>=0)return this[t]}},{key:"getByKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])&&(t=t[0]),this.getBy(function(a){var l=!1;return t.every(function(f){return!Object.prototype.hasOwnProperty.call(a,f)||(l=!0,!1)}),l})}},{key:"getByValue",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])&&(t=t[0]),this.getBy(function(a){var l=!1;return a.each(function(f,v){if(t.includes(v))return l=!0,!1}),l})}},{key:"getByKeyValue",value:function(e,t){return this.getBy(function(r){return r[e]===t})}},{key:"getValues",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])&&(t=t[0]),this.map(function(a){return t.length?a.get(a,t):a.getValues(a)})}},{key:"indexOfBy",value:function(e){var t=0,r=this.length;for(e=e||function(){return!1};t<r;){if(e.call(this,this[t],t,this)===!0)return t;t++}return-1}},{key:"indexOfByKey",value:function(e,t){return this.indexOfBy(function(r){return r[e]===t})}},{key:"indexOfByKeyValue",value:function(e,t){return this.indexOfByKey(e,t)}},{key:"each",value:function(e){if(typeof e=="function")return this.forEach(e),this}},{key:"remove",value:function(e,t){return this.length<=0?this:(e=e<0?0:e,t=t||e+1,this.splice(e,t-e),this)}},{key:"removeItem",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Array.isArray(t[0])&&(t=t[0]),this.removeBy(function(a){return t.includes(a)})}},{key:"removeBy",value:function(e){for(var t=0,r=this.length;t<r;t++)e.call(this,this[t],t,this)===!0&&(this.splice(t,1),r--,t--);return this}},{key:"removeByKeyValue",value:function(e,t){return this.removeBy(function(r){return r[e]===t})}},{key:"toJSON",value:function(){var e=Array.from(this);return e.forEach(function(t,r){e[r]=t&&typeof t.toJSON=="function"?t.toJSON():t}),e}},{key:"toArray",value:function(){return Array.from(this)}},{key:"size",get:function(){return this.length}}]),n}(dt()(Array)),Pt=function(){function i(){g()(this,i)}return k()(i,[{key:"pair",value:function(){return Object.entries(this)}},{key:"keys",value:function(){return Object.keys(this)}},{key:"set",value:function(n,e){return this[n]=e,this}},{key:"get",value:function(n){return this[n]}},{key:"add",value:function(n,e){return Object.prototype.hasOwnProperty.call(this,n)||this.set(n,e),this}},{key:"addAll",value:function(n){for(var e in n)this.add(e,n[e]);return this}},{key:"toJSON",value:function(){var n={};for(var e in this)Object.prototype.hasOwnProperty.call(this,e)&&(n[e]=this[e]);return n}}]),i}(),_t=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"no",0),h()(p()(t),"name",null),h()(p()(t),"duration",0),h()(p()(t),"file",null),h()(p()(t),"start",0),h()(p()(t),"end",0),Object.assign(p()(t),e),t}return T()(n,i),n}(Pt),gn=function(i){function n(e){return g()(this,n),L()(this,c()(n).call(this,e))}return T()(n,i),k()(n,[{key:"add",value:function(e){e instanceof _t||(e=new _t(e)),e.no=this.length+1,Ue.isObject(e)&&this.push(e)}}]),n}(pt),B={ProcessorResetEnd:"DataProcessorController.processorResetEnd",DataProcessorReady:"DataProcessorController.dataProcessorReady",DecodeStartDecode:"DecodeController.startDecode",DecodeFlush:"DecodeController.flush",DecodeDecoded:"DecodeController.decoded",DecodeApppendEnd:"DecodeController.appendEnd",DecodeFlushEnd:"DecodeController.flushEnd",DecodeReady:"DecodeController.ready",DemuxResetEnd:"DemuxController.resetEnd",DemuxStartDemux:"DemuxController.startDemux",DemuxLast:"DemuxController.last",DemuxVideo:"DemuxController.video",DemuxAAC:"DemuxController.AAC",DemuxReady:"DemuxController.ready",ImagePlayerRenderEnd:"ImagePlayer.renderEnd",ImagePlayerWait:"ImagePlayer.wait",ImagePlayerReady:"ImagePlayer.ready",ImagePlayerEnd:"ImagePlayer.end",ImagePlayerBuffeUpdate:"ImagePlayer.bufferUpdate",ControlBarPlay:"ControlBar.onPlay",ControlBarPause:"ControlBar.onPause",ControlBarPauseLoading:"ControlBar.onPauseLoading",LoadDataReadBufferByNo:"LoadData.readBufferByNo",LoadDataReadBuffer:"LoadData.readBuffer",LoadDataRead:"LoadData.onRead",LoadDataSeek:"LoadData.onSeek",LoadDataFirstLoaded:"LoadData.onFirstLoaded",LoaderPlayListStart:"Loader.playlistStart",LoaderLoading:"Loader.onLoading",LoaderError:"Loader.onError",LoaderLoaded:"Loader.onLoaded",LoaderUpdateSpeed:"Loader.updateSpeed",LoaderLoadFile:"Loader.loadFile",LoaderPlayListLoaded:"Loader.playlistLoaded",AudioPlayerReady:"AudioPlayer.MSEReady",AudioPlayerDataReady:"AudioPlayer.dataReady",AudioPlayerWait:"AudioPlayer.wait",AudioPlayerEnd:"AudioPlayer.end",AudioPlayerPlaySuccess:"AudioPlayer.playSuccess",AudioPlayerPlayFail:"AudioPlayer.playFail",PlayerMaxPTS:"DemuxController.maxpts",PlayerSeekEnd:"Player.seekend",PlayerSpeedTo:"Player.speedTo",PlayerChangeRate:"Player.changeRate",PlayerChangeSrc:"Player.changeSrc",PlayerPlaying:"Player.playing",PlayerTimeUpdate:"Player.timeUpdate",PlayerbufferUpdate:"Player.bufferupdate",PlayerResetReady:"Player.resetReady",PlayerWait:"Player.wait",PlayerLoadNext:"Player.loadNext",PlayerOnPlay:"Player.onPlay",PlayerOnPause:"Player.onPause",PlayerOnSeek:"Player.onSeek",PlayerOnVolume:"Player.onVolume",PlayerReady:"Player.ready",PlayerPlay:"Player.play",PlayerReset:"Player.reset",PlayerLoadedMetaData:"Player.loadedMetaData",PlayerEnd:"Player.end",PlayerPause:"Player.pause",PlayerSeeking:"Player.seeking",PlayerAlert:"Player.alert",PlayerThrowError:"Player.throwError",StreamDataReady:"StreamController.dataReady"};function Ne(i,n){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(i);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),e.push.apply(e,t)}return e}var nt,Ke,Oe={HLS:function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this)),h()(p()(t),"state",pe.IDLE),h()(p()(t),"maxBufferDuration",Q.b.maxDuration),h()(p()(t),"maxBufferSize",Q.b.maxSize),h()(p()(t),"baseUrl",""),h()(p()(t),"options",null),h()(p()(t),"httpWorker",null),h()(p()(t),"sourceData",null),h()(p()(t),"segmentPool",[]),h()(p()(t),"currentNo",null),h()(p()(t),"maxRetryCount",Q.b.maxRetryCount),t.options=e,t.loaderController=t.options.loaderController,t.dataController=t.loaderController.dataController,t.httpWorker=e.httpWorker,t.setSegmentPool(new gn),t}return T()(n,i),k()(n,[{key:"loadPlaylist",value:function(e){var t=this;this.httpWorker.postMessage({type:"invoke",fileType:"m3u8",method:"get",name:"playlist",url:this.sourceURL}),this.httpWorker.onmessage=function(r){var a=r.data,l=r.data.data;if(l)a.name=="playlist"&&t.parsePlaylist(l,e);else{var f="Get the ".concat(a.fileType," file error. URL: ").concat(a.url);t.events.emit(B.PlayerAlert,f),t.events.emit(B.LoaderError,f,a);var v=[t.state,"request playlist error.","data:",a,f];t.events.emit(B.PlayerThrowError,v)}}}},{key:"parsePlaylist",value:function(e,t){var r=new De(e);if(r.segments&&r.segments.length)r.segments.forEach(function(l){l.start=Ue.msec2sec(l.start),l.end=Ue.msec2sec(l.end),l.duration=Ue.msec2sec(l.duration)}),this.setSourceData(Object.freeze(r)),this.segmentPool.addAll(r.segments),t.call(this,r);else{this.events.emit(B.LoaderError,r),this.events.emit(B.PlayerAlert,"Parse playlist file error.");var a=[this.state,"Parse playlist error.","data:",r];this.events.emit(B.PlayerThrowError,a)}}},{key:"setSourceData",value:function(e){this.sourceData=e}},{key:"getSourceData",value:function(){return this.sourceData}},{key:"setSegmentPool",value:function(e){this.segmentPool=e}},{key:"getSegmentPool",value:function(){return this.segmentPool}},{key:"isNotFree",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return e="["+e+"]loader is not free. please wait.",this.state!==pe.IDLE&&this.state!==pe.DONE&&(this.logger.warn("isNotFree","check status for loader","notice:",e),!0)}},{key:"getBaseUrl",value:function(e){var t=this.options.sourceURL;if(!(e.indexOf("//")>-1)){var r=t.lastIndexOf("/");return t.substr(0,r+1)}return""}},{key:"checkLoadCondition",value:function(e){return!(e.no>this.segmentPool.length)&&(!(this.dataController.getLoadDataBufferPool().bufferDuration>this.maxBufferDuration)||(this.logger.info("checkLoadCondition","stop load next segment.","bufferDuration:",this.dataController.getLoadDataBufferPool().bufferDuration,"maxBufferDuration:",this.maxBufferDuration),!1))}},{key:"loadFile",value:function(e,t,r){var a=this;if(e instanceof _t)if(this.isNotFree()&&t!=="seek"&&t!=="start")this.logger.warn("loadFile","is loading","segment:",e,"type:",t);else{if(!this.checkLoadCondition(e))return this.state=pe.IDLE,void this.logger.warn("loadFile","checkLoadCondition failed","segment:",e,"type:",t);this.currentNo=e.no;var l=this.getBaseUrl(e.file)+e.file,f=1,v=function(A,H){return typeof a.options.processURL=="function"?a.options.processURL(A,H):A},w=function(){a.httpWorker.postMessage({type:"invoke",fileType:"ts",method:"get",name:e.no,url:v(l,e)})};this.state=pe.LOADING,this.events.emit(B.LoaderLoading,e,t,r),this.httpWorker.onmessage=function(A){a.state=pe.DONE;var H=A.data;if(a.logger.info("loadfile","httpWorker","onmessage get data"),H&&H.type!=="error")H.type==="notice"?H.noticeType==="speed"&&a.events.emit(B.LoaderUpdateSpeed,H.data):H.fileType==="ts"&&H.name===e.no?(a.logger.info("loadFile","read success","data no:",H.name),a.state=pe.IDLE,a.events.emit(B.LoaderLoaded,H,e,t,r)):a.logger.warn("loadFile","is not ts file or the segment'no is not equal.","fileType:",H.fileType,"data:",H);else if(a.state=pe.ERROR,f<=a.maxRetryCount)a.logger.warn("loadFile","retry to load","count:",f,"segment:",e),w(),f+=1;else{a.events.emit(B.LoaderError,e,t,r),a.events.emit(B.PlayerAlert,"Load file error, please concat administrator.");var ce=[a.state,"Load File error.","load count:",f,"segment:",e];a.events.emit(B.PlayerThrowError,ce)}},w()}}},{key:"destroy",value:function(){this.httpWorker&&this.httpWorker.terminate()}}]),n}(ue)},rt=function(i){function n(e,t){var r;return g()(this,n),r=L()(this,c()(n).call(this)),h()(p()(r),"state",null),h()(p()(r),"exeLoader",null),h()(p()(r),"loadData",null),h()(p()(r),"type","HLS"),h()(p()(r),"options",null),h()(p()(r),"dataController",null),r.type=e||r.type,r.player=t.player,r.options=t.player.options,r.dataController=r.player.dataController,r.init(r.type,r.options),r}return T()(n,i),k()(n,[{key:"init",value:function(e,t){this.bindEvent(),this.setExeLoader(new Oe[e](function(r){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?Ne(Object(l),!0).forEach(function(f){h()(r,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Ne(Object(l)).forEach(function(f){Object.defineProperty(r,f,Object.getOwnPropertyDescriptor(l,f))})}return r}({},t,{player:this.player,loaderController:this}))),this.setSourceURL(t.sourceURL),this.player.loadData?this.setLoadData(this.player.loadData):this.setLoadData(this.dataController.getDataInstance("load",t)),this.exeLoader.setLoadData(this.loadData)}},{key:"run",value:function(){this.state=pe.LOAD_PLAYLIST,this.events.emit(B.LoaderPlayListStart,this),this.logger.info("run",pe[this.state],"url:",this.options.sourceURL),this.loadPlaylist()}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.LoaderLoadFile,function(t,r,a){e.exeLoader.loadFile(t,r,a)})}},{key:"loadPlaylist",value:function(e){var t=this;this.exeLoader.loadPlaylist(function(r){r?(t.dataController.setLoadDataSourceData(t.exeLoader.getSourceData()),t.dataController.setLoadDataSegmentPool(t.exeLoader.getSegmentPool()),t.state=pe.LOADED_PLAYLIST,t.events.emit(B.LoaderPlayListLoaded,t),typeof e=="function"&&e.call(t,r)):t.logger.error("run","start load m3u8","data:",r)})}},{key:"switchPlaylist",value:function(e,t){this.setSourceURL(e),this.dataController.clearLoadData(),this.state=pe.LOAD_PLAYLIST,this.events.emit(B.LoaderPlayListStart,this),this.logger.info("switchPlaylist",pe[this.state],"url:",e),this.loadPlaylist(t)}},{key:"setExeLoader",value:function(e){this.exeLoader=e}},{key:"getExeLoader",value:function(){return this.exeLoader}},{key:"setSourceURL",value:function(e){this.exeLoader.setSourceURL(e)}},{key:"getSourceURL",value:function(){return this.exeLoader.getSourceURL()}},{key:"setLoadData",value:function(e){this.loadData=e}},{key:"getLoadData",value:function(){return this.loadData}},{key:"getSourceData",value:function(){return this.exeLoader.getSourceData()}},{key:"destroy",value:function(){this.exeLoader.destroy()}}]),n}(D),xt=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"no",0),h()(p()(t),"start",0),h()(p()(t),"end",0),h()(p()(t),"blob",null),h()(p()(t),"arrayBuffer",null),h()(p()(t),"duration",0),Object.assign(p()(t),e),t}return T()(n,i),k()(n,[{key:"size",get:function(){return this.blob.size}}]),n}(Pt),mn=function(i){function n(e){return g()(this,n),L()(this,c()(n).call(this,e))}return T()(n,i),k()(n,[{key:"add",value:function(e){e instanceof xt||(e=new xt(e));var t=this.length;if(t!==0){for(;t--;)if(e.no<=this[t].no)return void this.splice(t,1,e);return this.push(e),this}this.push(e)}},{key:"getBufferSize",value:function(){return this.length<=0?0:this.reduce(function(e,t){return isNaN(e)&&(e=e.blob.size),e+t.blob.size})}},{key:"getBufferDuration",value:function(){return this.length<=0?0:this.reduce(function(e,t){return isNaN(e)&&(e=e.end-e.start),e+(t.end-t.start)})}},{key:"bufferSize",get:function(){return this.getBufferSize()}},{key:"bufferDuration",get:function(){return this.getBufferDuration()}}]),n}(pt),Bt=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this)),h()(p()(e),"bufferPool",[]),h()(p()(e),"sourceData",{}),h()(p()(e),"options",{}),h()(p()(e),"segmentPool",[]),h()(p()(e),"readBufferNo",null),h()(p()(e),"startLoadTime",null),h()(p()(e),"currentSeekTime",null),e.options=t,e.init(),e}return T()(n,i),k()(n,[{key:"init",value:function(){var e=this;this.setBufferPool(new mn),this.events.on(B.LoadDataReadBufferByNo,function(t,r){e.readBufferByNo(t,r)}),this.events.on(B.LoadDataReadBuffer,function(t,r){e.readBuffer(t,r)}),this.events.on(B.LoaderLoaded,function(t,r,a,l){var f=e.createBuffer({arrayBuffer:t.arrayBuffer},r);if(e.segmentLoaded(r,f),a==="seek"&&l===e.currentSeekTime)return e.events.emit(B.LoadDataSeek,f,l),void e.removeBufferByNo(f.no);l===e.startLoadTime&&e.events.emit(B.LoadDataFirstLoaded,f,l)})}},{key:"setOptions",value:function(e){Object.assign(this.options,e)}},{key:"startLoad",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.logger.info("startLoad","begin to load ts data","time:",e),isNaN(e)?this.logger.error("seekTime","seek","time:",e):(this.startLoadTime=e,this.loadSegmentByTime(e,"start"))}},{key:"readBuffer",value:function(e,t){var r=this.getSegmentByTime(e);r&&this.readBufferByNo(r.no,t)}},{key:"segmentLoaded",value:function(e,t){t&&this.addBufferPool(t),e.no===this.options.player.currentIndex&&this.readBufferByNo(e.no),e.no<this.segmentPool.getLast().no&&this.loadSegmentByNo(e.no+1)}},{key:"seekTime",value:function(e){if(isNaN(e))this.logger.error("seekTime","seek","time:",e);else{var t;this.currentSeekTime=e;var r=this.bufferPool.indexOfByTime(e);r>-1?(t=this.bufferPool[r],this.events.emit(B.LoadDataSeek,t,e)):(this.removeBufferPool(this.bufferPool.length),this.loadSegmentByTime(e,"seek"))}}},{key:"loadSegmentByTime",value:function(e,t){if(!isNaN(e)){var r=this.segmentPool.indexOfByTime(e);if(r>=0){var a=this.segmentPool[r];this.events.emit(B.LoaderLoadFile,a,t,e)}else this.logger.error("loadSegmentByTime","time over","time:",e,"type:",t)}}},{key:"createBuffer",value:function(e,t){if(e){var r={start:t.start,end:t.end,no:t.no,duration:t.end-t.start,arrayBuffer:e.arrayBuffer};return new xt(r)}}},{key:"isValidSegmentNo",value:function(e){return!isNaN(e)&&e>0&&e<=this.segmentPool.length}},{key:"loadSegmentByNo",value:function(e){var t=e-1,r=this.segmentPool.get(t);r&&this.events.emit(B.LoaderLoadFile,r,"play")}},{key:"readBufferByNo",value:function(e,t){this.isValidSegmentNo(e)?(this.readBufferNo=e,t=t||function(r){this.events.emit(B.LoadDataRead,r)},this.getBlobByNo(e,t)):this.logger.error("readBufferByNo","check buffer no","is not valid no",e)}},{key:"getSegmentByTime",value:function(e){var t=this.segmentPool.indexOfByTime(e);return this.segmentPool[t]}},{key:"getBlobByNo",value:function(e,t){if(isNaN(e))this.logger.error("getBlobByNo","isNaN","no:",e);else{var r;if(!this.isBufferReading)return this.isBufferReading=!0,r=this.bufferPool.getByKeyValue("no",e)[0],typeof t=="function"&&(t.call(this,r),r&&this.removeBufferByNo(r.no)),this.isBufferReading=!1,r;this.logger.warn("getBlobByNo","isBufferReading","no:",e)}}},{key:"addBufferPool",value:function(e){if(this.bufferPool.length){if(this.bufferPool[0].no===e.no+1)return this.bufferPool.unshift(e),!0;var t=this.bufferPool.getLast();if(e.no-t.no==1)return this.bufferPool.push(e),!0;if(this.bufferPool.indexOfByKey("no",e.no))return!0;this.bufferPool.splice(0,this.bufferPool.length)}this.bufferPool.push(e)}},{key:"removeBufferPool",value:function(e){this.bufferPool.splice(0,e+1)}},{key:"removeBufferByNo",value:function(e){var t=this.bufferPool.indexOfByKey("no",e);if(!(t<=-1))return this.removeBufferPool(t),this.bufferPool.length?this.bufferPool.getLast().no<this.segmentPool.getLast().no&&this.loadSegmentByNo(this.bufferPool.getLast().no+1):e<this.segmentPool.getLast().no&&this.loadSegmentByNo(e+1),!0}},{key:"clear",value:function(){this.sourceData={},this.readBufferNo=null,this.currentSeekTime=null,this.bufferPool.length=0,this.segmentPool.length=0}},{key:"getSegmentByNo",value:function(e){return this.segmentPool.get(e-1)}},{key:"getSegment",value:function(e){return this.segmentPool.getByTime(e)}},{key:"setSourceData",value:function(e){this.sourceData=e}},{key:"getSourceData",value:function(){return this.sourceData}},{key:"setBufferPool",value:function(e){this.bufferPool=e}},{key:"getBufferPool",value:function(){return this.bufferPool}},{key:"setSegmentPool",value:function(e){this.segmentPool=e}},{key:"getSegmentPool",value:function(){return this.segmentPool}}]),n}(z),it=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this)),h()(p()(t),"loadData",null),t.options=e,t}return T()(n,i),k()(n,[{key:"setLoadData",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.loadData=x()(Bt,t)}},{key:"getLoadData",value:function(){return this.loadData}},{key:"getLoadDataBufferPool",value:function(){return this.loadData.bufferPool}},{key:"setLoadDataSourceData",value:function(e){this.loadData.setSourceData(e)}},{key:"setLoadDataSegmentPool",value:function(e){this.loadData.setSegmentPool(e)}},{key:"startLoad",value:function(e){e=Math.max(e,0),this.startLoadData(e)}},{key:"startLoadData",value:function(e){this.loadData.startLoad(e)}},{key:"clearLoadData",value:function(){this.loadData.clear()}},{key:"getDataInstance",value:function(e){if(e)switch(e){case"load":if(!this.loadData){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];this.setLoadData.apply(this,r)}return this.loadData;default:return null}}}]),n}(D),bn=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"checkHanlder",null),h()(p()(t),"resetStatus",{processor:!1,audioPlayer:!1}),t.player=e.player,t.player?(t.audioPlayer=e.audioPlayer,t.imagePlayer=e.imagePlayer,t.loadData=e.loadData,t.bindEvent(),t):L()(t)}return T()(n,i),k()(n,[{key:"bindEvent",value:function(){var e=this;this.events.on(B.ProcessorResetEnd,function(){e.checkResetReady("processor")}),this.events.on(B.AudioPlayerReady,function(){e.checkResetReady("audioPlayer")}),this.events.on(B.PlayerResetReady,function(){e.onResetReady()}),this.events.on(B.LoadDataSeek,function(t,r){e.onSeek(t,r)}),this.events.on(B.ImagePlayerRenderEnd,function(t){e.onRenderEnd(t)}),this.events.on(B.ImagePlayerWait,function(){e.audioPlayer.pause()})}},{key:"play",value:function(e){this.logger.warn("play","play start"),this.sync(e)}},{key:"sync",value:function(e){var t=this.player,r=this.audioPlayer,a=this.imagePlayer,l=r.offset,f=a.offset,v=Math.min(l,f),w=Math.max(l,f),A=t.playbackRate;if(t.seeking&&(t.seeking=!1),!t.reseting&&t.status!=="pause"&&r.status!=="waiting"&&a.status!=="wait")if(t.status!=="end"){if(this.setCurrentTime(e),!(e<v))return e>=l&&e<=f?(this.events.once(B.AudioPlayerPlaySuccess,function(){a.render(f)}),r.playbackRate=A,void r.play()):void(e>=f&&e<=l?a.render(e):e>w&&(this.audioPlayer.playbackRate=A,this.audioPlayer.play(),a.render(e)));this.sync(v)}else r.paused||r.pause()}},{key:"setCurrentTime",value:function(e){this.player.currentTime=e,this.events.emit(B.PlayerTimeUpdate,e)}},{key:"pause",value:function(){this.audioPlayer.pause(),this.clearDrawHanlder()}},{key:"seek",value:function(e){var t=this,r=this.imagePlayer.isBuffered(e),a=this.audioPlayer.isBuffered(e);this.player.pause(),r&&a?(this.logger.warn("seek","seek in buffer, time: ".concat(e,", buffer: ").concat(this.player.buffer()[0],", ").concat(this.player.buffer()[1])),this.audioPlayer.onSeekedHandler=function(){t.player.play()},this.audioPlayer.currentTime=e):this.reset()}},{key:"reset",value:function(e){this.logger.info("reset","reset start"),this.player.reseting=!0,this.events.emit(B.PlayerReset,e),this.resetStatus={processor:!1,audioPlayer:!1},this.player.processController.reset(),this.player.streamController.reset(),this.player.audioPlayer.reset(e),this.player.imagePlayer.reset(),this.player.currentIndex=null}},{key:"checkResetReady",value:function(e){var t=this.resetStatus;if(e&&typeof e=="string"){t[e]=!0;for(var r=Object.keys(t),a=0;a<r.length;a++)if(!t[r[a]])return!1;this.logger.warn("checkResetReady","reset ready"),this.events.emit(B.PlayerResetReady)}}},{key:"onResetReady",value:function(){this.player.reseting=!1,this.logger.info("onResetReady","reset Ready"),this.player.changing&&this.events.emit(B.DataProcessorReady),this.player.seeking&&this.player.loadData.seekTime(this.player.currentTime/1e3)}},{key:"onSeek",value:function(e,t){var r=this.player.currentTime;this.logger.info("onseek",r,e,e.no,t),e&&e.no&&Math.abs(r-Math.floor(1e3*t))<2?(this.player.currentIndex=e.no,this.logger.info("seektime:",e.no,t,this.player.currentTime),this.player.seekSegmentNo=e.no,this.player.streamController.startLoad(e.no)):this.logger.warn("seek failue, not found data",r,e,t)}},{key:"clearDrawHanlder",value:function(){clearTimeout(this.drawFrameHanlder),this.drawFrameHanlder=null}},{key:"onRenderEnd",value:function(){this.player.seekTime&&(this.logger.info("onRenderEnd","seektoRenderTime:",Date.now()-this.player.seekTime),this.player.seekTime=null);var e=this.imagePlayer,t=this.audioPlayer,r=this.player.playbackRate,a=t.currentTime,l=e.currentTime,f=t.offset,v=e.fragDuration,w=a-l,A=0;l<f?this.drawNext(l+v*r,v):(w>0&&w>v?v=(A=l+Math.ceil(w/v+r)*v)-a:(A=l+v*r,v-=w),this.drawNext(A,v))}},{key:"drawNext",value:function(e,t){var r=this;this.drawFrameHanlder&&this.clearDrawHanlder(),this.drawFrameHanlder=setTimeout(function(){r.sync(e)},t)}}]),n}(z);function Ge(i){if(nt){for(var n=arguments.length,e=new Array(n>1?n-1:0),t=1;t<n;t++)e[t-1]=arguments[t];nt.apply(void 0,[i].concat(e))}}function Qe(i){if(Ke){for(var n=arguments.length,e=new Array(n>1?n-1:0),t=1;t<n;t++)e[t-1]=arguments[t];Ke.apply(void 0,[i].concat(e))}}var Fe=function(){function i(n){g()(this,i),this.payload=n,this.nri=(96&this.payload[0])>>5,this.ntype=31&this.payload[0]}return k()(i,null,[{key:"type",value:function(n){return n.ntype in i.TYPES?i.TYPES[n.ntype]:"UNKNOWN"}},{key:"NDR",get:function(){return 1}},{key:"IDR",get:function(){return 5}},{key:"SEI",get:function(){return 6}},{key:"SPS",get:function(){return 7}},{key:"PPS",get:function(){return 8}},{key:"AUD",get:function(){return 9}},{key:"TYPES",get:function(){var n;return n={},h()(n,i.IDR,"IDR"),h()(n,i.SEI,"SEI"),h()(n,i.SPS,"SPS"),h()(n,i.PPS,"PPS"),h()(n,i.NDR,"NDR"),h()(n,i.AUD,"AUD"),n}}]),k()(i,[{key:"toString",value:function(){return"".concat(i.type(this),": NRI: ").concat(this.getNri())}},{key:"getNri",value:function(){return this.nri>>6}},{key:"type",value:function(){return this.ntype}},{key:"isKeyframe",value:function(){return this.ntype==i.IDR}},{key:"getSize",value:function(){return 4+this.payload.byteLength}},{key:"getData",value:function(){var n=new Uint8Array(this.getSize());return new DataView(n.buffer).setUint32(0,this.getSize()-4),n.set(this.payload,4),n}}]),i}(),kn=function(){function i(n){g()(this,i),this.data=n,this.index=0,this.bitLength=8*n.byteLength}return k()(i,[{key:"skipBits",value:function(n){if(this.bitsAvailable<n)return!1;this.index+=n}},{key:"readBits",value:function(n){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],t=this.getBits(n,this.index,e);return t}},{key:"getBits",value:function(n,e){var t=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(this.bitsAvailable<n)return 0;var r=e%8,a=this.data[e/8|0]&255>>>r,l=8-r;if(l>=n)return t&&(this.index+=n),a>>l-n;t&&(this.index+=l);var f=n-l;return a<<f|this.getBits(f,e+l,t)}},{key:"skipLZ",value:function(){var n;for(n=0;n<this.bitLength-this.index;++n)if(this.getBits(1,this.index+n,!1)!==0)return this.index+=n,n;return n}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var n=this.skipLZ();return this.readBits(n+1)-1}},{key:"readEG",value:function(){var n=this.readUEG();return 1&n?1+n>>>1:-1*(n>>>1)}},{key:"readBoolean",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.readBits(8*n)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"bitsAvailable",get:function(){return this.bitLength-this.index}}]),i}(),Ht=function(){function i(n){g()(this,i),this.remuxer=n,this.track=n.mp4track}return k()(i,null,[{key:"extractNALu",value:function(n){for(var e,t,r=0,a=n.byteLength,l=0,f=[];r<a;)switch(e=n[r++],l){case 0:e===0&&(l=1);break;case 1:l=e===0?2:0;break;case 2:case 3:e===0?l=3:(e===1&&r<a&&(t&&f.push(n.subarray(t,r-l-1)),t=r),l=0)}return t&&f.push(n.subarray(t,a)),f}},{key:"skipScalingList",value:function(n,e){for(var t=8,r=8,a=0;a<e;a++)r!==0&&(r=(t+n.readEG()+256)%256),t=r===0?t:r}},{key:"readSPS",value:function(n){var e,t,r,a,l,f,v=new kn(n),w=0,A=0,H=0,ce=0,ye=1;if(v.readUByte(),e=v.readUByte(),v.readBits(5),v.skipBits(3),v.readUByte(),v.skipUEG(),e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128){var _e=v.readUEG();if(_e===3&&v.skipBits(1),v.skipUEG(),v.skipUEG(),v.skipBits(1),v.readBoolean()){f=_e!==3?8:12;for(var xe=0;xe<f;++xe)v.readBoolean()&&(xe<6?i.skipScalingList(v,16):i.skipScalingList(v,64))}}v.skipUEG();var Ee=v.readUEG();if(Ee===0)v.readUEG();else if(Ee===1){v.skipBits(1),v.skipEG(),v.skipEG(),t=v.readUEG();for(var Me=0;Me<t;++Me)v.skipEG()}if(v.skipUEG(),v.skipBits(1),r=v.readUEG(),a=v.readUEG(),(l=v.readBits(1))===0&&v.skipBits(1),v.skipBits(1),v.readBoolean()&&(w=v.readUEG(),A=v.readUEG(),H=v.readUEG(),ce=v.readUEG()),v.readBoolean()){if(v.readBoolean()){var ge;switch(v.readUByte()){case 1:ge=[1,1];break;case 2:ge=[12,11];break;case 3:ge=[10,11];break;case 4:ge=[16,11];break;case 5:ge=[40,33];break;case 6:ge=[24,11];break;case 7:ge=[20,11];break;case 8:ge=[32,11];break;case 9:ge=[80,33];break;case 10:ge=[18,11];break;case 11:ge=[15,11];break;case 12:ge=[64,33];break;case 13:ge=[160,99];break;case 14:ge=[4,3];break;case 15:ge=[3,2];break;case 16:ge=[2,1];break;case 255:ge=[v.readUByte()<<8|v.readUByte(),v.readUByte()<<8|v.readUByte()]}ge&&(ye=ge[0]/ge[1])}v.readBoolean()&&v.skipBits(1),v.readBoolean()&&(v.skipBits(4),v.readBoolean()&&v.skipBits(24)),v.readBoolean()&&(v.skipUEG(),v.skipUEG()),v.readBoolean()&&(v.readUInt(),v.readUInt(),v.readBoolean())}return{width:Math.ceil((16*(r+1)-2*w-2*A)*ye),height:(2-l)*(a+1)*16-(l?2:4)*(H+ce)}}}]),k()(i,[{key:"parseSPS",value:function(n){var e=i.readSPS(new Uint8Array(n));this.track.width=e.width,this.track.height=e.height,this.track.sps=[new Uint8Array(n)],this.track.codec="avc1.";for(var t=new DataView(n.buffer,n.byteOffset+1,4),r=0;r<3;++r){var a=t.getUint8(r).toString(16);a.length<2&&(a="0"+a),this.track.codec+=a}}},{key:"parsePPS",value:function(n){this.track.pps=[new Uint8Array(n)]}},{key:"parseNAL",value:function(n){if(!n)return!1;var e=!1;switch(n.type()){case Fe.NDR:case Fe.IDR:e=!0;break;case Fe.PPS:this.track.pps||(this.parsePPS(n.getData().subarray(4)),!this.remuxer.readyToDecode&&this.track.pps&&this.track.sps&&(this.remuxer.readyToDecode=!0)),e=!0;break;case Fe.SPS:this.track.sps||(this.parseSPS(n.getData().subarray(4)),!this.remuxer.readyToDecode&&this.track.pps&&this.track.sps&&(this.remuxer.readyToDecode=!0)),e=!0;break;case Fe.AUD:Ge("AUD - ignoing and disable HD mode for live channel"),this.remuxer.isHDAvail&&(this.remuxer.isHDAvail=!1);break;case Fe.SEI:Ge("SEI - ignoing")}return e}}]),i}(),at=function(){function i(n){g()(this,i),this.listener={},this.type=""|n}return k()(i,[{key:"on",value:function(n,e){return this.listener[n]||(this.listener[n]=[]),this.listener[n].push(e),!0}},{key:"off",value:function(n,e){if(this.listener[n]){var t=this.listener[n].indexOf(e);return t>-1&&this.listener[n].splice(t,1),!0}return!1}},{key:"offAll",value:function(){this.listener={}}},{key:"dispatch",value:function(n,e){return!!this.listener[n]&&(this.listener[n].map(function(t){t.apply(null,[e])}),!0)}}]),i}(),Re=Math.pow(2,32)-1,me=function(){function i(){g()(this,i)}return k()(i,null,[{key:"init",value:function(){var n;for(n in i.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},i.types)i.types.hasOwnProperty(n)&&(i.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);i.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);i.STTS=i.STSC=i.STCO=a,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var l=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),v=new Uint8Array([0,0,0,1]);i.FTYP=i.box(i.types.ftyp,l,v,l,f),i.DINF=i.box(i.types.dinf,i.box(i.types.dref,r))}},{key:"box",value:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];for(var a,l=8,f=t.length,v=f;f--;)l+=t[f].byteLength;for((a=new Uint8Array(l))[0]=l>>24&255,a[1]=l>>16&255,a[2]=l>>8&255,a[3]=255&l,a.set(n,4),f=0,l=8;f<v;++f)a.set(t[f],l),l+=t[f].byteLength;return a}},{key:"hdlr",value:function(n){return i.box(i.types.hdlr,i.HDLR_TYPES[n])}},{key:"mdat",value:function(n){return i.box(i.types.mdat,n)}},{key:"mdhd",value:function(n,e){e*=n;var t=Math.floor(e/(Re+1)),r=Math.floor(e%(Re+1));return i.box(i.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(n){return i.box(i.types.mdia,i.mdhd(n.timescale,n.duration),i.hdlr(n.type),i.minf(n))}},{key:"mfhd",value:function(n){return i.box(i.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]))}},{key:"minf",value:function(n){return n.type==="audio"?i.box(i.types.minf,i.box(i.types.smhd,i.SMHD),i.DINF,i.stbl(n)):i.box(i.types.minf,i.box(i.types.vmhd,i.VMHD),i.DINF,i.stbl(n))}},{key:"moof",value:function(n,e,t){return i.box(i.types.moof,i.mfhd(n),i.traf(t,e))}},{key:"moov",value:function(n,e,t){for(var r=n.length,a=[];r--;)a[r]=i.trak(n[r]);return i.box.apply(null,[i.types.moov,i.mvhd(t,e)].concat(a).concat(i.mvex(n)))}},{key:"mvex",value:function(n){for(var e=n.length,t=[];e--;)t[e]=i.trex(n[e]);return i.box.apply(null,[i.types.mvex].concat(t))}},{key:"mvhd",value:function(n,e){e*=n;var t=Math.floor(e/(Re+1)),r=Math.floor(e%(Re+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i.box(i.types.mvhd,a)}},{key:"sdtp",value:function(n){var e,t,r=n.samples||[],a=new Uint8Array(4+r.length);for(t=0;t<r.length;t++)e=r[t].flags,a[t+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return i.box(i.types.sdtp,a)}},{key:"stbl",value:function(n){return i.box(i.types.stbl,i.stsd(n),i.box(i.types.stts,i.STTS),i.box(i.types.stsc,i.STSC),i.box(i.types.stsz,i.STSZ),i.box(i.types.stco,i.STCO))}},{key:"avc1",value:function(n){var e,t,r,a=[],l=[];for(e=0;e<n.sps.length;e++)r=(t=n.sps[e]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(t));for(e=0;e<n.pps.length;e++)r=(t=n.pps[e]).byteLength,l.push(r>>>8&255),l.push(255&r),l=l.concat(Array.prototype.slice.call(t));var f=i.box(i.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|n.sps.length].concat(a).concat([n.pps.length]).concat(l))),v=n.width,w=n.height;return i.box(i.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,255&v,w>>8&255,255&w,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,i.box(i.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(n){var e=n.config.byteLength,t=new Uint8Array(26+e+3);return t.set([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5,e]),t.set(n.config,26),t.set([6,1,2],26+e),t}},{key:"mp4a",value:function(n){var e=n.audiosamplerate;return i.box(i.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),i.box(i.types.esds,i.esds(n)))}},{key:"stsd",value:function(n){return n.type==="audio"?i.box(i.types.stsd,i.STSD,i.mp4a(n)):i.box(i.types.stsd,i.STSD,i.avc1(n))}},{key:"tkhd",value:function(n){var e=n.id,t=n.duration*n.timescale,r=n.width,a=n.height,l=Math.floor(t/(Re+1)),f=Math.floor(t%(Re+1));return i.box(i.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,l>>24,l>>16&255,l>>8&255,255&l,f>>24,f>>16&255,f>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(n,e){var t=i.sdtp(n),r=n.id,a=Math.floor(e/(Re+1)),l=Math.floor(e%(Re+1));return i.box(i.types.traf,i.box(i.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),i.box(i.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,l>>24,l>>16&255,l>>8&255,255&l])),i.trun(n,t.length+16+20+8+16+8+8),t)}},{key:"trak",value:function(n){return n.duration=n.duration||4294967295,i.box(i.types.trak,i.tkhd(n),i.mdia(n))}},{key:"trex",value:function(n){var e=n.id;return i.box(i.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(n,e){var t,r,a,l,f,v,w=n.samples||[],A=w.length,H=12+16*A,ce=new Uint8Array(H);for(e+=8+H,ce.set([0,0,15,1,A>>>24&255,A>>>16&255,A>>>8&255,255&A,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<A;t++)a=(r=w[t]).duration,l=r.size,f=r.flags,v=r.cts,ce.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,l>>>24&255,l>>>16&255,l>>>8&255,255&l,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,v>>>24&255,v>>>16&255,v>>>8&255,255&v],12+16*t);return i.box(i.types.trun,ce)}},{key:"initSegment",value:function(n,e,t){i.types||i.init();var r,a=i.moov(n,e,t);return(r=new Uint8Array(i.FTYP.byteLength+a.byteLength)).set(i.FTYP),r.set(a,i.FTYP.byteLength),r}}]),i}(),Ze=function(){function i(n){g()(this,i),this.remuxer=n,this.track=n.mp4track,this.aacHeader=null}return k()(i,[{key:"getHeaderLength",value:function(n){return 1&n[1]?7:9}},{key:"getFrameLength",value:function(n){return(3&n[3])<<11|n[4]<<3|(224&n[5])>>>5}},{key:"isAACPattern",value:function(n){return n[0]===255&&(240&n[1])==240&&(6&n[1])==0}},{key:"extractAAC",value:function(n){var e,t,r=0,a=n.byteLength,l=[];if(!this.isAACPattern(n))return Qe("Invalid ADTS audio format"),l;for(e=this.getHeaderLength(n),this.aacHeader||(this.aacHeader=n.subarray(0,e));r<a;)t=this.getFrameLength(n),l.push(n.subarray(e,t)),n=n.slice(t),r+=t;return l}},{key:"samplingRateMap",get:function(){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]}},{key:"getAACHeaderData",get:function(){return this.aacHeader}},{key:"setAACHeaderData",set:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.aacHeader=n}}]),k()(i,[{key:"setAACConfig",value:function(){var n,e,t,r=new Uint8Array(2),a=this.getAACHeaderData;a&&(n=1+((192&a[2])>>>6),e=(60&a[2])>>>2,t=(1&a[2])<<2,t|=(192&a[3])>>>6,r[0]=n<<3,r[0]|=(14&e)>>1,r[1]|=(1&e)<<7,r[1]|=t<<3,this.track.codec="mp4a.40."+n,this.track.channelCount=t,this.track.config=r,this.remuxer.readyToDecode=!0)}}]),i}(),wn=1,Ie=function(){function i(){g()(this,i),this.seq=1}return k()(i,null,[{key:"getTrackID",value:function(){return wn++}}]),k()(i,[{key:"flush",value:function(){this.seq++,this.mp4track.len=0,this.mp4track.samples=[]}},{key:"isReady",value:function(){return!(!this.readyToDecode||!this.samples.length)||null}}]),i}(),Ye=function(i){function n(){var e;return g()(this,n),(e=L()(this,c()(n).call(this))).readyToDecode=!1,e.nextDts=0,e.dts=0,e.timescale=1e3,e.mp4track={id:Ie.getTrackID(),type:"audio",channelCount:0,len:0,fragmented:!0,timescale:e.timescale,duration:e.timescale,samples:[],config:"",codec:""},e.samples=[],e.aac=new Ze(p()(e)),e}return T()(n,i),k()(n,[{key:"resetTrack",value:function(){this.readyToDecode=!1,this.mp4track.codec="",this.mp4track.channelCount="",this.mp4track.config="",this.mp4track.timescale=this.timescale}},{key:"remux",value:function(e){var t,r,a=!0,l=!1,f=void 0;try{for(var v,w=e[Symbol.iterator]();!(a=(v=w.next()).done);a=!0){var A=v.value;t=(r=A.units).byteLength,this.samples.push({units:r,size:t,duration:A.duration}),this.mp4track.len+=t,this.readyToDecode||this.aac.setAACConfig()}}catch(H){l=!0,f=H}finally{try{a||w.return==null||w.return()}finally{if(l)throw f}}}},{key:"getPayload",value:function(){if(!this.isReady())return null;var e,t,r=new Uint8Array(this.mp4track.len),a=0,l=this.mp4track.samples;for(this.dts=this.nextDts;this.samples.length;){var f=this.samples.shift();(t=f.duration)<=0?(Ge("remuxer: invalid sample duration at DTS: ".concat(this.nextDts," :").concat(t)),this.mp4track.len-=f.size):(this.nextDts+=t,e={size:f.size,duration:t,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},r.set(f.units,a),a+=f.size,l.push(e))}return l.length?new Uint8Array(r.buffer,0,this.mp4track.len):null}}]),n}(Ie),vt=function(i){function n(){var e;return g()(this,n),(e=L()(this,c()(n).call(this))).readyToDecode=!1,e.nextDts=0,e.dts=0,e.timescale=1e3,e.mp4track={id:Ie.getTrackID(),type:"video",len:0,fragmented:!0,sps:"",pps:"",width:0,height:0,timescale:e.timescale,duration:e.timescale,samples:[]},e.samples=[],e.h264=new Ht(p()(e)),e}return T()(n,i),k()(n,[{key:"resetTrack",value:function(){this.readyToDecode=!1,this.mp4track.sps="",this.mp4track.pps=""}},{key:"remux",value:function(e){var t,r,a,l,f,v=!0,w=!1,A=void 0;try{for(var H,ce=e[Symbol.iterator]();!(v=(H=ce.next()).done);v=!0){t=H.value,r=[],l=0,f=!1;var ye=!0,_e=!1,xe=void 0;try{for(var Ee,Me=t.units[Symbol.iterator]();!(ye=(Ee=Me.next()).done);ye=!0)a=Ee.value,this.h264.parseNAL(a)&&(r.push(a),l+=a.getSize(),f||(f=a.isKeyframe()))}catch(ge){_e=!0,xe=ge}finally{try{ye||Me.return==null||Me.return()}finally{if(_e)throw xe}}r.length>0&&this.readyToDecode&&(this.mp4track.len+=l,this.samples.push({units:r,size:l,keyFrame:f,duration:t.duration}))}}catch(ge){w=!0,A=ge}finally{try{v||ce.return==null||ce.return()}finally{if(w)throw A}}}},{key:"getPayload",value:function(){if(!this.isReady())return null;var e,t,r=new Uint8Array(this.mp4track.len),a=0,l=this.mp4track.samples;for(this.dts=this.nextDts;this.samples.length;){var f=this.samples.shift(),v=f.units;if((t=f.duration)<=0)Ge("remuxer: invalid sample duration at DTS: ".concat(this.nextDts," :").concat(t)),this.mp4track.len-=f.size;else{this.nextDts+=t,e={size:f.size,duration:t,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:f.keyFrame?0:1,dependsOn:f.keyFrame?2:1}};var w=!0,A=!1,H=void 0;try{for(var ce,ye=v[Symbol.iterator]();!(w=(ce=ye.next()).done);w=!0){var _e=ce.value;r.set(_e.getData(),a),a+=_e.getSize()}}catch(xe){A=!0,H=xe}finally{try{w||ye.return==null||ye.return()}finally{if(A)throw H}}l.push(e)}}return l.length?new Uint8Array(r.buffer,0,this.mp4track.len):null}}]),n}(Ie);function Ft(i,n){var e=new Uint8Array((0|i.byteLength)+(0|n.byteLength));return e.set(i,0),e.set(n,0|i.byteLength),e}var Pn=function(i){function n(e){var t;return g()(this,n),(t=L()(this,c()(n).call(this,"remuxer"))).initialized=!1,t.trackTypes=[],t.tracks={},t.mediaDuration=e?1/0:1e3,t}return T()(n,i),k()(n,[{key:"addTrack",value:function(e){e!=="video"&&e!=="both"||(this.tracks.video=new vt,this.trackTypes.push("video")),e!=="audio"&&e!=="both"||(this.tracks.audio=new Ye,this.trackTypes.push("audio"))}},{key:"reset",value:function(){var e=!0,t=!1,r=void 0;try{for(var a,l=this.trackTypes[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var f=a.value;this.tracks[f].resetTrack()}}catch(v){t=!0,r=v}finally{try{e||l.return==null||l.return()}finally{if(t)throw r}}this.initialized=!1}},{key:"destroy",value:function(){this.tracks={},this.offAll()}},{key:"flush",value:function(){if(this.initialized){var e=!0,t=!1,r=void 0;try{for(var a,l=this.trackTypes[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var f=a.value,v=this.tracks[f],w=v.getPayload();if(w&&w.byteLength){var A={type:f,payload:Ft(me.moof(v.seq,v.dts,v.mp4track),me.mdat(w)),dts:v.dts};this.dispatch("buffer",A);var H=(st=v.dts/1e3,je=void 0,Nt=void 0,vn=void 0,yn=void 0,yn="",je=Math.floor(st),(Nt=parseInt(je/3600,10)%24)>0&&(yn+=(Nt<10?"0"+Nt:Nt)+":"),yn+=((vn=parseInt(je/60,10)%60)<10?"0"+vn:vn)+":"+((je=je<0?0:je%60)<10?"0"+je:je));Ge("put segment (".concat(f,"): ").concat(v.seq," dts: ").concat(v.dts," samples: ").concat(v.mp4track.samples.length," second: ").concat(H)),v.flush()}}}catch(In){t=!0,r=In}finally{try{e||l.return==null||l.return()}finally{if(t)throw r}}}else if(this.isReady()){this.dispatch("ready");var ce=!0,ye=!1,_e=void 0;try{for(var xe,Ee=this.trackTypes[Symbol.iterator]();!(ce=(xe=Ee.next()).done);ce=!0){var Me=xe.value,ge=this.tracks[Me],ht={type:Me,payload:me.initSegment([ge.mp4track],this.mediaDuration,ge.mp4track.timescale)};this.dispatch("buffer",ht)}}catch(In){ye=!0,_e=In}finally{try{ce||Ee.return==null||Ee.return()}finally{if(ye)throw _e}}Ge("Initial segment generated."),this.initialized=!0}var st,je,Nt,vn,yn}},{key:"isReady",value:function(){var e=!0,t=!1,r=void 0;try{for(var a,l=this.trackTypes[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var f=a.value;if(!this.tracks[f].readyToDecode||!this.tracks[f].samples.length)return!1}}catch(v){t=!0,r=v}finally{try{e||l.return==null||l.return()}finally{if(t)throw r}}return!0}},{key:"remux",value:function(e){var t=!0,r=!1,a=void 0;try{for(var l,f=this.trackTypes[Symbol.iterator]();!(t=(l=f.next()).done);t=!0){var v=l.value,w=e[v];v==="audio"&&this.tracks.video&&!this.tracks.video.readyToDecode||w.length>0&&this.tracks[v].remux(w)}}catch(A){r=!0,a=A}finally{try{t||f.return==null||f.return()}finally{if(r)throw a}}this.flush()}}]),n}(at),jt=function(i){function n(e,t){var r;return g()(this,n),(r=L()(this,c()(n).call(this,"buffer"))).type=t,r.queue=new Uint8Array,r.cleaning=!1,r.pendingCleaning=0,r.cleanOffset=30,r.cleanRanges=[],r.sourceBuffer=e,r.sourceBuffer.addEventListener("updateend",function(){r.dispatch("updateend",Date.now()),r.pendingCleaning>0&&(r.initCleanup(r.pendingCleaning),r.pendingCleaning=0),r.cleaning=!1,r.cleanRanges.length&&r.doCleanup()}),r.sourceBuffer.addEventListener("error",function(a){r.dispatch("error",{type:r.type,name:"buffer",error:a})}),r}return T()(n,i),k()(n,[{key:"destroy",value:function(){this.queue=null,this.sourceBuffer=null,this.offAll()}},{key:"doCleanup",value:function(){if(this.cleanRanges.length){var e=this.cleanRanges.shift();Ge("".concat(this.type," remove range [").concat(e[0]," - ").concat(e[1],")")),this.cleaning=!0,this.sourceBuffer.remove(e[0],e[1]),this.dispatch("clearBuffer")}else this.cleaning=!1}},{key:"initCleanup",value:function(e){if(this.sourceBuffer.updating)this.pendingCleaning=e;else if(this.sourceBuffer.buffered&&this.sourceBuffer.buffered.length&&!this.cleaning){for(var t=0;t<this.sourceBuffer.buffered.length;++t){var r=this.sourceBuffer.buffered.start(t),a=this.sourceBuffer.buffered.end(t);e-r>this.cleanOffset&&r<(a=e-this.cleanOffset)&&this.cleanRanges.push([r,a])}this.doCleanup()}}},{key:"doAppend",value:function(){if(this.queue.length&&!this.sourceBuffer.updating)try{this.sourceBuffer.appendBuffer(this.queue),this.queue=new Uint8Array}catch(e){if(e.name==="QuotaExceededError")return Ge("".concat(this.type," buffer quota full")),void this.dispatch("error",{type:this.type,name:"QuotaExceeded",error:"buffer error"});Qe("Error occured while appending ".concat(this.type," buffer -  ").concat(e.name,": ").concat(e.message)),this.dispatch("error",{type:this.type,name:"unexpectedError",error:"buffer error"})}}},{key:"feed",value:function(e){this.queue=Ft(this.queue,e)}}]),n}(at);window.MediaSource=window.MediaSource||window.WebKitMediaSource;var Wt=function(i){function n(e){var t;if(g()(this,n),t=L()(this,c()(n).call(this,"jmuxer")),window.MediaSource=window.MediaSource||window.WebKitMediaSource,t.options=Object.assign({},{node:"",mode:"both",flushingTime:1500,clearBuffer:!0,onReady:null,fps:30,debug:!1,onClearBuffer:null},e),t.options.debug&&(nt=console.log,Ke=console.error),typeof t.options.node=="string"&&t.options.node==""&&Qe("no video element were found to render, provide a valid video element"),t.options.fps||(t.options.fps=30),t.frameDuration=1e3/t.options.fps|0,t.node=typeof t.options.node=="string"?document.getElementById(t.options.node):t.options.node,t.sourceBuffers={},t.isMSESupported=!!window.MediaSource,!t.isMSESupported)throw"Oops! Browser does not support media source extension.";return t.setupMSE(),t.remuxController=new Pn(t.options.clearBuffer),t.remuxController.addTrack(t.options.mode),t.options.mode==="audio"&&(t.aacParser=t.remuxController.tracks.audio.aac),t.mseReady=!1,t.lastCleaningTime=Date.now(),t.keyframeCache=[],t.frameCounter=0,t.remuxController.on("buffer",t.onBuffer.bind(p()(t))),t.remuxController.on("ready",t.createBuffer.bind(p()(t))),t.startInterval(),t}return T()(n,i),k()(n,null,[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),k()(n,[{key:"setupMSE",value:function(){this.mediaSource=new MediaSource,this.node.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",this.onMSEOpen.bind(this)),this.mediaSource.addEventListener("sourceclose",this.onMSEClose.bind(this)),this.mediaSource.addEventListener("webkitsourceopen",this.onMSEOpen.bind(this)),this.mediaSource.addEventListener("webkitsourceclose",this.onMSEClose.bind(this))}},{key:"feed",value:function(e){var t,r,a,l=!1,f={video:[],audio:[]};e&&this.remuxController&&(a=e.duration?parseInt(e.duration):0,e.video&&(t=Ht.extractNALu(e.video)).length>0&&(f.video=this.getVideoFrames(t,a),l=!0),e.audio&&(r=this.aacParser.extractAAC(e.audio)).length>0&&(f.audio=this.getAudioFrames(r,a),l=!0),l?this.remuxController.remux(f):Qe("Input object must have video and/or audio property. Make sure it is not empty and valid typed array"))}},{key:"getVideoFrames",value:function(e,t){var r,a,l,f=[],v=[],w=0,A=[],H=!0,ce=!1,ye=void 0;try{for(var _e,xe=e[Symbol.iterator]();!(H=(_e=xe.next()).done);H=!0)r=_e.value,a=new Fe(r),f.push(a),a.type()!==Fe.IDR&&a.type()!==Fe.NDR||(v.push({units:f}),f=[],this.options.clearBuffer&&(a.type()===Fe.IDR&&A.push(this.frameCounter),this.frameCounter++))}catch(Ee){ce=!0,ye=Ee}finally{try{H||xe.return==null||xe.return()}finally{if(ce)throw ye}}return t?(l=t/v.length|0,w=t-l*v.length):l=this.frameDuration,v.map(function(Ee){Ee.duration=w>0?l+1:l,w!==0&&w--}),this.options.clearBuffer&&(A=A.map(function(Ee){return Ee*l/1e3}),this.keyframeCache=this.keyframeCache.concat(A)),v}},{key:"getAudioFrames",value:function(e,t){var r,a,l=[],f=0,v=!0,w=!1,A=void 0;try{for(var H,ce=e[Symbol.iterator]();!(v=(H=ce.next()).done);v=!0)r=H.value,l.push({units:r})}catch(ye){w=!0,A=ye}finally{try{v||ce.return==null||ce.return()}finally{if(w)throw A}}return t?(a=t/l.length|0,f=t-a*l.length):a=this.frameDuration,l.map(function(ye){ye.duration=f>0?a+1:a,f!==0&&f--}),l}},{key:"destroy",value:function(){if(this.aacParser=null,this.stopInterval(),this.mediaSource){try{this.bufferControllers&&(this.mediaSource.endOfStream(),this.removeSourceBuffer())}catch(t){Qe("mediasource is not available to end ".concat(t.message))}this.mediaSource=null}if(this.remuxController&&(this.remuxController.destroy(),this.remuxController=null),this.bufferControllers){for(var e in this.bufferControllers)this.bufferControllers[e].destroy();this.bufferControllers=null}this.node=!1,this.mseReady=!1,this.videoStarted=!1}},{key:"createBuffer",value:function(){if(this.mseReady&&this.remuxController&&this.remuxController.isReady()&&!this.bufferControllers)for(var e in this.bufferControllers={},this.remuxController.tracks){var t=this.remuxController.tracks[e];if(!n.isSupported("".concat(e,'/mp4; codecs="').concat(t.mp4track.codec,'"')))return Qe("Browser does not support codec"),!1;var r=this.mediaSource.addSourceBuffer("".concat(e,'/mp4; codecs="').concat(t.mp4track.codec,'"'));this.bufferControllers[e]=new jt(r,e),this.sourceBuffers[e]=r,this.bufferControllers[e].on("error",this.onBufferError.bind(this)),this.bufferControllers[e].on("clearBuffer",this.onClearBuffer.bind(this)),this.bufferControllers[e].on("updateend",this.onUpdateEnd.bind(this))}}},{key:"onUpdateEnd",value:function(e){typeof this.options.onUpdateEnd=="function"&&this.options.onUpdateEnd(e)}},{key:"startInterval",value:function(){var e=this;this.interval=setInterval(function(){e.bufferControllers&&(e.releaseBuffer(),e.clearBuffer())},this.options.flushingTime)}},{key:"stopInterval",value:function(){this.interval&&clearInterval(this.interval)}},{key:"releaseBuffer",value:function(){for(var e in this.bufferControllers)this.bufferControllers[e].doAppend()}},{key:"getSafeBufferClearLimit",value:function(e){for(var t,r=this.options.mode==="audio"&&e||0,a=0;a<this.keyframeCache.length&&!(this.keyframeCache[a]>=e);a++)t=this.keyframeCache[a];return t&&(this.keyframeCache=this.keyframeCache.filter(function(l){return l<t&&(r=l),l>=t})),r}},{key:"clearBuffer",value:function(){if(this.options.clearBuffer&&Date.now()-this.lastCleaningTime>1e4){for(var e in this.bufferControllers){var t=this.getSafeBufferClearLimit(this.node.currentTime);this.bufferControllers[e].initCleanup(t)}this.lastCleaningTime=Date.now()}}},{key:"onBuffer",value:function(e){this.bufferControllers&&this.bufferControllers[e.type]&&this.bufferControllers[e.type].feed(e.payload)}},{key:"onClearBuffer",value:function(){typeof this.options.onClearBuffer=="function"&&this.options.onClearBuffer()}},{key:"removeSourceBuffer",value:function(){if(this.mediaSource){var e=this.sourceBuffers;for(var t in e)this.mediaSource.removeSourceBuffer(e[t])}}},{key:"onMSEOpen",value:function(){this.mseReady=!0,this.createBuffer(),typeof this.options.onReady=="function"&&(this.options.onReady(),this.options.onReady=null)}},{key:"onMSEClose",value:function(){this.mseReady=!1,this.videoStarted=!1}},{key:"onBufferError",value:function(e){if(e.name!="QuotaExceeded"){if(this.mediaSource.sourceBuffers.length>0&&this.sourceBuffers[e.type]&&this.mediaSource.removeSourceBuffer(this.sourceBuffers[e.type]),this.mediaSource.sourceBuffers.length==0)try{this.mediaSource.endOfStream()}catch(t){Qe("mediasource is not available to end")}}else this.bufferControllers[e.type].initCleanup(this.node.currentTime)}}]),n}(at),_n=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"source",[]),h()(p()(t),"onPlay",void 0),t.source=e.source,t.onPlay=e.onPlay,t.init(),t}return T()(n,i),k()(n,[{key:"init",value:function(){}},{key:"extract",value:function(e,t){for(var r=this.provide(t),a=0;a<r.size;a++)e[2*a]=r.left[a],e[2*a+1]=r.right[a];return r.size}},{key:"provide",value:function(e){for(var t=e,r=new Float32Array(t),a=new Float32Array(t),l=0,f=0,v=0;this.source.length>0;){var w=this.source.shift(),A=w.loadedPosition||0;f=w.startTime+w.duration*A/w.length;var H=Math.min(w.length-A,t-l),ce=w.getChannelData(0),ye=w.numberOfChannels>1?w.getChannelData(1):w.getChannelData(0);if(r.set(ce.slice(A,A+H),l),a.set(ye.slice(A,A+H),l),v+=H,l+=H,(A+=H)<w.length){w.loadedPosition=A,this.source.unshift(w);break}}return this.onPlay&&this.onPlay(f),{left:r,right:a,size:v}}}]),n}(z);function ze(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")}function Tt(i,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function We(i,n,e){return n&&Tt(i.prototype,n),e&&Tt(i,e),i}function ie(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),n&&Vt(i,n)}function U(i){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(i)}function Vt(i,n){return(Vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(i,n)}function yt(i,n){return!n||Z()(n)!=="object"&&typeof n!="function"?function(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i):n}function gt(i,n,e){return(gt=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(t,r,a){var l=function(v,w){for(;!Object.prototype.hasOwnProperty.call(v,w)&&(v=U(v))!==null;);return v}(t,r);if(l){var f=Object.getOwnPropertyDescriptor(l,r);return f.get?f.get.call(a):f.value}})(i,n,e||i)}var Je=function(){function i(){ze(this,i),this._vector=new Float32Array,this._position=0,this._frameCount=0}return We(i,[{key:"clear",value:function(){this.receive(this._frameCount),this.rewind()}},{key:"put",value:function(n){this._frameCount+=n}},{key:"putSamples",value:function(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=2*(e=e||0);t>=0||(t=(n.length-r)/2);var a=2*t;this.ensureCapacity(t+this._frameCount);var l=this.endIndex;this.vector.set(n.subarray(r,r+a),l),this._frameCount+=t}},{key:"putBuffer",value:function(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;e=e||0,t>=0||(t=n.frameCount-e),this.putSamples(n.vector,n.position+e,t)}},{key:"receive",value:function(n){n>=0&&!(n>this._frameCount)||(n=this.frameCount),this._frameCount-=n,this._position+=n}},{key:"receiveSamples",value:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=2*e,r=this.startIndex;n.set(this._vector.subarray(r,r+t)),this.receive(e)}},{key:"extract",value:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=this.startIndex+2*e,a=2*t;n.set(this._vector.subarray(r,r+a))}},{key:"ensureCapacity",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=parseInt(2*n);if(this._vector.length<e){var t=new Float32Array(e);t.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=t,this._position=0}else this.rewind()}},{key:"ensureAdditionalCapacity",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.ensureCapacity(this._frameCount+n)}},{key:"rewind",value:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}},{key:"vector",get:function(){return this._vector}},{key:"position",get:function(){return this._position}},{key:"startIndex",get:function(){return 2*this._position}},{key:"frameCount",get:function(){return this._frameCount}},{key:"endIndex",get:function(){return 2*(this._position+this._frameCount)}}]),i}(),Et=function(){function i(n){ze(this,i),n?(this._inputBuffer=new Je,this._outputBuffer=new Je):this._inputBuffer=this._outputBuffer=null}return We(i,[{key:"clear",value:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}},{key:"inputBuffer",get:function(){return this._inputBuffer},set:function(n){this._inputBuffer=n}},{key:"outputBuffer",get:function(){return this._outputBuffer},set:function(n){this._outputBuffer=n}}]),i}(),xn=function(i){function n(e){var t;return ze(this,n),(t=yt(this,U(n).call(this,e))).reset(),t._rate=1,t}return ie(n,i),We(n,[{key:"reset",value:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}},{key:"clone",value:function(){var e=new n;return e.rate=this._rate,e}},{key:"process",value:function(){var e=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(e/this._rate+1);var t=this.transpose(e);this._inputBuffer.receive(),this._outputBuffer.put(t)}},{key:"transpose",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e===0)return 0;for(var t=this._inputBuffer.vector,r=this._inputBuffer.startIndex,a=this._outputBuffer.vector,l=this._outputBuffer.endIndex,f=0,v=0;this.slopeCount<1;)a[l+2*v]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*t[r],a[l+2*v+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*t[r+1],v+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,e!==1)e:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,(f+=1)>=e-1)break e;var w=r+2*f;a[l+2*v]=(1-this.slopeCount)*t[w]+this.slopeCount*t[w+2],a[l+2*v+1]=(1-this.slopeCount)*t[w+1]+this.slopeCount*t[w+3],v+=1,this.slopeCount+=this._rate}return this.prevSampleL=t[r+2*e-2],this.prevSampleR=t[r+2*e-1],v}},{key:"rate",set:function(e){this._rate=e}}]),n}(Et),Bn=function(){function i(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1024;ze(this,i),this._pipe=n,this.inputSize=e}return We(i,[{key:"fillInputBuffer",value:function(){throw new Error("fillInputBuffer() not overridden")}},{key:"fillOutputBuffer",value:function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=this.inputSize;this.outputBuffer.frameCount<n;){var t=e-this.inputBuffer.frameCount;if(this.fillInputBuffer(t),this.inputBuffer.frameCount<e)break;this._pipe.process()}}},{key:"clear",value:function(){this._pipe.clear()}},{key:"pipe",get:function(){return this._pipe}},{key:"inputBuffer",get:function(){return this._pipe.inputBuffer}},{key:"outputBuffer",get:function(){return this._pipe.outputBuffer}}]),i}(),Lt=function(){},zt=function(i){function n(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1024,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Lt;return ze(this,n),(r=yt(this,U(n).call(this,t,a))).callback=l,r.sourceSound=e,r.historyBufferSize=22050,r._sourcePosition=0,r.outputBufferPosition=0,r._position=0,r}return ie(n,i),We(n,[{key:"onEnd",value:function(){this.callback()}},{key:"fillInputBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=new Float32Array(2*e),r=this.sourceSound.extract(t,e,this._sourcePosition);this._sourcePosition+=r,this.inputBuffer.putSamples(t,0,r)}},{key:"extract",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.fillOutputBuffer(this.outputBufferPosition+t);var r=Math.min(t,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(e,this.outputBufferPosition,r);var a=this.outputBufferPosition+r;return this.outputBufferPosition=Math.min(this.historyBufferSize,a),this.outputBuffer.receive(Math.max(a-this.historyBufferSize,0)),this._position+=r,r}},{key:"handleSampleData",value:function(e){this.extract(e.data,4096)}},{key:"clear",value:function(){gt(U(n.prototype),"clear",this).call(this),this.outputBufferPosition=0}},{key:"position",get:function(){return this._position},set:function(e){if(e>this._position)throw new RangeError("New position may not be greater than current position");var t=this.outputBufferPosition-(this._position-e);if(t<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=t,this._position=e}},{key:"sourcePosition",get:function(){return this._sourcePosition},set:function(e){this.clear(),this._sourcePosition=e}}]),n}(Bn),Xt=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],Tn=function(i){function n(e){var t;return ze(this,n),(t=yt(this,U(n).call(this,e)))._quickSeek=!0,t.midBufferDirty=!1,t.midBuffer=null,t.overlapLength=0,t.autoSeqSetting=!0,t.autoSeekSetting=!0,t._tempo=1,t.setParameters(44100,0,0,8),t}return ie(n,i),We(n,[{key:"clear",value:function(){gt(U(n.prototype),"clear",this).call(this),this.clearMidBuffer()}},{key:"clearMidBuffer",value:function(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}},{key:"setParameters",value:function(e,t,r,a){e>0&&(this.sampleRate=e),a>0&&(this.overlapMs=a),t>0?(this.sequenceMs=t,this.autoSeqSetting=!1):this.autoSeqSetting=!0,r>0?(this.seekWindowMs=r,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}},{key:"calculateOverlapLength",value:function(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e=(e=this.sampleRate*t/1e3)<16?16:e,e-=e%8,this.overlapLength=e,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}},{key:"checkLimits",value:function(e,t,r){return e<t?t:e>r?r:e}},{key:"calculateSequenceParameters",value:function(){var e,t;this.autoSeqSetting&&(e=150+-50*this._tempo,e=this.checkLimits(e,50,125),this.sequenceMs=Math.floor(e+.5)),this.autoSeekSetting&&(t=25- -10/1.5*.5+-10/1.5*this._tempo,t=this.checkLimits(t,15,25),this.seekWindowMs=Math.floor(t+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}},{key:"clone",value:function(){var e=new n;return e.tempo=this._tempo,e.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),e}},{key:"seekBestOverlapPosition",value:function(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}},{key:"seekBestOverlapPositionStereo",value:function(){var e,t,r,a=0;for(this.preCalculateCorrelationReferenceStereo(),e=0,t=Number.MIN_VALUE;a<this.seekLength;a+=1)(r=this.calculateCrossCorrelationStereo(2*a,this.refMidBuffer))>t&&(t=r,e=a);return e}},{key:"seekBestOverlapPositionStereoQuick",value:function(){var e,t,r,a,l,f=0;for(this.preCalculateCorrelationReferenceStereo(),t=Number.MIN_VALUE,e=0,a=0,l=0;f<4;f+=1){for(var v=0;Xt[f][v]&&!((l=a+Xt[f][v])>=this.seekLength);)(r=this.calculateCrossCorrelationStereo(2*l,this.refMidBuffer))>t&&(t=r,e=l),v+=1;a=e}return e}},{key:"preCalculateCorrelationReferenceStereo",value:function(){for(var e,t,r=0;r<this.overlapLength;r+=1)t=r*(this.overlapLength-r),e=2*r,this.refMidBuffer[e]=this.midBuffer[e]*t,this.refMidBuffer[e+1]=this.midBuffer[e+1]*t}},{key:"calculateCrossCorrelationStereo",value:function(e,t){var r=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;for(var a,l=0,f=2,v=2*this.overlapLength;f<v;f+=2)l+=r[a=f+e]*t[f]+r[a+1]*t[f+1];return l}},{key:"overlap",value:function(e){this.overlapStereo(2*e)}},{key:"overlapStereo",value:function(e){var t=this._inputBuffer.vector;e+=this._inputBuffer.startIndex;for(var r,a,l,f,v,w=this._outputBuffer.vector,A=this._outputBuffer.endIndex,H=0,ce=1/this.overlapLength;H<this.overlapLength;H+=1)a=(this.overlapLength-H)*ce,l=H*ce,f=(r=2*H)+e,w[(v=r+A)+0]=t[f+0]*l+this.midBuffer[r+0]*a,w[v+1]=t[f+1]*l+this.midBuffer[r+1]*a}},{key:"process",value:function(){var e,t,r;if(this.midBuffer===null){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){e=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(e)),this._outputBuffer.put(this.overlapLength),(t=this.seekWindowLength-2*this.overlapLength)>0&&this._outputBuffer.putBuffer(this._inputBuffer,e+this.overlapLength,t);var a=this._inputBuffer.startIndex+2*(e+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(a,a+2*this.overlapLength)),this.skipFract+=this.nominalSkip,r=Math.floor(this.skipFract),this.skipFract-=r,this._inputBuffer.receive(r)}}},{key:"tempo",set:function(e){var t;this._tempo=e,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,t=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(t+this.overlapLength,this.seekWindowLength)+this.seekLength},get:function(){return this._tempo}},{key:"inputChunkSize",get:function(){return this.sampleReq}},{key:"outputChunkSize",get:function(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}},{key:"quickSeek",set:function(e){this._quickSeek=e}}]),n}(Et),St=function(i,n){return(i>n?i-n:n-i)>1e-10},Ct=function(){function i(){ze(this,i),this.transposer=new xn(!1),this.stretch=new Tn(!1),this._inputBuffer=new Je,this._intermediateBuffer=new Je,this._outputBuffer=new Je,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}return We(i,[{key:"clear",value:function(){this.transposer.clear(),this.stretch.clear()}},{key:"clone",value:function(){var n=new i;return n.rate=this.rate,n.tempo=this.tempo,n}},{key:"calculateEffectiveRateAndTempo",value:function(){var n=this._tempo,e=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,St(this._tempo,n)&&(this.stretch.tempo=this._tempo),St(this._rate,e)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}},{key:"process",value:function(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}},{key:"rate",get:function(){return this._rate},set:function(n){this.virtualRate=n,this.calculateEffectiveRateAndTempo()}},{key:"rateChange",set:function(n){this._rate=1+.01*n}},{key:"tempo",get:function(){return this._tempo},set:function(n){this.virtualTempo=n,this.calculateEffectiveRateAndTempo()}},{key:"tempoChange",set:function(n){this.tempo=1+.01*n}},{key:"pitch",set:function(n){this.virtualPitch=n,this.calculateEffectiveRateAndTempo()}},{key:"pitchOctaves",set:function(n){this.pitch=Math.exp(.69314718056*n),this.calculateEffectiveRateAndTempo()}},{key:"pitchSemitones",set:function(n){this.pitchOctaves=n/12}},{key:"inputBuffer",get:function(){return this._inputBuffer}},{key:"outputBuffer",get:function(){return this._outputBuffer}}]),i}(),Gt=function(){function i(n){ze(this,i),this.buffer=n,this._position=0}return We(i,[{key:"extract",value:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.position=t;for(var r=this.buffer.getChannelData(0),a=this.dualChannel?this.buffer.getChannelData(1):this.buffer.getChannelData(0),l=0;l<e;l++)n[2*l]=r[l+t],n[2*l+1]=a[l+t];return Math.min(e,r.length-t)}},{key:"dualChannel",get:function(){return this.buffer.numberOfChannels>1}},{key:"position",get:function(){return this._position},set:function(n){this._position=n}}]),i}(),Yt=function(i,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Lt,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:4096,r=i.createScriptProcessor(t,2,2),a=new Float32Array(2*t);return r.onaudioprocess=function(l){var f=l.outputBuffer.getChannelData(0),v=l.outputBuffer.getChannelData(1),w=n.extract(a,t);e(n.sourcePosition),w===0&&n.onEnd();for(var A=0;A<w;A++)f[A]=a[2*A],v[A]=a[2*A+1]},r},$t=function(i){var n,e,t,r=Math.floor(i/60),a=i-60*r;return"".concat(r,":").concat((n=parseInt(a),t=t||"0",(n+="").length>=(e=2)?n:new Array(e-n.length+1).join(t)+n))},qt=function(i){var n=this.timePlayed,e=this.sampleRate;if(this.sourcePosition=i,this.timePlayed=i/e,n!==this.timePlayed){var t=new CustomEvent("play",{detail:{timePlayed:this.timePlayed,formattedTimePlayed:this.formattedTimePlayed,percentagePlayed:this.percentagePlayed}});this._node.dispatchEvent(t)}},En=(function(){function i(n,e,t){var r=this,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Lt;ze(this,i),this._soundtouch=new Ct;var l=new Gt(e);this.timePlayed=0,this.sourcePosition=0,this._filter=new zt(l,this._soundtouch,a),this._node=Yt(n,this._filter,function(f){return qt.call(r,f)}),this.tempo=1,this.rate=1,this.duration=e.duration,this.sampleRate=n.sampleRate,this.listeners=[]}We(i,[{key:"connect",value:function(n){this._node.connect(n)}},{key:"disconnect",value:function(){this._node.disconnect()}},{key:"on",value:function(n,e){this.listeners.push({name:n,cb:e}),this._node.addEventListener(n,function(t){return e(t.detail)})}},{key:"off",value:function(){var n=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=this.listeners;e&&(t=t.filter(function(r){return r.name===e})),t.forEach(function(r){n._node.removeEventListener(r.name,function(a){return r.cb(a.detail)})})}},{key:"formattedDuration",get:function(){return $t(this.duration)}},{key:"formattedTimePlayed",get:function(){return $t(this.timePlayed)}},{key:"percentagePlayed",get:function(){return 100*this._filter.sourcePosition/(this.duration*this.sampleRate)},set:function(n){this._filter.sourcePosition=parseInt(n*this.duration*this.sampleRate)}},{key:"node",get:function(){return this._node}},{key:"pitch",set:function(n){this._soundtouch.pitch=n}},{key:"pitchSemitones",set:function(n){this._soundtouch.pitchSemitones=n}},{key:"rate",set:function(n){this._soundtouch.rate=n}},{key:"tempo",set:function(n){this._soundtouch.tempo=n}}])}(),function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"soundTouch",void 0),h()(p()(t),"filter",void 0),t.init(e.source),t}return T()(n,i),k()(n,[{key:"init",value:function(e){this.soundTouch=new Ct,this.soundTouch.tempo=1,this.soundTouch.rate=1,this.filter=new zt(e,this.soundTouch,2048)}},{key:"provide",value:function(e){for(var t=new Float32Array(2*e),r=this.filter.extract(t,e),a=new Float32Array(r),l=new Float32Array(r),f=0;f<r;f++)a[f]=t[2*f],l[f]=t[2*f+1];return{size:r,left:a,right:l}}},{key:"rate",set:function(e){this.soundTouch.tempo=e}}]),n}(z)),y=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"currentRate",1),h()(p()(t),"source",[]),h()(p()(t),"commonProcessor",void 0),h()(p()(t),"rateProcessor",void 0),h()(p()(t),"audioTime",0),t.source=e.source,t.init(),t}return T()(n,i),k()(n,[{key:"init",value:function(){var e=this;this.commonProcessor=new _n({source:this.source,onPlay:function(t){e.audioTime=t}}),this.rateProcessor=new En({source:this.commonProcessor})}},{key:"provide",value:function(e){var t=(this.currentRate===1?this.commonProcessor:this.rateProcessor).provide(e);return t.audioTime=this.audioTime,t}},{key:"rate",set:function(e){this.currentRate=e,this.rateProcessor.rate=e}}]),n}(z),u="canplaythrough",o="seeked",s="waiting",d=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"audioContext",null),h()(p()(t),"scriptNode",null),h()(p()(t),"gainNode",null),h()(p()(t),"delay",0),h()(p()(t),"audioBuffer",new ArrayBuffer(0)),h()(p()(t),"decodedBuffer",[]),h()(p()(t),"isFirstPlay",!0),h()(p()(t),"defaultVolume",1),h()(p()(t),"currentRate",1),h()(p()(t),"eventListeners",{}),h()(p()(t),"canPlay",!1),h()(p()(t),"interval",void 0),h()(p()(t),"seekTimeDelta",0),h()(p()(t),"audioTime",0),h()(p()(t),"audioProvider",void 0),h()(p()(t),"isWaiting",!1),e=Object.assign({},e),t.flushTime=e.flushTime||1e3,t.onReady=e.onReady,t.init(),t}return T()(n,i),k()(n,[{key:"init",value:function(){this.audioProvider=new y({source:this.decodedBuffer}),typeof this.onReady=="function"&&setTimeout(this.onReady,0)}},{key:"feed",value:function(e){var t=e.audio;this.audioBuffer=this.appendByteArray(this.audioBuffer,t),this.canPlay||(this.canPlay=!0,this.triggerEvent(u))}},{key:"appendByteArray",value:function(e,t){var r=new Uint8Array((0|e.byteLength)+(0|t.byteLength));return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),0|e.byteLength),r.buffer}},{key:"decodeAudioData",value:function(e){var t=this;this.audioBuffer&&this.audioBuffer.byteLength>0&&(this.audioContext.decodeAudioData(this.audioBuffer,function(r){r.startTime=t.delay,t.delay+=r.duration,t.decodedBuffer.push(r),e&&e.call()},function(r){t.logger.error("decodeAudioData",r)}),this.audioBuffer=new ArrayBuffer(0))}},{key:"play",value:function(){var e=this;return new Promise(function(t,r){e.isFirstPlay?(e.isFirstPlay=!1,e.logger.info("startPlay"),e.audioContext=new(window.AudioContext||window.webkitAudioContext),e.gainNode=e.audioContext.createGain(),e.gainNode.gain.value=e.defaultVolume,e.scriptNode=e.audioContext.createScriptProcessor(2048,2,2),e.scriptNode.onaudioprocess=function(a){var l=a.outputBuffer,f=l.length,v=e.audioProvider.provide(f);if(v.size!==0){e.isWaiting&&(e.isWaiting=!1,e.triggerEvent(u));var w=l.getChannelData(0),A=l.getChannelData(1);if(v.audioTime!=0&&(e.audioTime=v.audioTime),w.set(v.left),A.set(v.right),v.size<f){var H=new Float32Array(f-v.size);w.set(H,v.size),A.set(H,v.size)}}else e.isWaiting||(e.isWaiting=!0,e.triggerEvent(s))},e.scriptNode.connect(e.gainNode),e.gainNode.connect(e.audioContext.destination),e.decodeAudioData.call(e,e.testAutoplay.bind(e,t,r)),e.interval=setInterval(e.decodeAudioData.bind(e),e.flushTime)):e.audioContext.state==="suspended"?e.audioContext.resume().then(function(){e.logger.info("play","Audio is resumed"),t()}):(e.logger.info("Audio resumed from waiting"),t())})}},{key:"pause",value:function(){var e=this;this.audioContext&&this.audioContext.suspend().then(function(){e.logger.info("pause","Audio is paused")})}},{key:"addEventListener",value:function(e,t){this.eventListeners[e]=t}},{key:"triggerEvent",value:function(e){var t=this.eventListeners[e];t&&t.call()}},{key:"buffer",value:function(){var e=0;return this.decodedBuffer.length>0&&(e=this.decodedBuffer[0].startTime),{start:1e3*e,end:parseInt(1e3*this.delay)}}},{key:"destroy",value:function(){this.delay=0,this.audioContext&&(clearInterval(this.interval),this.scriptNode.disconnect(),this.scriptNode=null,this.audioContext.close(),this.audioContext=null),this.gainNode=null,this.audioBuffer=new ArrayBuffer(0),this.canPlay=!1,this.isFirstPlay=!0,this.decodedBuffer.length=0,this.seekTimeDelta=0,this.audioTime=0}},{key:"testAutoplay",value:function(e,t){var r=G.createEl("audio"),a=r.play();r=null;var l=!1;a!==void 0?(a.catch(function(){l=!0}),setTimeout(function(){a=null,l?t("Autoplay is prevented"):e()},100)):t("Promise is undefined")}},{key:"currentTime",get:function(){return this.audioTime},set:function(e){var t=this;for(this.audioTime=e;this.decodedBuffer.length>0;){var r=this.decodedBuffer.shift();if(r.startTime<=e&&r.startTime+r.duration>e){r.loadedPosition=parseInt(r.length*(e-r.startTime)/r.duration),this.decodedBuffer.unshift(r);break}}setTimeout(function(){t.triggerEvent(o)},0)}},{key:"volume",get:function(){return this.gainNode.gain.value},set:function(e){this.gainNode?this.gainNode.gain.value=e:this.defaultVolume=e}},{key:"playbackRate",set:function(e){e!==this.currentRate&&(this.currentRate=e,this.audioProvider.rate=e)}}]),n}(z),b=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"first",!1),h()(p()(e),"offset",0),h()(p()(e),"currentPTS",0),h()(p()(e),"ready",!1),h()(p()(e),"end",!1),h()(p()(e),"lastData",null),h()(p()(e),"nodeParent",null),h()(p()(e),"useJMuxer",!1),e.player=t.audioNode,e.createAudioMuxer(),e.bindEvent(),e.logger.info("audioDecoder",e.useJMuxer?"JMuxer":"AudioContext"),e}return T()(n,i),k()(n,[{key:"bindEvent",value:function(){var e=this;this.bindNodeEvent(),this.events.on(B.PlayerMaxPTS,function(t){e.currentPTS===t&&(e.end=!0)})}},{key:"bindNodeEvent",value:function(){var e=this;this.addEventListener("seeked",function(){e.onSeekedHandler&&e.onSeekedHandler(),e.events.emit("AudioPlayer.seeked")}),this.addEventListener("canplaythrough",function(){e.logger.info("canplaythrough"),e.ready||(e.ready=!0,e.status="ready",e.logger.info("constructor","canplaythrough","ready"),e.events.emit(B.AudioPlayerDataReady))}),this.addEventListener("waiting",function(){e.ready=!1,e.end?(e.useJMuxer||e.player.destroy(),e.status="end",e.events.emit(B.AudioPlayerEnd,"audio"),e.logger.info("audioPlayer end")):(e.logger.warn("audioPlayer waiting",e.player.currentTime,e.currentPTS),e.status="waiting",e.events.emit(B.AudioPlayerWait,"audio"))})}},{key:"reset",value:function(){this.lastData=null,this.first=!1,this.offset=0,this.currentPTS=0,this.ready=!1,this.end=!1,this.clear(),this.createAudioMuxer(),this.bindNodeEvent(),this.stime=null}},{key:"createNode",value:function(){this.player=document.createElement("audio"),this.player.classList.add("goldplay__audio--player"),this.parentNode.appendChild(this.player)}},{key:"createAudioMuxer",value:function(){this.useJMuxer?this.audioDecoder=new Wt({node:this.player,mode:"audio",debug:!1,clearBuffer:!0,flushingTime:10,onReady:this.onMSEReady.bind(this)}):(this.audioDecoder=new d({flushTime:100,onReady:this.onMSEReady.bind(this)}),this.player=this.audioDecoder)}},{key:"onMSEReady",value:function(){this.logger.info("onMSEReady","AudioPlayerReady"),this.events.emit(B.AudioPlayerReady)}},{key:"clear",value:function(){this.audioDecoder.destroy(),this.audioDecoder=null}},{key:"play",value:function(){var e=this;this.status!=="playing"&&(this.status="playing",this.player.play().then(function(){e.events.emit(B.AudioPlayerPlaySuccess)}).catch(function(t){e.logger.error("play","errorInfo:",t),e.events.emit(B.AudioPlayerPlayFail)}))}},{key:"pause",value:function(){this.status!=="pause"&&(this.status="pause",this.player.pause())}},{key:"send",value:function(e){if(this.audioDecoder){if(this.stime||(this.stime=Date.now()),(e=this.format(e)).audioEnd)return this.logger.info("push","audioEnd"),this.feed(this.lastData),void(this.lastData=null);if(this.first||(this.first=!0,this.offset=e.start),e.PTS>this.currentPTS){if(!this.lastData)return void(this.lastData=e);this.lastData.duration=e.PTS-this.lastData.PTS,this.feed(this.lastData),e.duration=this.lastData.duration,this.lastData=e}}else this.logger.error("send","audioDecoder is:",this.audioDecoder)}},{key:"feed",value:function(e){this.audioDecoder.feed({audio:e.data_byte,duration:e.duration}),this.currentPTS=e.PTS}},{key:"format",value:function(e){return e&&e.data_byte&&(e.start=e.PTS),e}},{key:"addEventListener",value:function(e,t){this.player.addEventListener(e,t)}},{key:"isBuffered",value:function(e){return[this.buffer()].findIndex(function(t){return e>=t.start&&e<t.end})!==-1}},{key:"buffer",value:function(){if(this.useJMuxer){for(var e=this.player.buffered,t=e.length,r={};t>0;)r.start=1e3*e.start(t-1)+this.offset,r.end=1e3*e.end(t-1)+this.offset,t--;return r}var a=this.player.buffer();return{start:a.start+this.offset,end:a.end+this.offset}}},{key:"muted",set:function(e){this.player.muted=!!e}},{key:"playbackRate",set:function(e){this.player.playbackRate=e}},{key:"volume",get:function(){return this.player.volume},set:function(e){this.player.volume=e,this.muted=e===0}},{key:"currentTime",get:function(){return parseInt(1e3*this.player.currentTime+this.offset)},set:function(e){this.player.currentTime=(e-this.offset)/1e3}},{key:"paused",get:function(){return this.player.paused}},{key:"offset",set:function(e){this.offset=e}}]),n}(z),_={playerContainer:"goldplay__container",screenContainer:"goldplay__screen--container",screenCanvas:"goldplay__screen--canvas",audioContainer:"goldplay__audio--container",audioPlayer:"goldplay__audio--player",controlContainer:"goldplay__control--container",containerFullPage:"goldplay__container-fullpage",containerFullScreen:"goldplay__container-fullscreen",controlContainerFloat:"goldplay__control--container-float",bigPlayButton:"goldplay__screen--bigplay",poster:"goldplay__screen--poster",nearside:"goldplay__control--nearside",sidebar:"goldplay__control--sidebar",buttonBlock:"goldplay__control--button-block",playButton:"goldplay__control--play",pauseButton:"goldplay__control--pause",replayButton:"goldplay__control--replay",speedBar:"goldplay__speed-bar",speedBarBox:"goldplay__speed-bar--box",rateBar:"goldplay__rate-bar",rateBarBox:"goldplay__rate-bar--box",fullPage:"goldplay__control--fullpage",fullScreen:"goldplay__control--fullscreen",waitingBar:"goldplay__waiting-bar",progressBar:"goldplay__progress-bar",progressBarHover:"goldplay__progress-bar-hover",progressBarPlay:"goldplay__progressbar--play",progressBarPlayHover:"goldplay__progressbar--play-hover",progressBarLoad:"goldplay__progressbar--load",progressBarLoadHover:"goldplay__progressbar--load-hover",progressBarDot:"goldplay__progressbar--dot",progressBarDotHover:"goldplay__progressbar--dot-hover",volumeBar:"goldplay__volume-bar",volumeBarAudio:"goldplay__volume-bar--audio",volumeBarAudioOn:"goldplay__volume-bar--audio-on",volumeBarAudioOff:"goldplay__volume-bar--audio-off",volumeBarHandle:"goldplay__volume-bar--handle",volumeBarRod:"goldplay__volume-bar--rod",volumeBarRodHover:"goldplay__volume-bar--rod-hover",volumeBarSize:"goldplay__volume-bar--size",volumeBarColumn:"goldplay__volume-bar--column",alertBox:"goldplay__alter-box",alertClose:"goldplay__alter--close"},E=_,O=function(){function i(){g()(this,i)}return k()(i,null,[{key:"createContainer",value:function(n){var e=function(r){function a(){return g()(this,a),L()(this,c()(a).apply(this,arguments))}return T()(a,r),a}(dt()(HTMLDivElement));customElements.get("gp-container")||customElements.define("gp-container",e,{extends:"div"});var t=G.createEl("gp-container","div");return t.className=E.playerContainer,t.style.width=(n.options.width?n.options.width:n.el.offsetWidth)+"px",t.style.height=(n.options.height?n.options.height:n.el.offsetHeight)+"px",t}},{key:"createScreenContainer",value:function(n){var e=n.$container,t=function(l){function f(){return g()(this,f),L()(this,c()(f).apply(this,arguments))}return T()(f,l),f}(dt()(HTMLDivElement));customElements.get("gp-screen")||customElements.define("gp-screen",t,{extends:"div"});var r,a=G.createEl("gp-screen","div");return a.classList.add(E.screenContainer),r=n.controlBarAutoHide?e.offsetHeight:e.offsetHeight-n.controlBarHeight,a.style.height=r+"px",a}},{key:"createAudioContainer",value:function(){var n=G.createEl("gp-audio");return n.classList.add(E.audioContainer),n.style.display="none",n}},{key:"createAudio",value:function(){var n=G.createEl("audio");return n.classList.add(E.audioPlayer),n.controls=!0,n}},{key:"clearCavans",value:function(n){var e=n.getContext("webgl");e.clear(e.COLOR_BUFFER_BIT)}}]),i}();h()(O,"createCanvas",function(i){var n=G.createEl("canvas");return n.style.display="none",n.classList.add(E.screenCanvas),n.width=i.options.screenWidth||i.screenWidth,n.height=i.options.screenHeight||i.screenHeight,n});var X=de.a.get("Template.js"),W=function(){function i(){g()(this,i)}return k()(i,null,[{key:"mergeVar",value:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n!="string"||n==="")return n;try{var t=new RegExp(`\\\${'?"?\\s*([.:a-z0-9_s]+?)\\s*'?"?}`,"ig");return n.replace(t,function(r,a){a=a.trim();var l=e[a];return l=(l=(l=l===null?"":l)===void 0?"":l)||""})}catch(r){return X.error("mergeVar","replace variable","error:",r),n}}},{key:"makeValue",value:function(n,e,t){if(typeof e!="string"&&typeof e!="function")return e;if(typeof e=="function"&&(e=e.call(this,this.data)),!t)return i.escapeHTML.call(this,e);var r,a=function(A){var H="";return A&&(H=" ".concat(i.slotReplaceName,'="true"')),'<gp-slot style="display:none"'.concat(H,"></gp-slot>")};if(i.isSoltType(t)){if(typeof this.getComponent!="function")return X.error("makeValue","the object is not support slot mode.",this.getComponent,e),e;switch(t){case i.slotTypeMap.component:r=e;var l=this.getComponent(r);Z()(l)==="object"&&l.element?(l.element.setAttribute(i.slotReplaceName,"true"),e=l.element.outerHTML):e=a(r);break;case i.slotTypeMap.html:e=i.mergeVar.call(this,e,this.data)}var f="";r!==void 0&&(f=" ".concat(i.slotComName,'="').concat(r,'" '));var v="$1 "+i.slotTypeName+'="'+t+'" '+i.slotKeyName+'="'+n+'"'+f+"$2";return typeof e=="string"&&(e=(e=e===""?a():e).replace(/^\s*(<\s?[\w-]*)(.*[\r|\n|>])/,v)),e}if(typeof t=="string"){var w=J[t];return typeof w=="function"&&(e=w.call(this,e)),e}return i.escapeHTML.call(this,e)}},{key:"escapeHTML",value:function(n){return typeof n!="string"?n:n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"generate",value:function(n,e,t){var r=this,a=t[t.length-1]||{},l=[n[0]];return e.forEach(function(f,v){if(f){var w,A,H=f.split(i.pipSeparator);H.length>1&&(f=H[0],A=H[1]),w=Number.isInteger(f)?t[f]:a[f],(w=i.makeValue.bind(r)(f,w,A))!==void 0&&l.push(w),n[v+1]!==void 0&&l.push(n[v+1])}}),l.join("")}},{key:"create",value:function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var a;a=Array.isArray(n)?"array":typeof n=="function"?"function":"string";var l=this;if(Z()(l)==="object"||typeof l=="function")if(n!==void 0&&n!=="")switch(l.data!==void 0&&l.data!==null||(X.info("create","this object.data is undefined or null",l),l.data={}),a){case"array":return function(){for(var v=arguments.length,w=new Array(v),A=0;A<v;A++)w[A]=arguments[A];var H=w[w.length-1]||{};Z()(l)==="object"&&(l.__template__={tplObj:n,keys:t,dict:H});var ce=i.generate.bind(l);return ce(n,t,w)};case"function":var f=i.create.bind(l);return n.call(l,l.data,f,l);default:return function(v){return v=v!==void 0?v:l.data,i.mergeVar(n,v)}}else X.error("create","have not give tplObj parameter.",n);else X.error("create","this is not an object.",l)}},{key:"isSoltType",value:function(n){return n=String(n).toLowerCase(),i.slotTypeMap[n]}}]),i}();W.pipSeparator="|",W.slotTypeName="gp-slot-type",W.slotKeyName="gp-slot-key",W.slotComName="gp-slot-com",W.slotReplaceName="gp-slot-replace",W.slotTypeMap={html:"html",component:"component"};var J={trim:function(i){return i.trim()},upperCase:function(i){return i.toUpperCase()},lowerCase:function(i){return i.toLowerCase()}},ee=W,be=m(18),Le=m.n(be),se=m(28),Xe=m.n(se),ke=de.a.get("Observer.js"),et=function(){function i(e){g()(this,i),h()(this,"object",null),this.setObject(e)}var n;return k()(i,[{key:"setObject",value:function(e){this.object=e}},{key:"watch",value:(n=Xe()(Le.a.mark(function e(t,r,a){var l;return Le.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(typeof(l=this.object).watch=="function"){f.next=3;break}return f.abrupt("return");case 3:return f.next=5,l.watch(t,r,a);case 5:f.sent!==!1&&typeof l.render=="function"&&l.render(t,r,a),typeof l.afterWatch=="function"&&l.afterWatch(t,r,a);case 8:case"end":return f.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"create",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this,a=t.set,l=t.get;e=e||r.data;var f=r.object,v={set:function(w,A,H){return typeof a=="function"?a.call(r,w,A,H):(w[A]!==H&&(w[A]=H,f.__template__&&Object.prototype.hasOwnProperty.call(f.__template__.dict,A)&&r.watch(w,A,H)),!0)},get:function(w,A){return typeof l=="function"?l.call(r,w,A):Z()(w[A])==="object"&&w[A]!==null?new Proxy(w[A],v):Reflect.get(w,A)}};return new Proxy(e,v)}}]),i}(),mt=function(i){return Z()(i)!=="object"&&ke.error("observer","this is not an object."),new et(i)};function ot(i){if(i){var n=[],e=[];for(e.push(i);e.length;){var t=e.shift(),r=t.getAttribute(ee.slotTypeName);if(!ee.isSoltType(r)){n.push(t);for(var a=t.children,l=0,f=a.length;l<f;l++)e.push(a[l])}}return n}}var Ve=function(i){return i.getAttribute&&i.getAttribute(ee.slotTypeName)===ee.slotTypeMap.html},$e=function(i,n){return!(!(e=i).getAttribute||e.getAttribute(ee.slotTypeName)!==ee.slotTypeMap.component||i.getAttribute(ee.slotComName)===n.getAttribute(ee.slotComName));var e},bt=function(i,n,e){var t;(i||n)&&(!i&&n?e.appendChild(n):!n&&i?e.removeChild(i):i.tagName!==n.tagName||(t=n,Ve(i)&&Ve(t))||$e(i,n)?i.replaceWith(n.cloneNode(!0)):i.nodeType===Node.TEXT_NODE&&i.nodeValue!==n.nodeValue?i.nodeValue=n.nodeValue:i.setAttribute&&G.setAttributes(i,n))},Be=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"createTemplate",null),h()(p()(e),"template",""),h()(p()(e),"element",null),h()(p()(e),"eventsList",{}),h()(p()(e),"data",{}),h()(p()(e),"id",""),e.id=t.id||e.constructor.name,e.options=t,e.createTemplate=ee.create.bind(p()(e)),e}return T()(n,i),k()(n,[{key:"getTemplate",value:function(){return this.template}},{key:"setTemplate",value:function(e){this.template=e}},{key:"init",value:function(){this.data=mt(this).create(this.data),this.render(),typeof this.afterInit=="function"&&this.afterInit()}},{key:"afterInit",value:function(){}},{key:"initProps",value:function(){}},{key:"bindEvent",value:function(){}},{key:"watch",value:function(){}},{key:"render",value:function(){var e="";e=typeof this.template=="function"?this.template(this.data):this.template;var t=G.createEl("div");if(typeof e=="string"){t.innerHTML=e;var r=t.firstElementChild,a=r.querySelectorAll("["+ee.slotReplaceName+"]"),l=!0,f=!1,v=void 0;try{for(var w,A=a[Symbol.iterator]();!(l=(w=A.next()).done);l=!0){var H=w.value;if(H.getAttribute(ee.slotReplaceName)==="true"){var ce=H.getAttribute(ee.slotComName),ye=this.getComponent(ce);if(!ye)continue;var _e=ye.element;G.isElement(this.element)?H.replaceWith(_e.cloneNode(!0)):H.replaceWith(_e),ye.element.removeAttribute(ee.slotReplaceName)}}}catch(xe){f=!0,v=xe}finally{try{l||A.return==null||A.return()}finally{if(f)throw v}}G.isElement(this.element)?this.replaceNode(this.element,r):this.element=r}else this.logger.error("render:","this template is not html string","html:",e)}},{key:"replaceNode",value:function(e,t){if(e&&t){var r=ot(e),a=ot(t),l=r.length,f=a.length,v=Math.max(l,f);if(v<=0||e.tagName!==t.tagName)return e.replaceWith(t),void(this.element=t);for(;v--;){var w=r[v],A=a[v];if(w)if(A){if(w.tagName===A.tagName&&G.syncAttributes(w,A),!w.isEqualNode(A)){var H=Math.max(w.childNodes.length,A.childNodes.length);if(H<=0)bt(w,A,w.parentNode);else for(var ce=0,ye=H;ce<ye;ce++){var _e=w.childNodes[ce],xe=A.childNodes[ce];(_e||xe)&&bt(_e,xe,w)}}}else w.parentNode.removeChild(w);else e.appendChild(A)}}}},{key:"show",value:function(){this.data.display="show",this.element&&(this.element.style.display="inline-block")}},{key:"hide",value:function(){this.data.display="hide",this.element&&(this.element.style.display="none")}},{key:"resetPosition",value:function(){var e=this.element.parentNode,t=e.offsetWidth,r=e.offsetHeight;this.element.style.marginTop=(r-this.element.offsetHeight)/2+"px",this.element.style.marginLeft=(t-this.element.offsetWidth)/2+"px"}},{key:"replace",value:function(e){this.element.replaceWith(e),this.element=e}},{key:"update",value:function(e){this.element.innerHTML=e}},{key:"addEventListener",value:function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return e.addEventListener(t,r,a),{destroy:function(){e.removeEventListener(t,r)}}}},{key:"removeEventListenerAll",value:function(){var e=this;Object.keys(this.eventsList).forEach(function(t){e.eventsList[t].destroy()})}},{key:"getComponent",value:function(e){if(e!==void 0)return this.options.componentsController?this.options.componentsController.getComponent(e):void 0}},{key:"getHTMLString",value:function(){return this.element.outerHTML}},{key:"destroy",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.events.emit("Component_"+this.id+".destroy",this),this.removeEventListenerAll()}}]),n}(z),ut=m(8),we=m.n(ut),qe={formatHHMMSS:function(i){var n=parseInt(i,10),e=Math.floor(n/3600),t=Math.floor((n-3600*e)/60),r=n-3600*e-60*t;e<10&&(e="0"+e),t<10&&(t="0"+t),r<10&&(r="0"+r);var a="";return e!=="00"&&(a=e+":"),a+t+":"+r}},lt={formatBytes:function(i,n){if(i==0)return"0 Bytes";var e=n<=0?0:n||2,t=Math.floor(Math.log(i)/Math.log(1024));return parseFloat((i/Math.pow(1024,t)).toFixed(e))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}};function kt(){var i=we()([`
  <gp-poster class="goldplay__screen--poster">
  <img src="`,'" width="','" data-display="','" heigth="',`" class="goldplay__screen--poster-image">
  <gp-speed class="goldplay__screen--poster-speed">`,`</gp-speed>
  </gp-poster>
  `]);return kt=function(){return i},i}var Kt=`data:img/jpg;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAA+CAYAAABuk1SaAAAZ2ElEQVR4nO2de1wV1fbA157ZcyTe
6sjj8FJeoqghiJAovsAHkJSUmpZl3bTHTe/NzO71k131Z97y9tJft9SrojdNLTQUH6iR4EcTUTRN
BERCRAQcURCUnNfvDzl2OMzrPDDsd75/wZ6ZvdfMnLX3XmuvtQfAjh07duzYsWPHjh07duzYsdMp
QFKFoig+aDnsAEC0F9UzxgNiORG4L8+y31pSh7czxiQBmBeAu9rEcbaW8f8DCP2mFvh3lOOhIc6H
Ch2tFxOeDeKn+TuDv8N/RD9b1e3tjPHUEJg6py8/pyAV/AEAlpwil2i9PlZPBQ/xEIdEdBcfjewu
RJ5NAy/aAcKYFiguTCMqL96C8tIGoqSsEZUV3YSi/KtsuaWyxvtSfRP1YsLzIfzzrjpwdV8vhlha
18NCh40g0V5UzxA3CO3pLPbEBOD6X1H91dtQff4mFBcxbJ3VDTwAwmnKY3EUvyStpzgRAGgAgMom
KPTfJEbZov4RflS/7xK4He46CDaUMS1QTG8Q+6hdOyaAilzwKL9guLcYb5BNA0xxAxR/V0FmbrqI
vjp7ja3RclGkJ+W/bBC/bKyvOMbQViGD9kdmCGM1tvtQYTyC2ExBBvSg9MO8YegT/vyTiT5iQmux
1Itjau9A3Yoi8rOMX9D24ussY3ZjD4AxAVTk/nFcNpjcw4KT5KylJ7jV1tY/zJcKO5zMHTatP72U
+NcLP/DzlK5dMZRcODtceMP0WjNh1pQQ/1l6Ci2taOCa5E6aGKyL3z6azTBta/YxPG3FT+xmK9rv
tBgrCGFtZalB1JCs8cT6MxO5nz5/jNua6CNOgXsPU+7l0Z6PQN+lUfyq4qe48wuj8WvWymBrIjwo
XynlAAC42IgsnqIY8HPFDlLKAQDwqwB3la7NeZzYagPlAACgX+4tvFMxhf8lpRcVK3VCrJ4KllIO
AIDyRrD6OTwMWKwgw3ypsIKJxN7MBC4zxV98ASx7YfTiSH7RkSeITEvl6Ai2jOK+Bpn7qWiCCmvr
fyYYTZWrn0Dy7yRrPLF+lF4cJXethdBZY7hdU3tTY0wPZCZwmXJtVTZBpQ1l6LRYpCBLBuPZh5O5
w9E9xHFgg54szlMcciCF+NrKemxChAflG+YGYXLHq5vFamvbyKuBvCWnyDktPFRpveaV/tRTKf5i
CthWOQzQm0dwm2K8qUBDQZwPFer5CHjInM/U3BY02S8PO2YrSHYysendgfy70P5FMeW34Pj8AvzS
+Gwc3X879g7ZhruGZ2DP+N04fHouTs6qROkAIGVz0Ik+YsKbEXi6BfdgU07XsVUTDuDUyiYolDou
iCBY28axarbs3ePcihF78EiQfh5tCOpKuX45hPsCOkY5DNDfjOK+Mfxz5ApbmvY9TmNaoFjq5Lpm
3urn8DBglpv39NPowFhfiIC2L4phWoCZeYSatb3sbt4H0pfWAUARAOyRM34BgP44hv/IzxVvu9zI
tZgjl63ZWc4eDelKjb4wibsARnJyAtSwvLKNYA7Hqtmy0imoNNRN+Yf/9gBhPnSscgAAgL8z+E8J
pRK2lLIHAQAyyti8CA8q8fST3Cnj9mvvQJ1nRwvTSdA8gmQnE5siurVXjk0Xic30BrHP9rK7eVrq
2X+JLYzZiWNAZiQZ7IEGa5WpI7lwg72ZXkqkG5edqUdnaps5m/act3m4rXZO9hUyO6cabQMNo42V
0DNC+BnGBafr2KrMS2incdm5G+jnDpaj06BJQRYMwjONfeCtMGtLiHXTDvJzzG00/ypbbvrjM+BK
gau59XUUZ2+is8b/19wBm8+7HUlwVDtne9ndvFG7hMlp3+M00KYkzOl6OLi2hPhwz2W0UeM1AAAw
1lccE9SVavMOTtcTp4z/r2uBh2IdyxaoTrEiPSn/wif4pWAyxBc3QPFLh/j5ljb8+Xni8xdChRdM
6mWOX4PjltZpa1gBtQnVaObUe/uOJKOMzetLU+FFadw5kJ9yMc/m4ue+Kmb3RbQWeDiRRKwnEftp
LPdJoAsEKlwLAEAHOENPADhjKLhr4nq+xSLZdZM/GqojyBdDeCnjkJmSg5+xpuGCGrbilaP4Vfit
d2OezcXPnetEq+wYiW06EB0But9LFgNFDFsXuws/BjKjwsoiYuVXxew+47K6Zl7YWc4eDdwsxmRX
of1qbXg5gpfx/yRq25F2IX//5/CgUFSQMQFUZIyH2M4mSC8l0k/XsZpdlHJ8eZb9dsB2/GjqQRwX
+g3ubfpiOxu0g+0NZQHM94odq2bL5KaoOyqI75Sufe4Qeg5UplxOWHna100ndlOT8Y+CooLM7cfP
BYnR44ti4gtbCXDmGludeZE9WlrP1tuqzo7iERIcfm8ZDKSXERukymtV7KS6Zl5YdIpcpHROIwuN
Sse7dKLn0NHI2iB9acqjKE1st7pafgvKrYkIfZjRkaLVU4sYbyowugcM9nUUfXu6CAFTAuUXJZW4
2CCWSZXzGtZpjtWhYwqHmfM3pNc+DHSGqaatmB5GJbnqwDXvKuSduca2WwSWVZBRepAMaUi/QG5Y
bGMhO4LQblS3QFcIDHKFwBu/ws2SBiiubhKrrcmRcFSZeigxOZQa9W4E927+BOgHNljT+JUX7zax
UOFMQU/jcqVQFQNNHMga2Udq0VGpH4oxLhQ4axa0FT9X7ODliLwCXSGwhwN4dCFFHSsgrv5XqP/l
FpRfuiVWVj3A9S+9C9btGcfv3jj8/tIFkxpEpWZeZI8anyerIIl6PlGq/Pg11Gm8TKZ4OmEitRd6
4qUQ/qXSp8XBYPJD5ASoWT4Ef7KtHG0rqGErzK3fCZv/w/B0wsTqYcKarSPFCabyWENdMy9UTkP1
pgqiBb0j6GUOMR+cIT/YKXPQgDkjaUovKvbZYH7a5WfuB7HKwawYSq5ceY5YceEGe1Nr/ZaSEoBS
IrpBglERvXUkt9XDiQwAI7tQsrfRu2BdaoA4QerY5U4apDYxWBd/7in+3Oo4LiPGQ0wCiZeBCfCa
15//oCCVK/jXEPyOuW2Y673xdcUOBU/wBakB4osS8jCbLhIrzInHshXJfkKyVHlONcrZWd62B5VC
60i6JZFYmTWG2zUlUPwzqHcO9OxwYdGFSdwF45iwjkK8NxVt46xwIMG3bzeir3GZpIL4OCE9SNxQ
9W04U98idjpj+u9ReOb20WwG7dBmPs/k16E9G8uIjzMvoXXVt+EM/PZA6Lf683N/noR+8HXFmg1O
ZwzOnk5Yc/RB1lh+l78zRJoUM5+fJxbrN5M+0w7yc4puoCKt9dmCAT0o/fRgQSrmjfnTYeJlLXVo
GUmzxhPrpwSqjhpS0EdSuCMeTqTqc/Z0wsTMftTE7GRiU+10dO700+jAlFAqQe06AIA159jvFhaS
70FbJWHumKx1SU6xertLG44XGlBZZ8tznjsQT/9ocJuFTObNfHJu5iX03cUbbGOM0bmj/KgBc8L5
Oa2jI92vK4w4+jh/BAA0ZQhiArxa5/iqhvDyIfjtef0hwqSYmfwDnry1lM15vbXAmRLNnrZZw3eJ
3A6QGM3id+Ph5TdZRe+VAbWRdEIgNWRnouWRx5gAr0lBxCQA2CJ3TqA7di2ZxJ80zsb0fAT6bhnJ
RczoQ81Yf57NUmtncQH379rp6HXPR+5ni1bmX2XLVXPSe7uKoTKC2yyHfUAPSh/rCbE6AnQ6QtRh
AmEAAF4UOVEE4ETE3RXgLi8AhxAQzlh0PnAF7TdOE43zoUKPpPAfgZFyROzAA0/XsVUfS7SZc5k9
AwAvvR1JvfhhNPcBAND+zuC/ZgS57OVD/N+0yI00GMGt0QfzwCRKIO17nJZRxmqKWesIDqQQXyf6
gOn0hUnZjx/Pq2I1j2QOKm7eVH8hFay0t1ptYFkF+Xa08I2xchhBr4/n1gNADy3trC8l17/zKL8c
AOBoHTrqb3Jc8gevdxR9pMrDu4p99S5YV32Lszqi9Xgql+9Agq8512RUoNUAMMvw/9ph3FowUo4R
e/BILQuYHxay69aOIHu/1Ft4G+5l1v1pmC+14XAVq+jeBNDmJXpvIP8emPxA0kuJ9N9LOcJpyiMj
gctI9IEwE7mYcdl4/L4K9oQ59akpiLej6KV0vIW/X48sSouyiQG6iAPjRNOpaxtSg6ghph4pKX6+
+VvgZQFDFEwxOS75sq+1oGtS5e46CPZ4BMkl0ZhF9W0wO/HoSjO6Yvg7pRcVa5zYlHkJ7Tx0mdUc
ZfpeITKef9J/G6BxBFE5Hk5THhIODubTc8RnWmWzBtN8ldmPUlPPpXHnwtxgKBgpRwsPVVGZOMpc
5TCgZCPk1pC5EsXMolPkG1GZOCD0G9Ip9BvSKexb3GNcNo6WCqjESH62Ek0L7TyUJtCDuouD1O4B
AODmr2DwmDFSHlrJmyxvks+7jqTbGZ0WkXoAp4J54dvMpz+jTw3/vNybfxmMHtKGMiy5sixHVSPX
sqUc3R/Ck/zEpAE9KDn3533UplhShmlxAxTbIjRHC/UtQj3AvXWX8qkof0Us95mJPEzmJbQucCsZ
dLKGtdQjSSOFriK9RExvdYrc5+0CPP+949z/nqxhKysbuNuVDdzt4usss6+CPZG0R3i+4Bpqo6ic
CLK2Li8iVTt4cA8hRu0cAAD3LuBu+FtqBiH5sssaQHKVFgDg1TD+VS0Nq3H2Gluz6SKhdVcMZuoh
PK38JtcIAODvhh1Nemnmp+viaXNl+L6a/N7oX3qYNwxVu4ZQCc+ZGcbPMi07VksorVzblKeDiKcy
xhKrto7ktga6gGlPy7xyFL+auk94ydppstJUs7aZE2J3ko+tKSH+CfcS6orTS4R0qXMjPCjfZ8Oo
cZ6PiJpnJj/Vt/FISjLWVxwT6I5VUyf6uYv9AAAOXEEHpY5LDmOtax0MSAxj0T3EQXE+VOiRK2yp
WuO24kgtOrq5hL0fhRrRHZkmbsHFG9o8MMZUNbddgxij58cCwDala6hWZ4IUUV6U/8nU9nnc136V
nrJ2BJ8/xm2VKGZyqlHOnGPkHK17YalB3nPYyPbklQ3cbQD4W1BXahkAQF0ze3/q19MNOyf6ooQn
A/gnTz8pvWalxL4K9gTMUpvsAj3UCw0FgD1KJ0XRQhQAQGYlmSm1Mi7ZC1y4wd78+QbIzefpVuPY
avq4iZrikFYUkW3m72ESbmi9CzY7PshN99vwCgAw+t6OIYqQCp68OM+283wDXQixQ4L7WnjQEprB
TM/Fz4/aJUy2lXIAKNsIxly8wTYaOq84Hyo0fSS5vGIK/8uaodyOJD9xOljo7Xr9R/w6qIwif4/g
VO3K1j3cmKO1IGnQyw6Te6vIvXLHwtwgbMVQcqFa40qEdKXcI2llT4SBssa2U76+boLpzoN0qDuS
dE0rMcRDGGL8vzMFziFdKXe58wEAKAUFGebJD5MqD3YVg8yVTQ1fV+zQmvwkB7PkFDnHexPpvbGY
VexFLYEkkOYF01g9FZw5jlh7JIU78kKo8BYYeR4LrqF9Lx7GqbG7cAiYYZN+fobdVn5LeW+uMDcI
Sw2ihsgdj/Cg7ntRC2ul7THZm8ypRjkgLzA9O1x4w5JwDQOz+oivgMbeg+XbDuUhbu3Xacb5iOPM
laF1AzZj6G4OoJjrYJo8ZEwfd+kRMclPTDJXNiUmh1Kj8lL4XEyAlDuVWVhIvh6yDYe8e5xb0VEL
u0rPwZiF0fi1Y49zP5qE2zAZFWh1XBaOi94ujF9XxO48Vs3K2r1yPJ2DnwZlpaI3xHOyzpvBHvds
tFXFhOxOmfIjSAV7oomVj/qE1nCN3AlERrQX1VPhvHakBVPxb/Xn52o938epbXCdlIv4nUf5+eaE
jcwdKL3FkMo9Kxqn11uQbBjOs2GUpAKbmzC1ZgS5zMgAb0fiPipxcQH3744O+NOyaJw1nli/OJJf
BCaOgjfzyblp2cIsa+3YkzVs5dzj5FxQUBJ3HbgvjcF/kTo2pRc/GQBgTxWxW+56xWFy2RlymYqM
9HBvcWJBKleQPpJcntKLilXyj3s6YWLBIDwzYzQnuZ2lHP8YyLdJ8Cm+SZyXkmV9vLBeS33je1KD
PhrcZgXeAKMWa0YqKEhxA5JbaKS/Gs79N5ym2hnwnCBv6Jry9yg88+Xewp9A4dldbBAeSK6O0nMA
AMgYS6yS2uguvZRI//g0t9FWcnx0ituYVYmyQGG2syCCXzC+J9VmXcTfDTu27lLJHKsRZb2Mije5
sRS07ohBvxAqvJU1hvuxdJJQsieJ2LBoMP7z9DAqKTFAFzExWBe/chi58NIz/KWlUfwqMNMwi/EQ
B68ZQS4zGOKn65GkSzfRR0zInUBkyK1neDtjPD+SenHvWG6vlAy5V1Ge2pREyUg/eZ04qXApfS6N
Ozf7UWpqWHeK9nTCRIw3FRjsKhkuIclYH2GslNzGdHdADyQdVmmKNT2MSjLeEd+YTeXkJlvLkrJX
mFF7R3GnFXrvWG6v8e8iwQclAACdUYG2K23lpDhMXm7kWuYOxHNleltJ3HUQnOQnBif58bbcJZF+
ubfwDoUIDADzTl4TC0HaDU0P9xYnnpnIxWeOI3buriJ3VzdDtasOXOM8hbir04TXlO4j+wqRPVxF
ECUj/VA1HJKR6758K2I5i38gq0rIVcO9uXgAoHOqEYzSt9+F3+UBbZukNNX8RyTXLtTGQAsvdkhS
1LAsPKz0aa5Erl0AoM9M5H7ydcV+VY1cy/9EcUsAgFlfSq5PU6hX1RPx0SluYyfZqJj5soRYBQBQ
0cA15V5FSnFNdGqA+OLqOC4jawz34+YRXPbrfYSFoJKwk3MV5agJodRzltaz9fl1HZdQtrmE3T/h
wD2Pz7OHiC5NbPtz3LsgRS+crZCbYg3oQemVvGvxXmK8ZLkv1VeqXCul9Wx9/G48HFSM9pwk/vu/
R+GZhqSxrF9YxUVcTa665P04WaXhjoCpvQNFTAsUrywi3tNvJn2MPR2tayM2kym/Dh039aQgibUo
tZX0f5xql2NgU3aWs0ePVbNlThg5OlPtjzti0eK0YDmklEFuBHHRgTModERLo/ilk0OpNutN0V5U
z7xkLtf4OnNsMwN5VWzRxO8pxc31Qt1gyPuD7k3zl58ll6vVqUlBzl5ja8Zn4/FKDdsYJi4Lx3lu
FMPpDWKfNw7zi01DIzLK2LzSBrDVaj4z/wTZbhM8qV0e1fz/eyvYE3JhC1rQujn2gO4wwNI2zMWV
Ets9B7mYtKvNYg2o9OJbR3Jbi6egwyuHkQu3JBIrC1K5AjBRKj9n0axIbwPby+7mzcjDM1RkAABg
NpUh1VAnzYs9eyvYE2raaSOY8dl4vBYX4DOH8DM2kIf55GfiE6lI4AAnMcC0DIGo+sxm5BFaXpAk
SkF6xgTJGPe22H3elECX9gudcrZY+U2uUcM0kw5zg6Fv9BUWyaXjBrpA4DBfyqIdX9afZ7NmH8Nz
QOEd5F5FeVoCSM36/MH2srt5w3bjYU2s9R+RkYEZl43H79UYgn2yhq2c8oNVSsJkV6H9fz3Cvy91
cEA3sV0vrSUfpKqRawnPwOGWPKdgF1GTV8vDQTq4T4t85jKwu2iaGanIh2fJD8D6jktzCoIUK35i
N79dgOfLyMF8VoQ1pR+Y/TAPV7HFQVvJoE9+JhbING4JTGUTFFqSn7CllD1o4fSP+fw88e+xu4Vp
cidIhcJojUE6x7B1od+QvVcVE++bI9tYX3GMFoPVTSe6SZWr2UjmonfBOn9nME20AwrJp91mlLF5
rTs/ar1vJr8O7TE9P8lPTDIOBzGXDwvZdVJKUnsH6rR+jcCih1nbzAl/PcK/H7EDDzT3ByABs+QU
ucR/kxhlaX7C3gr2hN/XpN8/fyLnaZCFyb2Kto/ag0e/nse/Z66sV+9oT/SqvsXdnZXLL4jKxFHL
z5LzWz9GoyYfnZfM5aptPnC5GV2Wlg9Z/QUsYzhBlJryMWo73b/wAz9v6WlyKWh4H68cxa/G7BCS
//wjfsP0/Faj32I+LGTXtdZ7v715x7HiR1KNsclXbv3dsOM4PzQu2ZdPHu4txsvkChvDVDZB5X/L
yP9uuIA22nLbUW9njOP1KH6opzA0yEUM8ncW/RvuosaKJlRReB2dPFCFDqptjGZgehiVtHE4twFa
NxZbcopc8u5xboU18oXTlIe/M/j7OoGvjgSd6U6IJALCz1H0L2DQcaUU3ZCulLvpB3466tPMr/Sn
njL6whUzvwDP/6CQXafl2tYMyydieggxAS6ivwMJDtdbUP3FW6js0FUid99lcZ+xA2ZhNH5tahD/
TFcddNv2C7H1jcO81fsUBnWlXC9O4hoAAG7ehTK177t3yGegDehdsK6XK+rp5wT+ekdRr3cEvQsl
ugAA1N1BtZXNqPJCI5SZkx77e+Lvhh31Tkh/6y40dqad5wHubQ/7VC/xKT8n0a+skbiwuUzc3FFf
5wp0x67eTsjregvUd9ZPd8tRmEZkR9LiGNC4cUaHKogdO52JTQnkZ9OChKkAQOfXoT0xO6Q3zTPG
pt9Jt2Ons7IwGr9mUA4AYF48TM5Qu8YUm+1zZcdOZ2JmP2ri6rj7ofbMm/nkXEumyPYplp0/HDP6
UCmtm8fRAAA51WjbqF3CZK3X220QO39YWreivR993sRCRcg2MsSczEq7DWLnoSfSk/K/OQNdeLEv
NQHg3o4ymeOItSapGcygTBxtTdqxfQSx81CyYBCe2Zp8Z+xybpPa23877m/JTi6qm1fbsdPZobuI
BmVolzadX4eOT84hJlc0sFZ/rto+xbLzUJJ/jTgO7cNYmPkFeH7MDiG5ooGzybfc7VMsOw8tS2Pw
X+YP4Oc3cdD0nxJy7epitNoWYUtIKlPOjh07duzYsWPHjh07dh4A/wcMRwRD90zgYwAAAABJRU5E
rkJggg==`,Qt=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(kt(),"poster","width","display","height","speed")),h()(p()(e),"data",{poster:"",status:"",display:"show",speed:"",width:"",height:""}),h()(p()(e),"options",{}),e.options=t,t.player.poster?e.data.poster=t.player.poster:e.data.poster=Kt,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"resetPosition",value:function(){if(this.element){var e=this.element.parentNode.offsetWidth,t=this.element.parentNode.offsetHeight;this.element.style.width=e+"px",this.element.style.marginTop=(t-this.element.offsetHeight-20)/2+"px"}}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.LoaderUpdateSpeed,function(t){e.data.display==="show"&&(e.data.speed=lt.formatBytes(t.speed)+" /s")})}},{key:"hide",value:function(){this.data.display!=="hide"&&(this.element.style.opacity=0,this.element.style.display="none",this.data.display="hide")}}]),n}(Be);function Zt(){var i=we()([`
    <gp-control class="goldplay__control--container `,'" style="width:',"px;height:","px;opacity:",'" data-status="',`">
      `,`
      `,`
      `,`
    </gp-control>
  `]);return Zt=function(){return i},i}var Jt=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Zt(),"containerFloatCss","width","height","opacity","status","progressBarName|component","sideControlBarName|component","nearControlBarName|component")),h()(p()(e),"hideDelayTime",void 0),h()(p()(e),"hideTimeCount",void 0),h()(p()(e),"data",{progressBarName:"progressBar",sideControlBarName:"sideControlBar",nearControlBarName:"nearControlBar",width:"",height:"",opacity:1,containerFloatCss:"",display:"show",status:""}),h()(p()(e),"options",{}),e.options=t,e.hideDelayTime=e.options.player.controlBarAutoHideTime||3,t.player.controlBarAutoHide&&(e.data.containerFloatCss=e.options.cssName.controlContainerFloat,e.resetPosition()),Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"initProps",value:function(){this.hideTimeCount=this.hideDelayTime}},{key:"bindEvent",value:function(){var e=this,t=this.options;t.player.controlBarAutoHide&&(t.$container.addEventListener("mousemove",function(){e.hideTimeCount<=0&&(e.data.display="show",e.show()),e.hideTimeCount=e.hideDelayTime}),setInterval(function(){e.hideTimeCount>0?e.hideTimeCount-=1:e.data.display!=="hide"&&(e.data.display="hide",e.hide())},100))}},{key:"setSize",value:function(e,t){e!==void 0&&(this.data.width=e),t!==void 0&&(this.data.height=t)}},{key:"show",value:function(){var e,t=this;this.options.player.controlBarAutoHide?(clearTimeout(e),e=setTimeout(function(){t.data.opacity=1},1)):this.data.opacity=1}},{key:"hide",value:function(){this.data.opacity=0}},{key:"resetPosition",value:function(){this.setSize(this.options.$container.offsetWidth,this.options.player.controlBarHeight)}}]),n}(Be),en=de.a.get("Delegator.js");function At(i){return typeof HTMLElement!="undefined"?i instanceof HTMLElement:Z()(i)==="object"&&i.nodeType===1&&typeof i.nodeName=="string"}function Ln(i){i.preventDefault(),i.stopPropagation()}function Dt(i,n,e,t,r){var a=function(f,v){if(f&&f.matches){if(!Array.isArray(v))return f.matches(v);for(var w=0,A=v.length;w<A;w++)if(f.matches(v[w]))return!0}return!1};function l(f){for(var v=(f=f||window.event).target||f.srcElement,w=f.currentTarget,A=!0;A&&v!==w&&v;){if(a(v,e)&&(A=t.call(v,f)!==!1),!A)return void Ln(f);v=v.parentNode}}t.__delegateWrapper=l,function(f,v,w,A){A===void 0&&(A=v==="blur"||v==="focus"),At(f)&&f.addEventListener(v,w,A)}(i,n,l,r)}var tn=function(){function i(n){return g()(this,i),h()(this,"element",null),At(n)?this.element=n:en.error("constructor","new instance","element:",this.element),this}return k()(i,[{key:"off",value:function(n,e,t){return e.__delegateWrapper&&delete(e=e.__delegateWrapper).__delegateWrapper,this.element.removeEventListener(n,e,t),this}},{key:"on",value:function(n,e,t,r){var a=this;return Array.isArray(e)?e.forEach(function(l){Dt(a.element,n,l,t,r)}):Dt(this.element,n,e,t,r),this}},{key:"once",value:function(n,e,t,r){return this.on(n,e,t,{capture:r,once:!0}),this}}]),i}(),ct=null,Te=function(i){return typeof i=="string"&&(i=document.querySelector(i)),ct?ct.element=i:ct=new tn(i),ct},nn=function(){function i(n,e){var t=e.$container,r=e.type,a=e.scope,l=e.onStart,f=e.onDrag,v=e.onRelease;g()(this,i),h()(this,"$container",null),h()(this,"$ele",null),h()(this,"active",!1),h()(this,"offsetX",0),h()(this,"offsetY",0),h()(this,"offsetLeft",0),h()(this,"offsetTop",0),h()(this,"orginOffsetLeft",0),h()(this,"orginOffsetTop",0),h()(this,"orginOffsetWidth",0),h()(this,"orginOffsetHeight",0),h()(this,"initialX",0),h()(this,"initialY",0),h()(this,"type","default"),h()(this,"scope",{}),this.$container=t||document.body,this.$ele=n,this.type=r,this.scope=a,this.eventsList={},this.onStart=l,this.onDrag=f,this.onRelease=v,this.bindEvent()}return k()(i,[{key:"addEventListener",value:function(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return n.addEventListener(e,t,r),{destroy:function(){n.removeEventListener(e,t)}}}},{key:"removeEventListenerAll",value:function(){var n=this;Object.keys(this.eventsList).forEach(function(e){n.eventsList[e].destroy()})}},{key:"bindEvent",value:function(){var n=this;this.eventsList.mousedown=this.addEventListener(this.$container,"mousedown",function(e){n.start(e)},!1),this.eventsList.mouseup=this.addEventListener(this.$container,"mouseup",function(e){n.release(e)},!1),this.eventsList.mousemove=this.addEventListener(this.$container,"mousemove",function(e){n.drag(e)},!1)}},{key:"start",value:function(n){n.target===this.$ele&&(this.scope===void 0&&this.$container!==void 0&&(this.scope={left:this.$container.offsetLeft,right:this.$container.offsetLeft+this.$container.offsetWidth,top:this.$container.offsetTop,bottom:this.$container.offsetTop+this.$container.offsetHeight}),this.offsetLeft=this.$ele.offsetLeft,this.offsetTop=this.$ele.offsetTop,this.active=!0,this.initialX=n.clientX,this.initialY=n.clientY,this.orginOffsetLeft=this.$ele.offsetLeft,this.orginOffsetTop=this.$ele.offsetTop,this.orginOffsetWidth=this.$ele.offsetWidth,this.orginOffsetHeight=this.$ele.offsetHeight,typeof this.onStart=="function"&&this.onStart.call(this,this.offsetX,this.offsetY,n,this))}},{key:"release",value:function(n){this.active=!1,typeof this.onRelease=="function"&&this.onRelease.call(this,this.offsetX,this.offsetY,n,this)}},{key:"drag",value:function(n){this.active&&(n.preventDefault(),n.stopPropagation(),this.offsetX=n.clientX-this.initialX+this.offsetLeft,this.offsetY=n.clientY-this.initialY+this.offsetTop,this.setPosition(n))}},{key:"setPosition",value:function(n){switch(this.type){case"vertical":this.offsetX=this.orginOffsetLeft,this.offsetY<this.scope.top&&(this.offsetY=this.scope.top),this.offsetY>this.scope.bottom-this.orginOffsetHeight&&(this.offsetY=this.scope.bottom-this.orginOffsetHeight);break;case"level":this.offsetY=this.orginOffsetTop,this.offsetX>this.scope.right-this.orginOffsetWidth&&(this.offsetX=this.scope.right-this.orginOffsetWidth),this.offsetX<this.scope.left&&(this.offsetX=this.scope.left);break;default:isNaN(this.scope.right)||this.offsetX>this.scope.right-this.orginOffsetWidth&&(this.offsetX=this.scope.right-this.orginOffsetWidth),isNaN(this.scope.left)||this.offsetX<this.scope.left&&(this.offsetX=this.scope.left),isNaN(this.scope.top)||this.offsetY<this.scope.top&&(this.offsetY=this.scope.top),isNaN(this.scope.bottom)||this.offsetY>this.scope.bottom-this.orginOffsetHeight&&(this.offsetY=this.scope.bottom-this.orginOffsetHeight)}this.$ele.style.left=this.offsetX+"px",this.$ele.style.top=this.offsetY+"px",typeof this.onDrag=="function"&&this.onDrag.call(this,this.offsetX,this.offsetY,n,this)}},{key:"destroy",value:function(){this.$ele.parentNode.removeChild(this.$ele),this.removeEventListenerAll()}}]),i}(),Rt=function(i,n){return new nn(i,n)};function Ot(){var i=we()([`
    <gp-control-progressbar class="goldplay__progress-bar `,'" data-status="',`">
      <div class="goldplay__progressbar--load `,`">
      </div>
      <div class="goldplay__progressbar--play `,`">
      </div>
      <span class="goldplay__progressbar--dot `,'" title="',`"></span>
    </gp-control-progressbar>
  `]);return Ot=function(){return i},i}var rn=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Ot(),"progressBarHoverCss","status","progressBarLoadHoverCss","progressBarPlayHoverCss","progressBarDotHoverCss","time")),h()(p()(e),"options",{}),h()(p()(e),"data",{playWidth:"",dot:"",time:"",status:""}),h()(p()(e),"setProgressBarSize",function(r){e.$progressBarPlay.style.width=r+"px"}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){var e=this.options.cssName;this.data.status==="dragstart"?(this.data.progressBarHoverCss=e.progressBarHover,this.data.progressBarLoadHoverCss=e.progressBarLoadHover,this.data.progressBarPlayHoverCss=e.progressBarPlayHover,this.data.progressBarDotHoverCss=e.progressBarDotHover):this.data.status==="dragend"&&(this.data.progressBarHoverCss="",this.data.progressBarLoadHoverCss="",this.data.progressBarPlayHoverCss="",this.data.progressBarDotHoverCss="")}},{key:"afterInit",value:function(){}},{key:"initProps",value:function(){var e=this.element,t=this.options.cssName;this.$progressDragDot=e.querySelector("."+t.progressBarDot),this.$progressBarPlay=e.querySelector("."+t.progressBarPlay),this.$progressBarLoad=e.querySelector("."+t.progressBarLoad),this.timer=this.getComponent("timer"),this.pauseButton=this.getComponent("pauseButton")}},{key:"bindEvent",value:function(){var e=this,t=this.options.cssName,r=!1;this.events.on(B.PlayerTimeUpdate,function(a){var l=e.options.loadData.sourceData.duration;if(!r&&a&&l){var f=a/1e3/l*e.progressBarWidth;e.setProgressPosition(f),e.timer.data.time=qe.formatHHMMSS(a/1e3)}}),this.events.on(B.PlayerbufferUpdate,function(a){!r&&a&&e.updateProgressLoad(a)}),Te(this.options.$controlBarContainer).on("click","."+t.progressBar,function(a){if(a.target!==e.$progressDragDot){var l=(e.options.loadData.sourceData.duration||0)/e.progressBarWidth,f=0;a.target.classList.contains(t.progressBarLoad)&&(f=a.target.offsetLeft-a.target.parentNode.offsetLeft);var v=f+a.offsetX,w=v*l*1e3;return e.setProgressPosition(v),e.logger.info("bindEvent","click to seek","seekTime:",w,"offsetX:",v),a.target!==e.$progressBarLoad&&e.clearLoadBar(a.offsetX),e.timer.data.time=qe.formatHHMMSS(w/1e3),e.events.emit(B.PlayerOnSeek,w),!1}}),this.progressDragEvent=Rt(this.$progressDragDot,{$container:document.body,type:"level",scope:{left:this.progressBarLeft,right:this.progressBarLeft+this.progressBarWidth,top:this.$progressDragDot.offsetTop,bottom:this.$progressDragDot.offsetTop+this.$progressDragDot.offsetHeight},onStart:function(){r=!0,e.data.status="dragstart"},onDrag:function(a){var l;l=e.options.player.controlBarAutoHide?a:a-e.options.$controlBarContainer.offsetLeft;var f=0,v=e.$progressDragDot.offsetWidth;e.progressBarWidth-l<=v&&(f=v),e.setProgressBarSize(l),e.data.status="draging";var w=e.getSeekTime(e.progressBarWidth-f);e.timer.data.time=qe.formatHHMMSS(w/1e3),e.data.time=e.timer.data.time},onRelease:function(a,l,f){if(r){var v=e.getSeekTime();f.target!==e.$progressBarLoad&&e.clearLoadBar(a),e.events.emit(B.PlayerOnSeek,v),e.logger.info("bindEvent","onDrag release seek","seekTime:",v),e.data.status="dragend",r=!1}}})}},{key:"setProgressPosition",value:function(e){var t=Math.min(e,this.progressBarWidth),r=this.$progressDragDot,a=this.progressBarWidth,l=0,f=r.offsetWidth/2;t>a||a-t<=f?l=f-(a-t):t<=f&&(l=-(f-t));var v=t-l-r.offsetWidth/2;this.setProgressPlayWidth(t),this.setProgressDragDotLeft(v+this.progressBarLeft)}},{key:"setProgressPlayWidth",value:function(e){this.$progressBarPlay.style.width=e+"px"}},{key:"setProgressDragDotLeft",value:function(e){this.$progressDragDot.style.left=e+"px"}},{key:"getProgressPlayLeftWidth",value:function(){return{offsetLeft:this.$progressBarPlay.offsetLeft,offsetWidth:this.$progressBarPlay.offsetWidth}}},{key:"getProgressLoadLeftWidth",value:function(){return{offsetLeft:this.$progressBarLoad.offsetLeft,offsetWidth:this.$progressBarLoad.offsetWidth}}},{key:"setProgressLoadLeftWidth",value:function(e,t){var r=this.progressBarLeft+this.progressBarWidth;(e=Math.min(e,r))+t>r&&(t=r-e),this.$progressBarLoad.style.left=e+"px",this.$progressBarLoad.style.width=t+"px"}},{key:"updateProgressLoad",value:function(e){var t=this.options.loadData.sourceData.duration;if(t){var r=this.progressBarWidth,a=this.progressBarLeft,l=e[0]/1e3/t*r,f=e[1]/1e3/t*r,v=Math.floor(a+l),w=Math.floor(f-l);this.setProgressLoadLeftWidth(v,w)}}},{key:"getSeekTime",value:function(e,t){var r=this.progressBarWidth,a=(t=t||this.options.loadData.sourceData.duration||0)/(e||r);return this.$progressBarPlay.offsetWidth*a*1e3}},{key:"clearLoadBar",value:function(e){e<this.$progressBarLoad.offsetLeft-this.progressBarLeft&&(this.$progressBarLoad.style.width="0px")}},{key:"getDragDotPosition",value:function(){return{offsetLeft:this.$progressDragDot.offsetLeft,offsetTop:this.$progressDragDot.offsetTop,left:this.$progressDragDot.style.left,top:this.$progressDragDot.style.top}}},{key:"clearDragDotTop",value:function(){this.$progressDragDot.style.top=""}},{key:"progressBarWidth",get:function(){return this.element.offsetWidth}},{key:"progressBarLeft",get:function(){return this.element.offsetLeft}}]),n}(Be);function an(){var i=we()([`
  <gp-button class="goldplay__control--play" data-status="`,'" title="',`">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  viewBox="0 0 232.153 232.153" width="20" height="20" style="enable-background:new 0 0 232.153 232.153;" xml:space="preserve">
  <g >
  <path style="fill-rule:evenodd;clip-rule:evenodd;" d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266
    c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267
    l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z" fill="#f1f1f1"/>
  </g>
  </svg>
  </gp-button>
  `]);return an=function(){return i},i}var Sn=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(an(),"status","title")),h()(p()(e),"data",{title:"play",play:">"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),n}(Be);function Mt(){var i=we()([`
  <gp-button class="goldplay__control--pause" title="`,'" status="',`">
  `,`
  </gp-button>
  `]);return Mt=function(){return i},i}function on(){var i=we()([`
<svg style="display:`,`" class="goldplay__control--pausing" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 26 26" style="background:none" xml:space="preserve">
<g>
<path d="M2.667,0h6v26h-6V0z M15.333,0v26h6V0H15.333z" fill="#f1f1f1"/>
</g>
</svg>
`]);return on=function(){return i},i}var sn=ee.create(on(),"pauseHide"),Cn=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(function(r,a){return a(Mt(),"title","status","icon|html")})),h()(p()(e),"data",{title:"pause",pauseHide:"",pauseLoadingHide:"none",icon:sn,status:"",display:""}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){this.data.status==="pauseloading"?(this.data.pauseHide="none",this.data.pauseLoadingHide="inline-block",this.data.title="loading",this.data.icon=`
<svg version="1.1" class="goldplay__control--pause-loading" style="display:\${'pauseLoadingHide'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 612 792" style="background:none;margin: -4px 0 0 -5px;" xml:space="preserve">
<linearGradient id="goldplay-pause-loading-gradient" gradientUnits="userSpaceOnUse" x1="1.98" y1="784.6123" x2="26.2101" y2="770.623" gradientTransform="matrix(21.8571 0 0 21.8571 -2.0895 -16600.5293)">
    <stop offset="0.1682" style="stop-color:#f1f1f1;stop-opacity:0"></stop>
    <stop offset="0.7502" style="stop-color:#f1f1f1"></stop>
    <stop offset="1" style="stop-color:#f1f1f1"></stop>
</linearGradient>
<path style="transform-origin: center center;animation: goldplay-rotate-360 .8s linear infinite;" fill="url(#goldplay-pause-loading-gradient)" d="M306,133.714c144.257,0,262.286,118.028,262.286,262.286c0,144.257-118.029,262.286-262.286,262.286
  C161.743,658.286,43.714,540.257,43.714,396C43.714,251.743,161.743,133.714,306,133.714 M306,90C137.7,90,0,227.7,0,396
  s137.7,306,306,306s306-137.7,306-306S474.3,90,306,90L306,90z">
    <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0" to="360" dur=".8s" repeatCount="indefinite" />
</path>
<g>
    <g>
        <path fill="#f1f1f1" d="M229.5,514.028L229.5,514.028c-13.114,0-21.857-8.742-21.857-21.856V295.457
        c0-10.929,8.743-21.857,21.857-21.857l0,0c10.929,0,21.857,8.743,21.857,21.857v196.715
        C251.357,503.1,242.614,514.028,229.5,514.028z"></path>
        <path fill="#f1f1f1" d="M229.5,273.6c-13.114,0-21.857,8.743-21.857,21.857v196.715c0,10.928,8.743,21.856,21.857,21.856
        s21.857-10.929,21.857-21.856V295.457C251.357,282.343,242.614,273.6,229.5,273.6L229.5,273.6z"></path>
    </g>
    <g>
        <path fill="#f1f1f1" d="M382.5,518.4L382.5,518.4c-13.114,0-21.857-8.743-21.857-21.857V299.829
        c0-10.929,8.743-21.857,21.857-21.857l0,0c10.929,0,21.857,8.743,21.857,21.857v196.714
        C404.357,509.657,395.614,518.4,382.5,518.4z"></path>
        <path fill="#f1f1f1" d="M382.5,277.972c-10.929,0-21.857,8.743-21.857,21.857v196.714c0,10.929,10.929,21.857,21.857,21.857
        s21.857-10.929,21.857-21.857V299.829C404.357,288.9,393.429,277.972,382.5,277.972L382.5,277.972z"></path>
    </g>
</g>
</svg>
`):this.data.status==="pause"&&(this.data.pauseHide="inline-block",this.data.pauseLoadingHide="none",this.data.title="pause",this.data.icon=sn)}}]),n}(Be);function un(){var i=we()([`
  <gp-button class="goldplay__control--replay" title="`,'" data-display="',`">
  <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
  width="24px" height="24px" viewBox="0 0 245.000000 206.000000"
  preserveAspectRatio="xMidYMid meet">
 <g transform="translate(0.000000,206.000000) scale(0.100000,-0.100000)"
 fill="#f1f1f1" stroke="1">
 <path d="M1250 2046 c-286 -55 -525 -211 -681 -445 -91 -136 -152 -302 -167
 -453 -12 -119 3 -108 -143 -109 -70 -1 -156 -4 -192 -8 l-65 -6 262 -265 262
 -265 266 265 265 265 -62 6 c-35 4 -123 7 -197 8 l-134 1 7 69 c26 284 232
 543 504 635 201 69 404 53 596 -47 62 -32 103 -63 177 -137 83 -83 102 -108
 142 -190 63 -130 77 -193 77 -340 0 -178 -37 -298 -134 -435 -91 -126 -220
 -224 -369 -278 -72 -26 -99 -31 -218 -35 -117 -4 -146 -1 -215 17 -104 29
 -205 79 -283 142 l-63 52 -89 -89 c-49 -49 -89 -96 -89 -106 0 -24 154 -136
 253 -185 89 -44 177 -74 272 -95 84 -17 303 -15 391 5 403 91 691 371 795 772
 19 76 23 114 22 240 0 129 -4 164 -27 249 -99 377 -406 673 -778 751 -104 22
 -297 28 -385 11z"/>
 <path d="M1227 1418 c-9 -68 -7 -695 2 -770 l6 -57 240 200 c132 110 251 210
 264 223 l23 24 -257 213 c-141 118 -260 215 -264 217 -5 1 -11 -21 -14 -50z"/>
 </g>
 </svg>
  </gp-button>
  `]);return un=function(){return i},i}var An=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(un(),"title","display")),h()(p()(e),"data",{title:"replay",display:"",replay:"->"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),n}(Be);function ln(){var i=we()([`
  <gp-volume class="goldplay__volume-bar">
    <gp-overbox class="goldplay-hoverbox goldplay__volume-bar--handle">
      <span class="goldplay__volume-bar--precent">`,`</span>
      <span class="goldplay__volume-bar--rod `,`" title="adjust volume"></span>
      <span class="goldplay__volume-bar--size">&nbsp;</span>
      <span class="goldplay__volume-bar--column">&nbsp;</span>
    </gp-overbox>
    <gp-button class="goldplay__volume-bar--audio `,'" title="','" data-mute="','" data-volume-size="','"  data-last-volume="',`">
    `,`
    </gp-button>
  </gp-volume>
  `]);return ln=function(){return i},i}function cn(){var i=we()([`
<svg xmlns="http://www.w3.org/2000/svg" style="display:`,`" width="20px" height="20px" viewBox="0 0 24 24" style="margin-left: -5px;">
<path d="M12.2 13.914v6.678a.5.5 0 0 1-.825.38L5.2 15.679H3a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2.2l.412-.353-2.558-2.558a.5.5 0 0 1 0-.707l.707-.707a.5.5 0 0 1 .707 0l16.849 16.849a.5.5 0 0 1 0 .707l-.707.707a.5.5 0 0 1-.707 0l-2.386-2.386a10 10 0 0 1-2.33 1.422c-.526.229-.583.284-.987.377v-2.375l.007-.003a8.332 8.332 0 0 0 1.717-1.014l-1.67-1.669a5.251 5.251 0 0 1-.054.034v-.089l-2-2zM8.373 4.96l3.002-2.572a.5.5 0 0 1 .825.38v6.019L8.373 4.959zm9.867 9.867c.48-.99.76-2.115.76-3.347 0-3.418-2.148-6.014-4.793-7.173a4.11 4.11 0 0 0-.007-.003V2c.027.006.054.012.082.02.852.221 1.274.453 1.436.535A10 10 0 0 1 21.2 11.48a9.954 9.954 0 0 1-1.326 4.98l-1.634-1.633zm-1.766-1.766L14.2 10.786V7.057a5.247 5.247 0 0 1 2.274 6.003z" fill="#f1f1f1"></path>
</svg>
`]);return cn=function(){return i},i}function hn(){var i=we()([`
<svg xmlns="http://www.w3.org/2000/svg" style="display:`,`" width="20px" height="20px" viewBox="0 0 24 24" style="margin-left: -5px;">
<path d="M5.2 7.68l6.175-5.293a.5.5 0 0 1 .825.38v17.825a.5.5 0 0 1-.825.38L5.2 15.679H3a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2.2zm9 13.35v-2.375l.007-.003C16.852 17.493 19 14.897 19 11.479s-2.148-6.014-4.793-7.173a4.11 4.11 0 0 0-.007-.003V2c.027.006.054.012.082.02.852.221 1.274.453 1.436.535A10 10 0 0 1 21.2 11.48c0 4.106-2.474 7.633-6.013 9.174-.526.229-.583.284-.987.377zm0-13.973c1.5.925 2.5 2.582 2.5 4.473 0 1.892-1 3.55-2.5 4.473V7.057z" fill="#f1f1f1"></path>
</svg>
`]);return hn=function(){return i},i}var fn=ee.create(hn(),"audioOnHide"),Dn=ee.create(cn(),"audioOffHide"),Rn=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(ln(),"dataPrecent","volumeBarRodHoverCss","audioOffClass","title","dataMute","dataVolumeSize","dataLastVolume","icon|html")),h()(p()(e),"options",{}),h()(p()(e),"data",{audioONHide:"",audioOffHide:"",audioOffClass:"",dataVolumeSize:"",dataPrecent:"",dataLastVolume:"",dataMute:"",volumeBarRodHoverCss:"",icon:fn,title:"turn off"}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){this.data.dataPrecent=Math.floor(100*this.data.dataVolumeSize),this.data.audioOffClass!==""?(this.data.dataMute="true",this.data.audioOffHide="inline-block",this.data.audioOnHide="none",this.data.icon=Dn,this.data.title="turn on"):(this.data.dataMute="",this.data.audioOffHide="none",this.data.audioOnHide="inline-block",this.data.icon=fn,this.data.title="turn off")}},{key:"initProps",value:function(){var e=this.element,t=this.options.cssName;this.INIT_VOLUME_SIZE=this.options.player.defaultVolumeSize===void 0?.5:this.options.player.defaultVolumeSize,this.$volumeBarHandle=e.querySelector("."+t.volumeBarHandle),this.$volumeBarRod=e.querySelector("."+t.volumeBarRod),this.$volumeBarAudio=e.querySelector("."+t.volumeBarAudio),this.$volumeBarSize=e.querySelector("."+t.volumeBarSize),this.$volumeBarColumn=e.querySelector("."+t.volumeBarColumn),this.volumeBarColumnHeight=this.$volumeBarColumn.offsetHeight,this.volumeBarColumnTop=this.$volumeBarColumn.offsetTop,this.volumeBarRodHeight=this.$volumeBarRod.offsetHeight,this.volumeBarRodHeightHalf=this.volumeBarRodHeight/2,this.volumeBarColumnRealTop=this.volumeBarColumnTop+this.volumeBarRodHeightHalf,this.volumeBarColumnMaxHeight=this.volumeBarColumnHeight-this.volumeBarRodHeight}},{key:"bindEvent",value:function(){var e,t=this,r=this.options.$controlBarContainer,a=this.options.cssName;Te(r).on("mouseover","."+a.volumeBar,function(){clearTimeout(e),t.showVolumeBarHandle()}),Te(r).on("mousewheel","."+a.volumeBarHandle,function(l){var f=l.wheelDelta/500;f=t.data.dataVolumeSize+f,t.setVolumeSize(f),l.preventDefault(),l.stopPropagation()}),Te(r).on("click",["."+a.volumeBarColumn,"."+a.volumeBarSize],function(l){var f=0;return l.target===t.$volumeBarColumn?f=(t.$volumeBarColumn.offsetHeight-l.offsetY)/l.target.offsetHeight:l.target===t.$volumeBarSize&&(f=t.$volumeBarColumn.offsetHeight-l.target.offsetHeight+l.offsetY,f=t.$volumeBarColumn.offsetHeight-f,f/=t.$volumeBarColumn.offsetHeight),t.setVolumeSize(f),!1}),Te(r).on("click","."+a.volumeBarAudio,function(l){return t.$volumeBarAudio.classList.contains(a.volumeBarAudioOff)?t.setAudioOn(l.offsetY):t.setAudioOff(l.offsetY),!1}),Te(r).on("mouseout","."+a.volumeBar,function(l){e=setTimeout(function(){(function(f){var v=t.element,w={y:v.offsetTop+t.$volumeBarHandle.offsetTop,x:v.offsetLeft};return w.width=v.offsetWidth,w.height=t.$volumeBarHandle.offsetHeight,f.pageX>w.x&&f.pageX<w.x+w.width&&f.pageY>w.y&&f.pageY<w.y+w.height})(l)?clearTimeout(e):t.hideVolumeBarHandle()},Q.c.hideBarBoxTime)}),this.volumeDragEvent=Rt(this.$volumeBarRod,{$container:this.element,type:"vertical",scope:{top:this.volumeBarColumnTop,right:0,bottom:this.volumeBarColumnTop+this.volumeBarColumnHeight,left:0},onStart:function(){t.data.volumeBarRodHoverCss=t.options.cssName.volumeBarRodHover},onDrag:function(l,f){f-=1,t.dragHandle(f)},onRelease:function(){t.data.volumeBarRodHoverCss=""}})}},{key:"hideVolumeBarHandle",value:function(){this.$volumeBarHandle.style.visibility="hidden"}},{key:"showVolumeBarHandle",value:function(){this.$volumeBarHandle.style.visibility="visible"}},{key:"getVolume",value:function(){var e=(this.$volumeBarSize.offsetHeight-this.volumeBarRodHeight)/this.volumeBarColumnMaxHeight;return e=Math.min(e,1),(e=Math.max(e,0)).toFixed(2)}},{key:"setVolume",value:function(e){this.data.dataVolumeSize=Number(e),this.events.emit(B.PlayerOnVolume,e)}},{key:"initVolumeSize",value:function(){this.data.dataLastVolume=this.INIT_VOLUME_SIZE,this.setAudioOn()}},{key:"setAudioOn",value:function(){var e=this.data.dataLastVolume||0;this.setVolume(e);var t=parseFloat(e,10),r=Math.floor(t*this.volumeBarColumnMaxHeight),a=this.volumeBarColumnTop+(this.volumeBarColumnMaxHeight-r);this.$volumeBarSize.style.marginTop=a+"px",this.$volumeBarSize.style.height=r+this.volumeBarRodHeight+"px",this.$volumeBarRod.style.top=a+"px",this.data.audioOffClass=""}},{key:"setAudioOff",value:function(){this.setVolume(0),this.data.audioOffClass=this.options.cssName.volumeBarAudioOff;var e=this.getVolume();e>0&&(this.data.dataLastVolume=e),this.$volumeBarSize.style.height=this.volumeBarRodHeight+"px",this.$volumeBarSize.style.marginTop=this.volumeBarColumnRealTop-this.volumeBarRodHeightHalf+this.volumeBarColumnMaxHeight+"px",this.$volumeBarRod.style.top=this.volumeBarColumnRealTop+this.volumeBarColumnMaxHeight-this.volumeBarRodHeightHalf+"px"}},{key:"dragHandle",value:function(e){this.$volumeBarSize.style.marginTop=e+1+"px",this.$volumeBarSize.style.height=this.volumeBarColumnHeight-e+this.volumeBarRodHeight+"px";var t=this.getVolume();t<=0?this.setAudioOff(e):this.data.dataMute=="true"&&this.setAudioOn(e),this.setVolume(t)}},{key:"setVolumeSize",value:function(e){if((e=e.toFixed(2))>=1?e=1:e<.001&&(e=0),e!==this.data.dataVolumeSize){this.setVolume(e);var t=this.volumeBarColumnMaxHeight,r=t-e*t+this.volumeBarColumnTop;this.$volumeBarSize.style.marginTop=r+"px",this.$volumeBarSize.style.height=e*t+this.volumeBarRodHeight+"px",this.$volumeBarRod.style.top=r+"px",e<=0?this.data.audioOffClass=this.options.cssName.volumeBarAudioOff:this.data.dataMute=="true"&&(this.data.audioOffClass="")}}}]),n}(Be);function Fn(){var i=we()([`
  <gp-wait class="goldplay-tip goldplay__waiting-bar" title="`,'" data-status="',`">
    <span class="goldplay__waiting-bar--icon">
    <svg width="60px" height="60px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="background: none;opacity:0.8">
    <circle cx="50" cy="50" fill="none" stroke-linecap="round" r="40" stroke-width="8" stroke="#f6f6f6" stroke-dasharray="62.83185307179586 62.83185307179586" transform="rotate(17.8841 50 50)">
    <animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="0.7s" begin="0s" repeatCount="indefinite">
    </animateTransform>
    </circle>
    </svg>
  </span>
  <gp-speed class="goldplay__waiting-bar--speed">`,`</gp-speed>
  </gp-wait>
  `]);return Fn=function(){return i},i}var hr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Fn(),"title","status","speed")),h()(p()(e),"data",{title:"waiting",speed:"",status:"",display:"show"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"initProps",value:function(){}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.LoaderUpdateSpeed,function(t){e.data.display==="show"&&(e.data.speed=lt.formatBytes(t.speed)+" /s")})}},{key:"showWaiting",value:function(){var e=this.options.cssName,t=this.options.$screenContainer;t.querySelector("."+e.waitingBar)||t.prepend(this.element),this.data.display="show",this.show(),this.resetPosition()}},{key:"hideWaiting",value:function(){var e=this.options.cssName;this.options.$screenContainer.querySelector("."+e.waitingBar)&&(this.data.display="hide",this.data.speed="Loading...",this.hide())}}]),n}(Be);function jn(){var i=we()([`
  <gp-alert class="goldplay-tip goldplay__alter-box" title="`,'" data-display="',`">
  <em title="close" class="goldplay__alter--close">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="background:none;opacity:0.6" xml:space="preserve" width="20px" height="20px" viewBox="0 0 496.158 496.158">
    <path style="fill:#ff3300;" d="M496.158,248.085c0-137.021-111.07-248.082-248.076-248.082C111.07,0.003,0,111.063,0,248.085
    c0,137.002,111.07,248.07,248.082,248.07C385.088,496.155,496.158,385.087,496.158,248.085z"/>
    <path style="fill:#FFFFFF;" d="M277.042,248.082l72.528-84.196c7.91-9.182,6.876-23.041-2.31-30.951
    c-9.172-7.904-23.032-6.876-30.947,2.306l-68.236,79.212l-68.229-79.212c-7.91-9.188-21.771-10.216-30.954-2.306
    c-9.186,7.91-10.214,21.77-2.304,30.951l72.522,84.196l-72.522,84.192c-7.91,9.182-6.882,23.041,2.304,30.951
    c4.143,3.569,9.241,5.318,14.316,5.318c6.161,0,12.294-2.586,16.638-7.624l68.229-79.212l68.236,79.212
    c4.338,5.041,10.47,7.624,16.637,7.624c5.069,0,10.168-1.749,14.311-5.318c9.186-7.91,10.22-21.77,2.31-30.951L277.042,248.082z"/>
    </svg>
  </em>
  <span class="goldplay__alter--warn">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    width="30" height="30" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
    <path style="fill:#495A79;" d="M501.461,383.799L320.501,51.401C306.7,28.6,282.7,14.8,256,14.8s-50.7,13.8-64.501,36.601
      L10.539,383.799C-3.259,407.501-3.56,435.701,9.941,459.4c13.499,23.699,37.798,37.8,65.099,37.8h361.92
      c27.301,0,51.601-14.101,65.099-37.8C515.56,435.701,515.259,407.501,501.461,383.799z"/>
    <path style="fill:#42516D;" d="M502.059,459.4c-13.499,23.699-37.798,37.8-65.099,37.8H256V14.8c26.7,0,50.7,13.801,64.501,36.601
      L501.461,383.8C515.259,407.501,515.56,435.701,502.059,459.4z"/>
    <path style="fill:#FFDE33;" d="M475.661,399.1L294.699,66.699C286.601,52.9,271.901,44.8,256,44.8s-30.601,8.101-38.699,21.899
      L36.339,399.1c-8.399,14.101-8.399,31.199-0.298,45.3c8.099,14.399,22.798,22.8,39,22.8h361.92c16.201,0,30.901-8.401,39-22.8
      C484.06,430.299,484.06,413.201,475.661,399.1z"/>
    <path style="fill:#FFBC33;" d="M475.96,444.4c-8.099,14.399-22.798,22.8-39,22.8H256V44.8c15.901,0,30.601,8.101,38.699,21.899
      L475.661,399.1C484.06,413.201,484.06,430.299,475.96,444.4z"/>
    <g>
      <path style="fill:#495A79;" d="M256,437.2c-16.538,0-30-13.462-30-30s13.462-30,30-30s30,13.462,30,30S272.538,437.2,256,437.2z"/>
      <path style="fill:#495A79;" d="M286,317.2c0,16.538-13.462,30-30,30s-30-13.462-30-30v-150c0-16.538,13.462-30,30-30
        s30,13.462,30,30V317.2z"/>
    </g>
    <g>
      <path style="fill:#42516D;" d="M286,407.2c0-16.538-13.462-30-30-30v60C272.538,437.2,286,423.738,286,407.2z"/>
      <path style="fill:#42516D;" d="M286,317.2v-150c0-16.538-13.462-30-30-30v210C272.538,347.2,286,333.738,286,317.2z"/>
    </g>
    </svg>
  </span>
  <gp-content class="goldplay__alter--content">`,`</gp-content>
  </gp-alert>
  `]);return jn=function(){return i},i}var fr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(jn(),"title","display","content|trim")),h()(p()(e),"data",{title:"alert",display:"default",content:""}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"bindEvent",value:function(){var e=this,t=this.options.$screenContainer,r=this.options.cssName;Te(t).on("click","."+r.alertClose,function(){e.hide()})}},{key:"afterWatch",value:function(){this.data.display==="show"&&this.resetPosition()}},{key:"showBox",value:function(){var e=this.options.cssName,t=this.options.$screenContainer;t.querySelector("."+e.alertBox)||t.prepend(this.element),this.data.display="show",this.show()}},{key:"hideBox",value:function(){var e=this.options.cssName;this.options.$screenContainer.querySelector("."+e.alertBox)&&(this.data.display="hide",this.hide())}},{key:"show",value:function(){this.element.style.opacity=1,this.element.style.display="inline-block",this.resetPosition()}},{key:"hide",value:function(){this.element.style.opacity=0,this.element.style.display="none"}}]),n}(Be);function Wn(){var i=we()([`
  <gp-time class="goldplay__control--timer">
  <span gid="time" class="goldplay__control--timer-play">`,`</span>
  <span gid="slash">`,`</span>
  <span gid="total-time" class="goldplay__control--timer-total">`,`</span>
  </gp-time>
  `]);return Wn=function(){return i},i}var dr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Wn(),"time","slash","totalTime")),h()(p()(e),"data",{time:"00:00",totalTime:"",slash:"/"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"setTotalTime",value:function(e){var t=e.sourceData;this.data.totalTime=qe.formatHHMMSS(t.duration)}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.LoaderPlayListLoaded,function(t){e.setTotalTime(t.loadData)})}},{key:"updateTime",value:function(e){this.element.querySelector('[gid="time"]').innerHTML=e}},{key:"updateTotalTime",value:function(e){this.element.querySelector('[gid="total-time"]').innerHTML=e}}]),n}(Be);function Vn(){var i=we()([`
  <gp-speed class="goldplay__speed-bar" title="`,`">
  <gp-overbox class="goldplay-hoverbox goldplay__speed-bar--box">
  `,`
  </gp-overbox>
  <gp-button class="goldplay__speed-bar--link">
  `,`
  </gp-button>
  </gp-speed>
  `]);return Vn=function(){return i},i}var pr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Vn(),"title","speedListHTML|html","currentSpeedName")),h()(p()(e),"data",{title:"speed",currentSpeed:1,speedList:null,currentSpeedName:"",speedListHTML:""}),h()(p()(e),"options",{}),e.options=t,e.speedList=e.options.player.options.speedList||Q.c.speedList,e.updateSpeedListHTML(),Object.assign(e.data,t.data),e.init(),e.initProps(),e.showHideBar(),e}return T()(n,i),k()(n,[{key:"initProps",value:function(){var e=this.options.cssName;this.$barBox=this.element.querySelector("."+e.speedBarBox)}},{key:"bindEvent",value:function(){var e=this,t=this.options.cssName,r=this.options.$controlBarContainer;Te(r).on("mouseover","."+t.speedBar,function(){clearTimeout(a),e.showBarBoxHandle()});var a;Te(r).on("mouseout","."+t.speedBar,function(l){a=setTimeout(function(){(function(f){var v=e.element,w={y:e.$barBox.offsetTop,x:v.offsetLeft};return w.width=v.offsetWidth,w.height=e.$barBox.offsetHeight,f.pageX>w.x&&f.pageX<w.x+w.width&&f.pageY>w.y&&f.pageY<w.y+w.height})(l)?clearTimeout(a):e.hideBarBoxHandle()},Q.c.hideBarBoxTime)}),Te(this.element).on("click","[gp-node-li]",function(l){var f=l.target,v=parseFloat(f.getAttribute("value"),10);if(v!==e.data.currentSpeed){e.data.currentSpeed=v;var w=e.speedList.filter(function(A){return A.value===v});e.events.emit(B.PlayerSpeedTo,w[0]),e.updateSpeedListHTML()}})}},{key:"showHideBar",value:function(){this.speedList.length<=0&&this.hide()}},{key:"resetBoxPosition",value:function(){var e=33+28*this.speedList.length,t=(this.$barBox.offsetWidth-this.element.offsetWidth)/2;this.$barBox.style.marginTop=-e+"px",this.$barBox.style.marginLeft=-t+"px"}},{key:"hideBarBoxHandle",value:function(){this.$barBox.style.visibility="hidden"}},{key:"showBarBoxHandle",value:function(){this.$barBox.style.visibility="visible"}},{key:"updateSpeedListHTML",value:function(e){var t=this.speedList;if(!(t.length<=0)){e===void 0&&(e=this.data.currentSpeed);var r=t.slice(0,t.length).reverse(),a=!0,l=!1,f=void 0;try{for(var v,w=r[Symbol.iterator]();!(a=(v=w.next()).done);a=!0){var A=v.value;A.value===e?A.selected=!0:delete A.selected}}catch(H){l=!0,f=H}finally{try{a||w.return==null||w.return()}finally{if(l)throw f}}return this.data.speedListHTML=function(H){if(H){var ce=["<ul>"],ye=!0,_e=!1,xe=void 0;try{for(var Ee,Me=H[Symbol.iterator]();!(ye=(Ee=Me.next()).done);ye=!0){var ge=Ee.value,ht="",st="";ge.selected&&(ht="gp-selected",st=" selected=".concat(ge.selected)),ce.push(`
    <li class="`.concat(ht,'" gp-node-li value="').concat(ge.value,'" ').concat(st,">").concat(ge.name,`</li>
    `))}}catch(je){_e=!0,xe=je}finally{try{ye||Me.return==null||Me.return()}finally{if(_e)throw xe}}return ce.push("</ul>"),ce.join("")}}(r)}}}]),n}(Be);function zn(){var i=we()([`
  <gp-subtitle class="goldplay__subtitle">
  </gp-subtitle>
  `]);return zn=function(){return i},i}var vr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(zn())),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),n}(Be);function Xn(){var i=we()([`
  <gp-rate class="goldplay__rate-bar" title="`,`">
  <gp-overbox class="goldplay-hoverbox goldplay__rate-bar--box">
  `,`
  </gp-overbox>
  <gp-button class="goldplay__rate-bar--link">
  `,`
  </gp-button>
  </gp-rate>
  `]);return Xn=function(){return i},i}var yr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"rateList",[]),h()(p()(e),"defaultRate",{value:"600",name:""}),h()(p()(e),"template",e.createTemplate(Xn(),"title","rateListHTML|html","currentRateName")),h()(p()(e),"data",{title:"stream rate",currentRate:"600",currentRateName:"",rateListHTML:""}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.rateList=e.options.player.options.rateList||e.rateList,e.defaultRate=e.options.player.options.defaultRate||e.defaultRate,e.setDefaultRate(),e.updateRateListHTML(),e.init(),e.initProps(),e.showHideBar(),e}return T()(n,i),k()(n,[{key:"initProps",value:function(){var e=this.options.cssName;this.$barBox=this.element.querySelector("."+e.rateBarBox)}},{key:"setDefaultRate",value:function(){var e=this;if(!(this.rateList.length<=0)){var t=this.rateList.find(function(r){return String(r.value)===String(e.defaultRate.value)});t?(this.data.currentRateName=t.name,this.data.currentRate=t.value):(this.data.currentRateName=this.rateList[0].name,this.data.currentRate=this.rateList[0].value)}}},{key:"bindEvent",value:function(){var e=this,t=this.options.cssName,r=this.options.$controlBarContainer;Te(r).on("mouseover","."+t.rateBar,function(){clearTimeout(a),e.showBarBoxHandle()});var a;Te(r).on("mouseout","."+t.rateBar,function(l){a=setTimeout(function(){(function(f){var v=e.element,w={y:e.$barBox.offsetTop,x:v.offsetLeft};return w.width=v.offsetWidth,w.height=e.$barBox.offsetHeight,f.pageX>w.x&&f.pageX<w.x+w.width&&f.pageY>w.y&&f.pageY<w.y+w.height})(l)?clearTimeout(a):e.hideBarBoxHandle()},Q.c.hideBarBoxTime)}),Te(this.element).on("click","[gp-node-li]",function(l){var f=l.target.getAttribute("value");if(f!==e.data.currentRate){e.data.currentRate=f;var v=e.rateList.filter(function(w){return w.value===f});e.events.emit(B.PlayerChangeRate,v[0]),e.data.currentRateName=v[0].name,e.updateRateListHTML(),e.hideBarBoxHandle()}})}},{key:"showHideBar",value:function(){var e=this.rateList;e&&e.length<=0&&this.hide()}},{key:"resetBoxPosition",value:function(){var e=33+28*this.rateList.length,t=(this.$barBox.offsetWidth-this.element.offsetWidth)/2;this.$barBox.style.marginTop=-e+"px",this.$barBox.style.marginLeft=-t+"px"}},{key:"hideBarBoxHandle",value:function(){this.$barBox.style.visibility="hidden"}},{key:"showBarBoxHandle",value:function(){this.$barBox.style.visibility="visible"}},{key:"updateRateListHTML",value:function(e){var t=this.rateList;if(!(t.length<=0)){e===void 0&&(e=this.data.currentRate);var r=t.slice(0,t.length).reverse(),a=!0,l=!1,f=void 0;try{for(var v,w=r[Symbol.iterator]();!(a=(v=w.next()).done);a=!0){var A=v.value;A.value===e?A.selected=!0:delete A.selected}}catch(H){l=!0,f=H}finally{try{a||w.return==null||w.return()}finally{if(l)throw f}}return this.data.rateListHTML=function(H){if(H){var ce=["<ul>"],ye=!0,_e=!1,xe=void 0;try{for(var Ee,Me=H[Symbol.iterator]();!(ye=(Ee=Me.next()).done);ye=!0){var ge=Ee.value,ht="",st="";ge.selected&&(ht="gp-selected",st=" selected=".concat(ge.selected)),ce.push(`
    <li class="`.concat(ht,'" gp-node-li value="').concat(ge.value,'" ').concat(st,">").concat(ge.name,`</li>
    `))}}catch(je){_e=!0,xe=je}finally{try{ye||Me.return==null||Me.return()}finally{if(_e)throw xe}}return ce.push("</ul>"),ce.join("")}}(r)}}}]),n}(Be);function Gn(){var i=we()([`
  <gp-setting class="goldplay__setting-bar">
  </gp-setting>
  `]);return Gn=function(){return i},i}var gr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Gn())),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),n}(Be);function Yn(){var i=we()([`
  <gp-button class="goldplay__control--fullpage" title="`,'" data-status="',`">
  `,`
  </gp-button>
  `]);return Yn=function(){return i},i}function $n(){var i=we()([`
<svg xmlns="http://www.w3.org/2000/svg" style="display:`,`" width="20" height="20" viewBox="0 0 24 24">
<path d="M3.5 6h17a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-17a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5zM6 9v6h12V9H6z" fill="#f1f1f1"></path>
</svg>
`]);return $n=function(){return i},i}function qn(){var i=we()([`
<svg xmlns="http://www.w3.org/2000/svg" style="display:`,`" width="20" height="20" viewBox="0 0 24 24">
  <path d="M2.5 4h19a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-19a.5.5 0 0 1-.5-.5v-15a.5.5 0 0 1 .5-.5zM5 7v10h14V7H5z" fill="#f1f1f1"></path>
</svg>
`]);return qn=function(){return i},i}var Kn=ee.create(qn(),"fullpageHide"),mr=ee.create($n(),"fullpageExitHide"),br=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"containerOriginStyle",""),h()(p()(e),"template",e.createTemplate(Yn(),"title","status","icon|html")),h()(p()(e),"data",{fullpageHide:"",fullpageExitHide:"none",status:"",icon:Kn,title:"fullpage"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){this.data.status==="fullpage"?(this.data.fullpageHide="none",this.data.fullpageExitHide="inline-block",this.data.title="exit fullspage",this.data.icon=mr):(this.data.fullpageHide="inline-block",this.data.fullpageExitHide="none",this.data.title="fullpage",this.data.icon=Kn)}},{key:"initProps",value:function(){var e=this.options;this.$container=this.options.$container,this.$screenContainer=e.$screenContainer,this.$controlBarContainer=this.getComponent("controlBarContainer").element,this.originWidth=e.$container.offsetWidth,this.originHeight=e.$container.offsetHeight,this.containerOriginStyle=e.$container.getAttribute("style"),this.screenContainerOrginStyle=this.$screenContainer.getAttribute("style"),this.controlContainerOrginWidth=this.$controlBarContainer.style.width}},{key:"bindEvent",value:function(){var e=this,t=this.options.cssName,r=document,a=window;Te(this.$controlBarContainer).on("click","."+t.fullPage,function(){var l=e.data.status;e.getComponent("fullScreen").data.status==="fullscreen"&&Ue.exitFullscreen(),l==="fullpage"?e.exitFullPage():e.fullPage()}),this.eventsList.esckeyup=this.addEventListener(r,"keyup",function(l){l.keyCode===27&&e.data.status==="fullpage"&&e.exitFullPage()}),this.eventsList.windowresize=this.addEventListener(a,"resize",function(){if(e.data.status==="fullpage"){var l=Ue.getInnerWidthHeight();e.resizeTo(l.width,l.height),e.resetPosition()}})}},{key:"fullPage",value:function(){this.data.status="fullpage";var e=this.options,t=this.options.cssName,r=Ue.getInnerWidthHeight();this.saveOriginPosition(),e.$container.classList.add(t.containerFullPage),this.resizeTo(r.width,r.height),this.resetPosition(),scrollTo(0,0)}},{key:"saveOriginPosition",value:function(){var e=this.getComponent("progressBar");this.posterOriginStyle=this.getComponent("poster").element.getAttribute("style"),this.originScroll={scrollX,scrollY},this.progressBarOriginLeft=e.progressBarLeft,this.progressBarOriginWidth=e.progressBarWidth,this.progressBarPlayWidthRate=e.getProgressPlayLeftWidth().offsetWidth/this.progressBarOriginWidth,this.progressBarLoadWidthRate=e.getProgressLoadLeftWidth().offsetWidth/this.progressBarOriginWidth,this.progressBarLoadLeftRate=(e.getProgressLoadLeftWidth().offsetLeft-this.progressBarOriginLeft)/this.progressBarOriginWidth}},{key:"setProgressBarPosition",value:function(){var e=this.getComponent("progressBar"),t=e.progressBarWidth,r=e.progressBarLeft,a=t*this.progressBarPlayWidthRate,l=t*this.progressBarLoadWidthRate,f=t*this.progressBarLoadLeftRate;e.setProgressPosition(a),e.setProgressLoadLeftWidth(f+r,l),this.getComponent("progressBar").clearDragDotTop()}},{key:"resizeTo",value:function(e,t){var r=this.options,a=r.player,l=a.controlBarAutoHide?t:t-a.controlBarHeight;a.$screenContainer.style.width=e+"px",a.$screenContainer.style.height=l+"px",r.$container.style.width=e+"px",r.$container.style.height=t+"px"}},{key:"resetPosition",value:function(){var e=this.options;this.setProgressBarPosition(),e.player.resizeScreen(),this.getComponent("bigPlayButton").resetPosition(),this.getComponent("poster").resetPosition(),this.getComponent("waitingBar").resetPosition(),this.getComponent("controlBarContainer").resetPosition()}},{key:"exitFullPage",value:function(){this.data.status="exitfullpage";var e=this.options.cssName;this.saveOriginPosition(),this.$container.classList.remove(e.containerFullPage),this.resetScreen()}},{key:"resetScreen",value:function(){this.$container.setAttribute("style",this.containerOriginStyle),this.$screenContainer.setAttribute("style",this.screenContainerOrginStyle),this.$controlBarContainer.style.width=this.controlContainerOrginWidth,this.getComponent("poster").element.setAttribute("style",this.posterOriginStyle),scrollTo(this.originScroll.scrollX,this.originScroll.scrollY),this.resetPosition()}}]),n}(Be);function Qn(){var i=we()([`
  <gp-button class="goldplay__control--fullscreen" title="`,'" data-status="',`">
  `,`
  </gp-button>
  `]);return Qn=function(){return i},i}var Zn=`
<svg xmlns="http://www.w3.org/2000/svg" gid="fullscreen" style="display:\${'fullscreenHide'}" width="20" height="20" viewBox="0 0 24 24">
<path d="M15 5.057V2h6.5a.5.5 0 0 1 .5.5V9h-2.943V5.057H15zm-6 0H5.057V9H2V2.5a.5.5 0 0 1 .5-.5H9v3.057zM15 22v-2.943h4.057V15H22v6.5a.5.5 0 0 1-.5.5H15zm-6 0H2.5a.5.5 0 0 1-.5-.5V15h3.057v4.057H9V22z" fill="#f1f1f1"></path>
</svg>
`,kr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Qn(),"title","status","icon|html")),h()(p()(e),"data",{fullscreenHide:"inline-block",fullscreenExitHide:"none",status:"",icon:Zn,title:"fullscreen"}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){this.data.status==="fullscreen"?(this.data.fullscreenHide="none",this.data.fullscreenExitHide="inline-block",this.data.title="exit fullscreen",this.data.icon=`
<svg xmlns="http://www.w3.org/2000/svg" gid="fullscreenExit" style="display:\${'fullscreenExitHide'}"  width="20" height="20" viewBox="0 0 24 24">
<path d="M22 5.943V9h-6.5a.5.5 0 0 1-.5-.5V2h2.943v3.943H22zm-20 0h3.943V2H9v6.5a.5.5 0 0 1-.5.5H2V5.943zM22 15v2.943h-4.057V22H15v-6.5a.5.5 0 0 1 .5-.5H22zM2 15h6.5a.5.5 0 0 1 .5.5V22H5.943v-4.057H2V15z" fill="#f1f1f1"></path>
</svg>
`):(this.data.fullscreenHide="inline-block",this.data.fullscreenExitHide="none",this.data.title="fullscreen",this.data.icon=Zn)}},{key:"initProps",value:function(){this.getComponent("fullPage").initProps.call(this)}},{key:"bindEvent",value:function(){var e=this,t=this.options.$container,r=this.options.cssName,a=document,l=window;this.eventsList.fullscreenchange=this.addEventListener(a,"fullscreenchange",function(){if(document.fullscreenElement||document.webkitFullscreenElement)e.fullScreen();else{var f=e.getComponent("fullPage");f.data.status==="fullpage"?(t.classList.remove(r.containerFullScreen),e.data.status="exitfullscreen",f.fullPage()):e.exitFullScreen()}}),this.eventsList.windowresize=this.addEventListener(l,"resize",function(){document.fullscreenElement&&(e.resizeTo(screen.width,screen.height-(window.outerHeight-window.innerHeight)),e.resetPosition())}),Te(this.$controlBarContainer).on("click","."+r.fullScreen,function(){var f=e.data.status;e.saveOriginPosition(),f==="fullscreen"?Ue.exitFullscreen():Ue.Fullscreen()})}},{key:"fullScreen",value:function(){this.data.status="fullscreen";var e=this.options,t=this.options.cssName,r={width:screen.width,height:screen.height-(outerHeight-innerHeight)};Ue.isSafari()&&(r.height=r.height+38),e.$container.classList.add(t.containerFullScreen),this.resizeTo(r.width,r.height),this.resetPosition(),scrollTo(0,0)}},{key:"saveOriginPosition",value:function(){this.getComponent("fullPage").saveOriginPosition.call(this)}},{key:"resizeTo",value:function(e,t){this.getComponent("fullPage").resizeTo.call(this,e,t)}},{key:"resetPosition",value:function(){this.getComponent("fullPage").resetPosition.call(this)}},{key:"setProgressBarPosition",value:function(){this.getComponent("fullPage").setProgressBarPosition.call(this)}},{key:"exitFullScreen",value:function(){this.data.status="exitfullscreen";var e=this.options.cssName;this.saveOriginPosition(),this.options.$container.classList.remove(e.containerFullScreen),this.resetScreen(),this.saveOriginPosition()}},{key:"resetScreen",value:function(){this.getComponent("fullPage").resetScreen.call(this)}}]),n}(Be);function Jn(){var i=we()([`
  <gp-button class="goldplay__screen--bigplay" title="`,'" data-status="',`">
  `,`
  </gp-button>
  `]);return Jn=function(){return i},i}function er(){var i=we()([`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="`,'" height="','" viewBox="0 0 438.533 438.533" style="',`" xml:space="preserve">
<g>
<path d="M409.133,109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736,9.801,259.058,0,219.273,0
 c-39.781,0-76.466,9.801-110.063,29.407c-33.595,19.604-60.192,46.201-79.8,79.796C9.801,142.8,0,179.489,0,219.267
 s9.804,76.463,29.407,110.062c19.607,33.585,46.204,60.189,79.799,79.798c33.597,19.605,70.283,29.407,110.063,29.407
 s76.47-9.802,110.065-29.407c33.593-19.602,60.189-46.206,79.795-79.798c19.603-33.599,29.403-70.287,29.403-110.062
 C438.533,179.489,428.732,142.795,409.133,109.203z M328.904,234.966L173.588,326.33c-2.856,1.711-5.902,2.567-9.136,2.567
 c-3.045,0-6.09-0.764-9.135-2.286c-6.09-3.614-9.136-8.939-9.136-15.985V127.907c0-7.041,3.046-12.371,9.136-15.987
 c6.28-3.427,12.369-3.333,18.271,0.284l155.316,91.36c6.088,3.424,9.134,8.663,9.134,15.703
 C338.038,226.308,334.992,231.537,328.904,234.966z" fill="`,`">
</g>
</svg>
`]);return er=function(){return i},i}var wr=ee.create(er(),"width","height","iconStyle","fillColor"),Pr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"template",e.createTemplate(Jn(),"title","status","icon|html")),h()(p()(e),"data",{titie:"click to play",iconStyle:"opacity:0.5",display:"hide",status:"",width:100,height:100,fillColor:"#999",icon:wr}),h()(p()(e),"options",{}),e.options=t,Object.assign(e.data,t.data),e.init(),e}return T()(n,i),k()(n,[{key:"watch",value:function(){if(this.data.display==="show"){var e=(this.element.parentNode.offsetHeight-this.data.height)/2;this.data.iconStyle="opacity:0.7;margin-top:".concat(e,"px")}}},{key:"resetPosition",value:function(){if(this.data.display==="show"){var e=this.element.parentNode,t=e.offsetWidth,r=e.offsetHeight;this.options.player.controlBarAutoHide===!0&&(r-=this.options.player.controlBarHeight);var a=e.offsetTop,l=e.offsetLeft;this.element.style.width=t+"px",this.element.style.height=r+"px",this.element.style.top=a+"px",this.element.style.left=l+"px"}}},{key:"bindEvent",value:function(){var e=this,t=this.options.$screenContainer,r=this.options.cssName;Te(t).on("click","."+r.bigPlayButton,function(){e.events.emit(B.PlayerOnPlay,e),e.events.emit(B.ControlBarPlay,e),e.hide()}),Te(t).on("mouseover","."+r.bigPlayButton,function(){e.data.fillColor=e.options.bigPlayButtonColor||"#fff"}),Te(t).on("mouseout","."+r.bigPlayButton,function(a){var l=e.element,f={y:l.offsetTop,x:l.offsetLeft};f.width=l.offsetWidth,f.height=l.offsetHeight,a.pageX>f.x&&a.pageX<f.x+f.width&&a.pageY>f.y&&a.pageY<f.y+f.height||(e.data.fillColor="#999")})}},{key:"show",value:function(){var e=this;this.data.display!=="show"&&(this.data.display="show",this.element.style.opacity="1",setTimeout(function(){e.element.style.display="inline-block"},1))}},{key:"hide",value:function(){this.data.display!=="hide"&&(this.element.style.opacity="0",this.data.display="hide",this.element.style.display="none")}}]),n}(Be),tr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),(e=L()(this,c()(n).call(this,t))).options=Object.assign(e.options,t),e.componentsController=e.options.componentsController,e.init(),e}return T()(n,i),k()(n,[{key:"render",value:function(){var e=this,t=G.createEl("gp-button-block");t.classList.add("goldplay__control--button-block"),n.componentList.forEach(function(r){var a=e.componentsController.getComponent(r);t.appendChild(a.element)}),this.element=t}}],[{key:"addCustomControl",value:function(e){n.componentList.push(e)}}]),n}(Be);h()(tr,"componentList",["playButton","pauseButton","replayButton"]);var _r=tr,nr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),(e=L()(this,c()(n).call(this,t))).options=Object.assign(e.options,t),e.componentsController=e.options.componentsController,e.init(),e}return T()(n,i),k()(n,[{key:"render",value:function(){var e=this,t=G.createEl("gp-control-sidebar");t.classList.add("goldplay__control--sidebar"),n.componentList.forEach(function(r){var a=e.componentsController.getComponent(r);t.appendChild(a.element)}),this.element=t}}],[{key:"addCustomControl",value:function(e,t){(t<0||t>n.componentList.length)&&(t=n.componentList.length),n.componentList.splice(t,0,e)}}]),n}(Be);h()(nr,"componentList",["speedBar","rateBar","volumeBar","fullPage","fullScreen"]);var rr=nr,ir=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),(e=L()(this,c()(n).call(this,t))).options=Object.assign(e.options,t),e.componentsController=e.options.componentsController,e.init(),e}return T()(n,i),k()(n,[{key:"render",value:function(){var e=this,t=G.createEl("gp-control-nearside");t.classList.add("goldplay__control--button-block"),n.componentList.forEach(function(r){var a=e.componentsController.getComponent(r);t.appendChild(a.element)}),this.element=t}}],[{key:"addCustomControl",value:function(e,t){(t<0||t>n.componentList.length)&&(t=n.componentList.length),n.componentList.splice(t,0,e)}}]),n}(Be);h()(ir,"componentList",["playControl","timer"]);var ar=ir,tt={BaseComponent:Be,controlBarContainer:Jt,bigPlayButton:Pr,poster:Qt,progressBar:rn,playButton:Sn,pauseButton:Cn,replayButton:An,volumeBar:Rn,waitingBar:hr,alertBox:fr,timer:dr,speedBar:pr,subtitle:vr,rateBar:yr,settingBar:gr,fullPage:br,fullScreen:kr,playControl:_r,sideControlBar:rr,nearControlBar:ar},xr=_,or=function(i){return i.substr(0,1).toUpperCase()+i.substr(1)},Ut=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"allComponents",{}),h()(p()(e),"controlBarController",null),h()(p()(e),"options",{cssName:xr}),e.options=Object.assign(e.options,t),e.options.componentsController=p()(e),e.initComponents(),e.$container=e.options.$container,e.$screenContainer=e.options.$screenContainer,e.$canvas=e.options.$canvas,e.$audioContainer=e.options.$audioContainer,e.$audio=e.options.$audio,e.options.$controlBarContainer=e.controlBarContainer.element,e.bindEvent(),e}return T()(n,i),k()(n,[{key:"run",value:function(){for(var e in this.controlBarController.run(),tt)this[e]&&typeof this[e].registerMethod=="function"&&this[e].registerMethod()}},{key:"initComponents",value:function(){for(var e in tt){var t=tt[e];this.allComponents[e]||this.createComponent(t,e)}}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.PlayerLoadedMetaData,function(){e.poster.hide()}),this.events.on(B.AudioPlayerPlayFail,function(){e.drawBigPlayButton(),e.getComponent("poster").hide(),e.events.emit(B.PlayerOnPause,e),e.events.emit(B.ControlBarPause,e)}),this.bindAlertBoxEvent(),this.bindWaitingBarEvent()}},{key:"bindWaitingBarEvent",value:function(){this.waitingBar.initProps(),this.waitingBar.bindEvent()}},{key:"drawBigPlayButton",value:function(){this.$screenContainer.prepend(this.bigPlayButton.element),this.bigPlayButton.show(),this.bigPlayButton.bindEvent(),this.bigPlayButton.resetPosition()}},{key:"setControlBarController",value:function(e){this.controlBarController=e}},{key:"getControlBarController",value:function(){return this.controlBarController||this.options.player.controlBarContainer}},{key:"bindAlertBoxEvent",value:function(){this.alertBox.initProps(),this.alertBox.bindEvent()}},{key:"drawPoster",value:function(){this.$screenContainer.prepend(this.poster.element),this.poster.data.display="show",this.poster.bindEvent(),this.poster.resetPosition()}},{key:"createComponent",value:function(e,t){var r=or(t);this["set"+r](new e(this.options)),this[t]=this["get"+r](),this.allComponents[t]||(this.allComponents[t]=this[t])}},{key:"getComponent",value:function(e){return this.allComponents[e]||tt[e]&&this.createComponent(tt[e],e),this.allComponents[e]}},{key:"resetAllComponents",value:function(){var e=this,t=Object.getOwnPropertyNames(this),r={};t.forEach(function(a){tt[a]&&(r[a]=e[a])}),this.allComponents=r}},{key:"getAllComponents",value:function(){return this.allComponents}}]),n}(D);for(var Br in Ut.addComponet=function(i){var n=or(i);Ut.prototype["set"+n]=function(e){this[i]=e},Ut.prototype["get"+n]=function(){return this[i]}},tt)Ut.addComponet(Br);var sr=Ut,dn=_,Tr=function(i){function n(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g()(this,n),e=L()(this,c()(n).call(this,t)),h()(p()(e),"player",null),h()(p()(e),"loadData",null),h()(p()(e),"options",{cssName:dn}),e.options=Object.assign(e.options,t),e.player=e.options.player,e.loadData=e.player.loadData,e.componentsController=e.player.componentsController,e.$screenContainer=e.player.$screenContainer,e.initComponents(),e}return T()(n,i),k()(n,[{key:"initComponents",value:function(){var e=this.componentsController;Object.assign(this,e.getAllComponents()),this.container=this.controlBarContainer}},{key:"run",value:function(){this.timer.setTotalTime(this.loadData),this.drawLayout(),this.bindEvent(),this.player.autoPlay?this.events.emit(B.ControlBarPlay):this.events.emit(B.ControlBarPause)}},{key:"bindEvent",value:function(){this.bindContainerEvent(),this.bindTimerEvent(),this.bindPlayEvent(),this.bindProgressEvent(),this.bindSpeedEvent(),this.bindRateEvent(),this.bindVolumeEvent(),this.bindFullPage(),this.bindFullScreen()}},{key:"bindContainerEvent",value:function(){this.container.initProps(),this.container.bindEvent()}},{key:"bindTimerEvent",value:function(){this.timer.initProps(),this.timer.bindEvent()}},{key:"bindSpeedEvent",value:function(){this.speedBar.bindEvent(),this.speedBar.resetBoxPosition()}},{key:"bindRateEvent",value:function(){this.rateBar.bindEvent(),this.rateBar.resetBoxPosition()}},{key:"bindFullPage",value:function(){this.fullPage.initProps(),this.fullPage.bindEvent()}},{key:"bindFullScreen",value:function(){this.fullScreen.initProps(),this.fullScreen.bindEvent()}},{key:"bindPlayEvent",value:function(){var e=this;this.events.on(B.ControlBarPlay,function(){e.pauseButton.data.status!=="pause"&&(e.pauseButton.data.status="pause"),e.replayButton.hide(),e.playButton.hide(),e.pauseButton.show(),e.bigPlayButton.hide()}),this.events.on(B.ControlBarPause,function(){e.player.status!=="pause"&&(e.pauseButton.data.status="pause"),e.playButton.show(),e.pauseButton.hide()}),this.events.on(B.PlayerEnd,function(){e.replayButton.show(),e.pauseButton.hide(),e.playButton.hide()}),[B.PlayerWait,B.PlayerSeeking,B.PlayerReset,B.PlayerChangeRate,B.PlayerChangeSrc].forEach(function(t){e.events.on(t,function(){e.waitingBar.showWaiting()})}),this.events.on(B.PlayerSeekEnd,function(){e.waitingBar.hideWaiting()}),this.events.on(B.PlayerPlay,function(){e.waitingBar.hideWaiting(),e.events.emit(B.ControlBarPlay,e)}),this.events.on(B.PlayerPause,function(){e.events.emit(B.ControlBarPause,e)}),this.events.on(B.PlayerPlaying,function(){e.waitingBar.hideWaiting()}),this.events.on(B.PlayerOnSeek,function(t){t<1e3*e.loadData.sourceData.duration&&e.events.emit(B.ControlBarPauseLoading)}),this.events.on(B.ControlBarPauseLoading,function(){e.pauseButton.data.status!=="pauseloading"&&(e.pauseButton.data.status="pauseloading"),e.replayButton.hide(),e.playButton.hide(),e.pauseButton.show()}),Te(this.options.$container).on("click","."+dn.playButton,function(){e.player.status!=="play"&&e.events.emit(B.PlayerOnPlay,e)}),Te(this.options.$container).on("click","."+dn.pauseButton,function(){e.player.status!=="pause"&&e.events.emit(B.PlayerOnPause,e)}),Te(this.options.$container).on("click","."+dn.replayButton,function(){e.events.emit(B.PlayerOnSeek,e.player.startTime)})}},{key:"bindProgressEvent",value:function(){this.progressBar.initProps(),this.progressBar.bindEvent()}},{key:"bindVolumeEvent",value:function(){this.volumeBar.initProps(),this.volumeBar.initVolumeSize(),this.volumeBar.bindEvent()}},{key:"drawLayout",value:function(){var e=this.options.$container,t=this.container.element;e.append(t)}},{key:"destroy",value:function(){this.removeEventListenerGlobal(),this.container.destroy()}},{key:"removeEventListenerGlobal",value:function(){this.progressBar.progressDragEvent&&this.progressBar.progressDragEvent.removeEventListenerAll(),this.volumeBar.volumeDragEvent&&this.volumeBar.volumeDragEvent.removeEventListenerAll(),this.fullPage.removeEventListenerAll(),this.fullScreen.removeEventListenerAll()}}]),n}(D),Er=m(44),ur=m.n(Er),Lr=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"isLast",!1),t.type=e.type,t.libPath=e.libPath,t.player=e.player,t.init(),t}return T()(n,i),k()(n,[{key:"init",value:function(){this.type=="ts"&&this.initNornalWorker(),this.bindEvent(),this.loadjs()}},{key:"initNornalWorker",value:function(){this.processor=this.initWorker()}},{key:"initWorker",value:function(){var e=this,t=ur()(128);return t.onmessage=function(r){var a=r.data,l=a.type,f=a.data;switch(l){case"dataProcessorReady":e.onDataProcessorReady();break;case"decoded":e.onDecoded(f);break;case"demuxedAAC":e.onDemuxedAAC(f);break;case"partEnd":e.onPartEnd(f);break;case"resetEnd":e.onResetEnd();break;case"maxPTS":e.onMaxPTS(f);break;case"flushEnd":e.onFlushEnd(f)}},t}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.DemuxStartDemux,this.onStartDemux.bind(this)),this.events.on(B.DemuxLast,function(){e.isLast=!0}),this.events.on(B.DecodeFlush,function(){e.flush()})}},{key:"flush",value:function(){this.processor.postMessage({type:"flush"})}},{key:"loadjs",value:function(){this.processor.postMessage({type:"loadwasm",libPath:this.libPath})}},{key:"reset",value:function(){this.isLast=!1,this.processor.terminate(),this.initNornalWorker(),this.loadjs()}},{key:"onFlushEnd",value:function(e){this.events.emit(B.DecodeFlushEnd,e)}},{key:"onMaxPTS",value:function(e){this.events.emit(B.PlayerMaxPTS,e.maxAudioPTS,e.maxVideoPTS)}},{key:"onDemuxedAAC",value:function(e){this.events.emit(B.DemuxAAC,e)}},{key:"onDataProcessorReady",value:function(){this.player.seeking||this.player.reseting?this.events.emit(B.ProcessorResetEnd):this.events.emit(B.DataProcessorReady)}},{key:"onStartDemux",value:function(e){this.player.reseting||(this.logger.info("onStartDemux","postMessage to demux"),e&&e.arrayBuffer?this.processor.postMessage({type:"startDemux",data:e.arrayBuffer,isLast:this.isLast},[e.arrayBuffer.buffer]):this.logger.error("onStartDemux","data is null","data:",e))}},{key:"onDecoded",value:function(e){this.player.reseting||this.events.emit(B.DecodeDecoded,e)}},{key:"onPartEnd",value:function(e){this.events.emit(B.DecodeApppendEnd,e)}},{key:"onResetEnd",value:function(){this.events.emit(B.ProcessorResetEnd)}},{key:"destroy",value:function(){this.processor&&this.processor.terminate()}}]),n}(z),Sr=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"currentIndex",null),h()(p()(t),"retryTime",0),h()(p()(t),"dataReady",{audioReady:!1,imageReady:!1}),h()(p()(t),"hasInit",!1),h()(p()(t),"loadDataStatus","loading"),h()(p()(t),"duration",0),h()(p()(t),"tsNumber",0),t.loadData=e.loadData,t.imagePlayer=e.imagePlayer,t.audioPlayer=e.audioPlayer,t.player=e.player,t.bindEvent(),t}return T()(n,i),k()(n,[{key:"bindEvent",value:function(){var e=this;this.events.on(B.LoadDataRead,function(t){e.onRead(t)}),this.events.on(B.DemuxVideo,function(t,r){e.onVideoDemuxed(t,r)}),this.events.on(B.DemuxAAC,function(t){e.onAACDemuxed(t)}),this.events.on(B.DecodeDecoded,function(t){e.onDecoded(t)}),this.events.on(B.DecodeApppendEnd,function(t){e.onAppendEnd(t)}),this.events.on(B.ImagePlayerReady,function(){e.logger.info("bindevent","Events.ImagePlayerReady"),e.checkDataReady("imageReady")}),this.events.on(B.AudioPlayerDataReady,function(){e.logger.info("bindevent","Events.AudioPlayerDataReady"),e.player.receiveAACTime=null,e.checkDataReady("audioReady")}),this.events.on(B.AudioPlayerWait,function(){e.dataReady.audioReady=!1,e.events.emit(B.PlayerWait,"audioPlayer")}),this.events.on(B.ImagePlayerWait,function(){e.dataReady.imageReady=!1,e.events.emit(B.PlayerWait,"imagePlayer")}),this.events.on(B.ImagePlayerEnd,function(){e.logger.info("bindevent","........imageplayer end"),e.events.emit(B.PlayerEnd)}),this.events.on(B.PlayerWait,function(){e.logger.warn("player status wait"),e.player.status="wait",e.loadDataStatus==="loadend"&&(e.loadDataStatus="loading",e.loadNext())}),this.events.on(B.PlayerLoadNext,function(){e.loadDataStatus==="loadend"&&(e.loadDataStatus="loading",e.loadNext())}),this.events.on(B.DecodeFlushEnd,function(t){e.logger.info("flushend>>>>>>>>>>>>>>>",t),e.imagePlayer.maxPTS=t})}},{key:"checkDataReady",value:function(e){var t=this.dataReady;t[e]=!0;for(var r=Object.keys(t),a=0,l=0;l<r.length&&t[r[l]];l++)a++;a==r.length&&this.events.emit(B.StreamDataReady)}},{key:"setBaseInfo",value:function(e){this.duration=e.duration,this.tsNumber=e.tsNumber}},{key:"reset",value:function(){this.dataReady={audioReady:!1,imageReady:!1},this.currentIndex=null,this.loadDataStatus="loading"}},{key:"startLoad",value:function(e){this.logger.info("startLoad","index:",e),this.currentIndex=e,this.player.currentIndex=e,this.events.emit(B.LoadDataReadBufferByNo,e)}},{key:"loadNext",value:function(){this.player.reseting||(this.currentIndex>=this.tsNumber?this.logger.info("loadNext","load end","currentIndex",this.currentIndex,"tsNumber:",this.tsNumber):(this.currentIndex+=1,this.player.currentIndex=this.currentIndex,this.logger.info("loadNext","load next ts","tsno:",this.currentIndex),this.events.emit(B.LoadDataReadBufferByNo,this.currentIndex)))}},{key:"onDecoded",value:function(e){var t=this;e.forEach(function(r){t.player.reseting||r.pts>=t.player.currentTime&&t.imagePlayer.push(r)})}},{key:"onAppendEnd",value:function(e){return e?(this.logger.info("onAppendEnd","events.decodeFlush",e),void this.events.emit(B.DecodeFlush)):(this.logger.info("onAppendEnd","start load next ts condition",this.checkBuffer(),this.currentIndex),this.checkBuffer()&&this.currentIndex!==null?(this.logger.info("onAppendEnd","load next ts. currentIndex:",this.currentIndex),void this.loadNext()):(this.loadDataStatus="loadend",void this.logger.info("onAppendEnd","load ts stop")))}},{key:"onAACDemuxed",value:function(e){var t=this;this.player.reseting||e.forEach(function(r){(r.PTS>=t.player.currentTime||r.audioEnd)&&(!t.player.receiveAACTime&&t.player.seeking&&(t.player.receiveAACTime=Date.now()),t.audioPlayer.send(r))})}},{key:"onVideoDemuxed",value:function(e){this.player.reseting||this.events.emit(B.DecodeStartDecode,e)}},{key:"checkBuffer",value:function(){var e=this.player,t=e.currentTime;return!((e.buffer()[1]||0)-t>=e.maxBufferLength)}},{key:"onRead",value:function(e){this.player.reseting?console.error("onRead reseting"):e&&e.arrayBuffer&&e.no===this.currentIndex?(this.retryTime=0,this.logger.warn("onRead","get stream data"),e.no===this.tsNumber&&(this.logger.info("onRead","the last ts"),this.events.emit(B.DemuxLast)),this.events.emit(B.DemuxStartDemux,e)):this.logger.error("onRead","load ts failred","tsno:",this.currentIndex)}}]),n}(z),Cr=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"maxBufferLength",0),h()(p()(t),"duration",0),h()(p()(t),"pool",[]),h()(p()(t),"start",0),h()(p()(t),"end",0),h()(p()(t),"offset",0),h()(p()(t),"fps",25),t.maxBufferLength=e.maxBufferLength,t}return T()(n,i),k()(n,[{key:"push",value:function(e){var t=this.pool,r=t.length;r===0&&(this.offset=e.pts,this.start=e.pts,this.fps=e.fps);var a=this.insertSort(t,e);t[a-1]&&(t[a-1].duration=t[a].pts-t[a-1].pts),t[a+1]&&(t[a].duration=t[a+1].pts-t[a].pts),this.end=this.pool[r].pts+this.pool[r].duration,this.duration=this.end-this.start}},{key:"insertSort",value:function(e,t){var r=e.length;if(r===0)return e.push(t),0;for(var a=0;a<r;a++)if(t.pts<e[a].pts){for(var l=r;l>a;)e[l]=e[l-1],l--;return e[a]=t,a}return e.push(t),e.length-1}},{key:"reset",value:function(){this.duration=0,this.pool=[],this.start=0,this.end=0,this.offset=0}},{key:"findByIndex",value:function(e){var t=this.buffer.length;return e<t?(this.currentIndex=e,this.buffer[e]):(this.logger.error("input index ".concat(e,"is not found, current maxIndex is ").concat(t-1)),null)}},{key:"find",value:function(e){var t=this.pool,r=t.length;if(this.isBuffered(e)&&r!==0){var a=this.findIndex(e);if(a!==-1){var l=t[a];return this.checkBuffer(e),l}}}},{key:"findIndex",value:function(e){return this.pool.findIndex(function(t){var r=parseInt(t.pts);return e>=r&&e<r+t.duration})}},{key:"isBuffered",value:function(e){return e>=this.start&&e<this.end}},{key:"checkBuffer",value:function(e){if(this.duration>this.maxBufferLength){if(e>this.start){var t=this.findIndex(e),r=this.pool.splice(0,t);r.forEach(function(a){}),r=null,this.start=this.pool[0].pts,this.duration=this.end-this.start}return!1}return this.events.emit(B.PlayerLoadNext),!0}},{key:"buffer",value:function(){return{start:this.start,end:this.end}}}]),n}(z),Ar=m(72),Dr=m.n(Ar),Rr=m(60),lr=m.n(Rr),Or=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this)),h()(p()(t),"canvas",null),t.setCanvas(e.canvas),t.setRender(),t}return T()(n,i),k()(n,[{key:"setCanvas",value:function(e){this.canvas=e}},{key:"setRender",value:function(e){this.render=Dr.a.attach(e||this.canvas)}},{key:"clear",value:function(){this.render.clear()}},{key:"drawFrame",value:function(e){var t,r,a,l,f,v=Date.now(),w=e.buf_y,A=e.buf_u,H=e.buf_v,ce=e.width,ye=e.height,_e=ce/2,xe=ye/2;t={bytes:w,stride:e.stride_y},r={bytes:A,stride:e.stride_u},a={bytes:H,stride:e.stride_v},l=lr.a.format({width:ce,height:ye,chromaWidth:_e,chromaHeight:xe}),f=lr.a.frame(l,t,r,a),this.render.drawFrame(f);var Ee=Date.now();Ee-v>10&&this.logger.warn("drawFrame","reandertime:",Ee-v)}}]),n}(z),Mr=function(i){function n(e){var t;return g()(this,n),t=L()(this,c()(n).call(this,e)),h()(p()(t),"status","pause"),h()(p()(t),"_currentTime",0),h()(p()(t),"maxPTS",null),h()(p()(t),"ready",!1),h()(p()(t),"firstRender",!1),t.imageData=new Cr({events:e.events,maxBufferLength:e.maxBufferLength}),t.screen=new Or({canvas:e.canvas}),t.playHandler=null,t.player=e.player,t.debug=e.debug||!1,t}return T()(n,i),k()(n,[{key:"setScreenRender",value:function(e){this.screen.setCanvas(e),this.screen.setRender(e)}},{key:"clear",value:function(){this.screen.clear()}},{key:"play",value:function(e){this.status!=="play"&&(this.status="play",this.render(e))}},{key:"pause",value:function(){this.status!=="pause"&&(this.status="pause",clearTimeout(this.playHandler),this.playHandler=null)}},{key:"checkBuffer",value:function(){return this.imageData.checkBuffer(this.currentTime)}},{key:"push",value:function(e){this.player.reseting||(this.imageData.push(e),this.end-this.player.currentTime>Q.d.READYBUFFERLENGTH&&!this.ready&&(this.ready=!0,this.status="ready",this.events.emit(B.ImagePlayerReady)),this.events.emit(B.ImagePlayerBuffeUpdate))}},{key:"find",value:function(e){return this.imageData.find(e)}},{key:"buffer",value:function(){return this.imageData.buffer()}},{key:"isBuffered",value:function(e){return this.imageData.isBuffered(e)}},{key:"render",value:function(e){if(!(e<this.imageData.offset)){var t=this.find(e);return t?(this.firstRender||(this.firstRender=!0,this.events.emit(B.PlayerLoadedMetaData,t.width,t.height)),this.screen.drawFrame(t),this.currentTime=t.pts,this.events.emit(B.ImagePlayerRenderEnd,e),t):this.maxPTS&&e>=this.maxPTS+this.fragDuration?(this.status="end",void this.events.emit(B.ImagePlayerEnd,this.maxPTS)):(this.logger.warn("Events.ImagePlayerWait",e,this.start,this.end,this.maxPTS),this.logger.warn("render","not yuv data"),this.status="wait",this.ready=!1,this.events.emit(B.ImagePlayerWait,"image","this"),!1)}}},{key:"reset",value:function(){this.status="pause",this.ready=!1,this.imageData.reset(),this.maxPTS=null,this.currentTime=0}},{key:"currentTime",set:function(e){this._currentTime=e},get:function(){return this._currentTime}},{key:"offset",get:function(){return this.imageData.offset}},{key:"fragDuration",get:function(){return Math.ceil(1e3/this.imageData.fps)}},{key:"start",get:function(){return this.imageData.start}},{key:"end",get:function(){return this.imageData.end}},{key:"duration",get:function(){return this.imageData.duration}}]),n}(z),Ur=function(i){function n(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return g()(this,n),t=L()(this,c()(n).call(this)),h()(p()(t),"mode",Q.c.mode),h()(p()(t),"$container",null),h()(p()(t),"componentsController",null),h()(p()(t),"controlBarController",null),h()(p()(t),"controlBarHeight",50),h()(p()(t),"alertError",null),h()(p()(t),"dataController",null),h()(p()(t),"demuxer",null),h()(p()(t),"decoder",null),h()(p()(t),"preload",!0),h()(p()(t),"startTime",0),h()(p()(t),"screenWidth",null),h()(p()(t),"screenHeight",null),h()(p()(t),"options",{}),pn.set(p()(t),{writable:!0,value:Q.c.libPath}),h()(p()(t),"readyStatus",{dataProcessor:!1,firstData:!1,audioPlayer:!1}),h()(p()(t),"reseting",!1),On.set(p()(t),{writable:!0,value:0}),Mn.set(p()(t),{writable:!0,value:!1}),Un.set(p()(t),{writable:!0,value:1}),Nn.set(p()(t),{writable:!0,value:!1}),h()(p()(t),"maxBufferLength",Q.d.MAXBUFFERLENGTH),h()(p()(t),"seekSegmentNo",-1),h()(p()(t),"status","init"),h()(p()(t),"loader",null),h()(p()(t),"currentIndex",null),h()(p()(t),"startIndex",1),h()(p()(t),"loadData",null),h()(p()(t),"paused",!1),h()(p()(t),"autoPlay",!0),h()(p()(t),"duration",0),h()(p()(t),"tsNumber",0),e||t.logger.error("Please pass in a dom object as the display container"),t.el=e,Object.assign(t.options,r),t.options.sourceURL=t.options.sourceURL||t.options.source,t.options.streamList=t.options.streamList||[],t.options.events=re(),t.maxBufferLength=r.maxBufferLength!==void 0?r.maxBufferLength:t.maxBufferLength,t.autoPlay=r.autoPlay!==void 0?r.autoPlay:t.autoPlay,t.controlBarAutoHide=r.controlBarAutoHide!==void 0?r.controlBarAutoHide:t.controlBarAutoHide,ae()(p()(t),pn,r.libPath!==void 0?r.libPath:Y()(p()(t),pn)),t.preload=r.preload===void 0?t.preload:r.preload,t.startTime=r.startTime===void 0?t.startTime:r.startTime,t.originStartTime=t.startTime,t.playbackRate=r.playbackRate===void 0?t.playbackRate:r.playbackRate,t}return T()(n,i),k()(n,[{key:"setAlertError",value:function(){this.options.alertError=this.alertError=R.getInstance({player:this,component:this.componentsController.alertBox,events:this.options.events})}},{key:"setDataController",value:function(){this.dataController=it.getInstance({player:this,events:this.options.events})}},{key:"setLoadData",value:function(){this.dataController.setLoadData({player:this,events:this.options.events}),this.loadData=this.dataController.loadData}},{key:"setComponentsController",value:function(){this.componentsController=sr.getInstance({$container:this.$container,$screenContainer:this.$screenContainer,$canvas:this.$canvas,$audioContainer:this.$audioContainer,$audio:this.$audio,loadData:this.loadData,bigPlayButtonColor:this.bigPlayButtonColor,player:this,events:this.options.events})}},{key:"setControlBarController",value:function(){var e=Object.assign({},this.options,{$container:this.$container,$screenContainer:this.$screenContainer,controlBarAutoHide:this.controlBarAutoHide,player:this});this.controlBarController=Tr.getInstance(e)}},{key:"setLoadController",value:function(){this.loaderController=rt.getInstance(this.options.type,{player:this,events:this.options.events})}},{key:"setProcessorController",value:function(){this.processController=new Lr({type:"ts",libPath:Y()(this,pn),events:this.options.events,player:this})}},{key:"setStreamController",value:function(){this.streamController=new Sr({events:this.options.events,loadData:this.loadData,imagePlayer:this.imagePlayer,audioPlayer:this.audioPlayer,player:this})}},{key:"setImagerPlayer",value:function(){this.imagePlayer=new Mr({events:this.options.events,canvas:this.$canvas,maxBufferLength:this.maxBufferLength,player:this})}},{key:"setAudioPlayer",value:function(){this.audioPlayer=new b({player:this,events:this.options.events,audioNode:this.$audio})}},{key:"setAction",value:function(){this.action=new bn({player:this,screen:this.screen,imagePlayer:this.imagePlayer,loadData:this.loadData,audioPlayer:this.audioPlayer,events:this.options.events})}},{key:"init",value:function(){this.controlBarHeight=this.options.controlBarHeight||this.controlBarHeight,this.options.httpWorker=ur()(94,{name:"httpWorker"}),this.currentTime=this.startTime,this.addEl(),this.setDataController(),this.setLoadData(),this.setComponentsController(),this.setLoadController(),this.setControlBarController(),this.componentsController.setControlBarController(this.controlBarController),this.setAlertError(),this.setProcessorController(),this.setImagerPlayer(),this.setAudioPlayer(),this.setAction(),this.setStreamController(),this.componentsController.drawPoster(),this.preload&&this.run(),this.bindEvent()}},{key:"bindEvent",value:function(){var e=this;this.events.on(B.PlayerOnPlay,function(){e.play()}),this.events.on(B.PlayerOnPause,function(){e.pause()}),this.events.on(B.PlayerOnVolume,function(t){e.volume=t}),this.events.on(B.DataProcessorReady,function(){e.logger.info("bindEvent","decoder ready"),e.checkReady("dataProcessor")}),this.events.on(B.AudioPlayerReady,function(){e.logger.info("bindEvent","audioPlayer ready"),e.seeking||e.checkReady("audioPlayer")}),this.events.on(B.PlayerReady,function(){e.logger.info("bindEvent","player ready"),e.onReady()}),this.events.on(B.PlayerSpeedTo,function(t){e.changeSpeed(t)}),this.events.on(B.PlayerChangeRate,function(t){e.changeRate(t)}),this.events.on(B.PlayerWait,function(){e.onWait()}),this.events.on(B.PlayerPlay,function(){e.onPlay()}),this.events.on(B.LoaderPlayListLoaded,function(t){typeof e.options.afterLoadPlaylist=="function"&&e.options.afterLoadPlaylist(e.laodData.sourceData);var r=t.loadData.sourceData;e.duration=r.duration,e.tsNumber=r.length,e.streamController.setBaseInfo({duration:e.duration,tsNumber:e.tsNumber}),e.dataController.startLoad(e.startTime),e.setStartTime(e.originStartTime)}),this.events.on(B.LoadDataFirstLoaded,function(t){e.logger.info("bindEvent","first data ready"),e.startIndex=t.no,e.streamController.currentIndex=t.no,e.checkReady("firstData")}),this.events.on(B.StreamDataReady,function(){e.logger.info("bindEvent","dataReady"),e.onDataReady()}),this.events.on(B.PlayerLoadedMetaData,function(t,r){e.setCanvas(),e.resizeScreen(t,r)}),this.events.on(B.PlayerEnd,function(){e.status="end"}),this.events.on(B.ImagePlayerBuffeUpdate,function(){var t=e.buffer();e.events.emit(B.PlayerbufferUpdate,t)}),this.events.on(B.PlayerOnSeek,function(t){e.seek(Math.floor(t))}),this.events.on(B.PlayerAlert,function(t){e.alertError.show(t)}),this.events.on(B.PlayerThrowError,function(t){M.a.apply(e,t)})}},{key:"reset",value:function(e){this.action&&this.action.reset(e)}},{key:"switchPlaylist",value:function(e,t){this.loaderController.switchPlaylist(e,t)}},{key:"changeSpeed",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.playbackRate=e.value||1}},{key:"setStartTime",value:function(e){this.startTime=e}},{key:"changeRate",value:function(e){this.pause(),this.events.emit(B.ControlBarPauseLoading,this),this.setStartTime((this.currentTime-5e3)/1e3),this.changing=!0,this.seeking=!1,this.imagePlayer.firstRender=!1,this.readyStatus={dataProcessor:!1,firstData:!1,audioPlayer:!1},this.reset(!0),this.switchPlaylist(e.url)}},{key:"changeSrc",value:function(e,t){this.pause(),this.events.emit(B.ControlBarPauseLoading,this),this.events.emit(B.PlayerChangeSrc,this),this.changing=!0,this.seeking=!1,this.imagePlayer.firstRender=!1,this.readyStatus={dataProcessor:!1,firstData:!1,audioPlayer:!1},this.currentTime=this.startTime,this.imagePlayer.clear(),this.reset(!0),this.switchPlaylist(e,t)}},{key:"setCanvas",value:function(){var e=O.createCanvas(this);if(G.isElement(this.$canvas)){if(this.$canvas.width&&this.$canvas.height)return this.imagePlayer.setScreenRender(e),this.$canvas.replaceWith(e),void(this.$canvas=e)}else this.$screen.appendChild(e),this.$canvas=e}},{key:"destroy",value:function(){this.controlBarController&&(this.controlBarController.destroy(),delete this.controlBarController),this.$container&&(this.el.removeChild(this.$container),delete this.$container),this.processController.destroy(),this.loaderController.destroy()}},{key:"run",value:function(){this.loaderController.run()}},{key:"checkReady",value:function(e){var t=this.readyStatus;if(e&&typeof e=="string"){t[e]=!0;for(var r=Object.keys(t),a=0;a<r.length;a++)if(!t[r[a]])return!1;return this.logger.info("checkReady","player ready"),this.events.emit(B.PlayerReady),!0}return this.logger.error("checkReady","check ready","type is no correct, type:",e),!1}},{key:"addEl",value:function(){var e,t,r,a;this.el?(e=O.createContainer(this),this.el.appendChild(e),this.$container=e,t=O.createScreenContainer(this),this.$screen=t,e.appendChild(t),this.$screenContainer=t,this.setCanvas(),a=O.createAudio(this),this.$audio=a,(r=O.createAudioContainer(this)).appendChild(a),this.$audioContainer=r,e.appendChild(r)):this.logger.error("addEl","not found el.","el:",this.options.el)}},{key:"onWait",value:function(){this.logger.info("onWait","wait,wait,wait")}},{key:"onPlay",value:function(){this.logger.info("onPlay","play, play, play")}},{key:"onReady",value:function(){this.changing||this.componentsController.run(),this.changing&&this.logger.info("onReady","change ready","startIndex:",this.startIndex),this.streamController.startLoad(this.startIndex)}},{key:"onDataReady",value:function(){this.changing&&(this.changing=!1,this.play()),(this.seeking||this.autoPlay&&!this.paused)&&this.play()}},{key:"buffer",value:function(){var e=this.imagePlayer.buffer(),t=this.audioPlayer.buffer(),r=Math.max(e.start,t.start),a=Math.min(e.end,t.end);return r<a?[r,a]:[0,0]}},{key:"play",value:function(){this.logger.info("play",this.status),this.status!=="playing"&&(this.logger.info("start play"),this.status="playing",this.paused=!1,this.action.play(this.currentTime),this.events.emit(B.PlayerPlay,this))}},{key:"on",value:function(e,t){this.events.on("Player."+e,t)}},{key:"off",value:function(e,t){this.events.off("Player."+e,t)}},{key:"once",value:function(e,t){this.events.once("Player."+e,t)}},{key:"pause",value:function(){this.status!="pause"&&(this.logger.info("pause"),this.status="pause",this.action.pause(),this.paused=!0,this.events.emit(B.PlayerPause,this))}},{key:"seek",value:function(e){e<this.startTime||(e>=1e3*this.duration?this.logger.info("seek","seek to time:",e):(this.seekTime=Date.now(),this.seeking=!0,this.currentTime=e,this.action.seek(e)))}},{key:"resizeScreen",value:function(e,t){G.adaptSizeElement(e,t,this.$screenContainer,this.$canvas)}},{key:"muted",get:function(){return Y()(this,Nn)},set:function(e){ae()(this,Nn,!!e)}},{key:"playbackRate",set:function(e){ae()(this,Un,e)},get:function(){return Y()(this,Un)}},{key:"seeking",set:function(e){ae()(this,Mn,e),e?this.events.emit(B.PlayerSeeking):this.events.emit(B.PlayerSeekEnd)},get:function(){return Y()(this,Mn)}},{key:"currentTime",get:function(){return Y()(this,On)},set:function(e){ae()(this,On,e)}},{key:"volume",get:function(){return this.audioPlayer.volume},set:function(e){this.audioPlayer.volume=e}}]),n}(z),pn=new WeakMap,On=new WeakMap,Mn=new WeakMap,Un=new WeakMap,Nn=new WeakMap,Nr=function(i){function n(e,t){var r;return g()(this,n),r=L()(this,c()(n).call(this,e,t)),h()(p()(r),"libPath",null),r.options.processURL=t.processURL,r.libPath=t.libPath,r.options.needInit!==!1&&r.init(),r}return T()(n,i),k()(n,null,[{key:"getComponent",value:function(e){return tt[e]}},{key:"registerComponent",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"right",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1;if(typeof e!="string"||!e)throw new Error('Illegal component name, "'.concat(e,'"; must be a non-empty string.'));var l=Object.prototype.isPrototypeOf.call(Be,t.prototype);if(!l)throw new Error('Illegal component, "'.concat(e,'"; must be a BaseComponent subclass.'));tt[e]=t,sr.addComponet(e),r==="left"?ar.addCustomControl(e,a):rr.addCustomControl(e,a)}}]),n}(Ur);te.default=Nr},function(F,te){F.exports=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}},function(F,te){F.exports=function(m){return Function.toString.call(m).indexOf("[native code]")!==-1}},function(F,te,m){var P=function(g){var C=Object.prototype,k=C.hasOwnProperty,V=typeof Symbol=="function"?Symbol:{},L=V.iterator||"@@iterator",$=V.asyncIterator||"@@asyncIterator",c=V.toStringTag||"@@toStringTag";function K(S,x,D,R){var M=x&&x.prototype instanceof T?x:T,z=Object.create(M.prototype),Q=new Z(R||[]);return z._invoke=function(ue,pe,le){var ve="suspendedStart";return function(Pe,Se){if(ve==="executing")throw new Error("Generator is already running");if(ve==="completed"){if(Pe==="throw")throw Se;return G()}for(le.method=Pe,le.arg=Se;;){var Ae=le.delegate;if(Ae){var De=he(Ae,le);if(De){if(De===I)continue;return De}}if(le.method==="next")le.sent=le._sent=le.arg;else if(le.method==="throw"){if(ve==="suspendedStart")throw ve="completed",le.arg;le.dispatchException(le.arg)}else le.method==="return"&&le.abrupt("return",le.arg);ve="executing";var Ce=p(ue,pe,le);if(Ce.type==="normal"){if(ve=le.done?"completed":"suspendedYield",Ce.arg===I)continue;return{value:Ce.arg,done:le.done}}Ce.type==="throw"&&(ve="completed",le.method="throw",le.arg=Ce.arg)}}}(S,D,Q),z}function p(S,x,D){try{return{type:"normal",arg:S.call(x,D)}}catch(R){return{type:"throw",arg:R}}}g.wrap=K;var I={};function T(){}function ne(){}function h(){}var q={};q[L]=function(){return this};var Y=Object.getPrototypeOf,N=Y&&Y(Y(j([])));N&&N!==C&&k.call(N,L)&&(q=N);var ae=h.prototype=T.prototype=Object.create(q);function de(S){["next","throw","return"].forEach(function(x){S[x]=function(D){return this._invoke(x,D)}})}function fe(S,x){var D;this._invoke=function(R,M){function z(){return new x(function(Q,ue){(function pe(le,ve,Pe,Se){var Ae=p(S[le],S,ve);if(Ae.type!=="throw"){var De=Ae.arg,Ce=De.value;return Ce&&typeof Ce=="object"&&k.call(Ce,"__await")?x.resolve(Ce.__await).then(function(He){pe("next",He,Pe,Se)},function(He){pe("throw",He,Pe,Se)}):x.resolve(Ce).then(function(He){De.value=He,Pe(De)},function(He){return pe("throw",He,Pe,Se)})}Se(Ae.arg)})(R,M,Q,ue)})}return D=D?D.then(z,z):z()}}function he(S,x){var D=S.iterator[x.method];if(D===void 0){if(x.delegate=null,x.method==="throw"){if(S.iterator.return&&(x.method="return",x.arg=void 0,he(S,x),x.method==="throw"))return I;x.method="throw",x.arg=new TypeError("The iterator does not provide a 'throw' method")}return I}var R=p(D,S.iterator,x.arg);if(R.type==="throw")return x.method="throw",x.arg=R.arg,x.delegate=null,I;var M=R.arg;return M?M.done?(x[S.resultName]=M.value,x.next=S.nextLoc,x.method!=="return"&&(x.method="next",x.arg=void 0),x.delegate=null,I):M:(x.method="throw",x.arg=new TypeError("iterator result is not an object"),x.delegate=null,I)}function re(S){var x={tryLoc:S[0]};1 in S&&(x.catchLoc=S[1]),2 in S&&(x.finallyLoc=S[2],x.afterLoc=S[3]),this.tryEntries.push(x)}function oe(S){var x=S.completion||{};x.type="normal",delete x.arg,S.completion=x}function Z(S){this.tryEntries=[{tryLoc:"root"}],S.forEach(re,this),this.reset(!0)}function j(S){if(S){var x=S[L];if(x)return x.call(S);if(typeof S.next=="function")return S;if(!isNaN(S.length)){var D=-1,R=function M(){for(;++D<S.length;)if(k.call(S,D))return M.value=S[D],M.done=!1,M;return M.value=void 0,M.done=!0,M};return R.next=R}}return{next:G}}function G(){return{value:void 0,done:!0}}return ne.prototype=ae.constructor=h,h.constructor=ne,h[c]=ne.displayName="GeneratorFunction",g.isGeneratorFunction=function(S){var x=typeof S=="function"&&S.constructor;return!!x&&(x===ne||(x.displayName||x.name)==="GeneratorFunction")},g.mark=function(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,h):(S.__proto__=h,c in S||(S[c]="GeneratorFunction")),S.prototype=Object.create(ae),S},g.awrap=function(S){return{__await:S}},de(fe.prototype),fe.prototype[$]=function(){return this},g.AsyncIterator=fe,g.async=function(S,x,D,R,M){M===void 0&&(M=Promise);var z=new fe(K(S,x,D,R),M);return g.isGeneratorFunction(x)?z:z.next().then(function(Q){return Q.done?Q.value:z.next()})},de(ae),ae[c]="Generator",ae[L]=function(){return this},ae.toString=function(){return"[object Generator]"},g.keys=function(S){var x=[];for(var D in S)x.push(D);return x.reverse(),function R(){for(;x.length;){var M=x.pop();if(M in S)return R.value=M,R.done=!1,R}return R.done=!0,R}},g.values=j,Z.prototype={constructor:Z,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(oe),!S)for(var x in this)x.charAt(0)==="t"&&k.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=void 0)},stop:function(){this.done=!0;var S=this.tryEntries[0].completion;if(S.type==="throw")throw S.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var x=this;function D(pe,le){return z.type="throw",z.arg=S,x.next=pe,le&&(x.method="next",x.arg=void 0),!!le}for(var R=this.tryEntries.length-1;R>=0;--R){var M=this.tryEntries[R],z=M.completion;if(M.tryLoc==="root")return D("end");if(M.tryLoc<=this.prev){var Q=k.call(M,"catchLoc"),ue=k.call(M,"finallyLoc");if(Q&&ue){if(this.prev<M.catchLoc)return D(M.catchLoc,!0);if(this.prev<M.finallyLoc)return D(M.finallyLoc)}else if(Q){if(this.prev<M.catchLoc)return D(M.catchLoc,!0)}else{if(!ue)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return D(M.finallyLoc)}}}},abrupt:function(S,x){for(var D=this.tryEntries.length-1;D>=0;--D){var R=this.tryEntries[D];if(R.tryLoc<=this.prev&&k.call(R,"finallyLoc")&&this.prev<R.finallyLoc){var M=R;break}}M&&(S==="break"||S==="continue")&&M.tryLoc<=x&&x<=M.finallyLoc&&(M=null);var z=M?M.completion:{};return z.type=S,z.arg=x,M?(this.method="next",this.next=M.finallyLoc,I):this.complete(z)},complete:function(S,x){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&x&&(this.next=x),I},finish:function(S){for(var x=this.tryEntries.length-1;x>=0;--x){var D=this.tryEntries[x];if(D.finallyLoc===S)return this.complete(D.completion,D.afterLoc),oe(D),I}},catch:function(S){for(var x=this.tryEntries.length-1;x>=0;--x){var D=this.tryEntries[x];if(D.tryLoc===S){var R=D.completion;if(R.type==="throw"){var M=R.arg;oe(D)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(S,x,D){return this.delegate={iterator:j(S),resultName:x,nextLoc:D},this.method==="next"&&(this.arg=void 0),I}},g}(F.exports);try{regeneratorRuntime=P}catch(g){Function("r","regeneratorRuntime = r")(P)}},function(F,te,m){(function(){var P=m(49),g=m(90);function C(k){var V=k.getContext("2d"),L=null,$=null,c=null;return this.drawFrame=function(K){var p=K.format;k.width===p.displayWidth&&k.height===p.displayHeight||(k.width=p.displayWidth,k.height=p.displayHeight),L!==null&&L.width==p.width&&L.height==p.height||function(q,Y){for(var N=(L=V.createImageData(q,Y)).data,ae=q*Y*4,de=0;de<ae;de+=4)N[de+3]=255}(p.width,p.height),g.convertYCbCr(K,L.data);var I,T,ne,h=p.cropWidth!=p.displayWidth||p.cropHeight!=p.displayHeight;h?($||(T=p.cropWidth,ne=p.cropHeight,($=document.createElement("canvas")).width=T,$.height=ne,c=$.getContext("2d")),I=c):I=V,I.putImageData(L,-p.cropLeft,-p.cropTop,p.cropLeft,p.cropTop,p.cropWidth,p.cropHeight),h&&V.drawImage($,0,0,p.displayWidth,p.displayHeight)},this.clear=function(){V.clearRect(0,0,k.width,k.height)},this}C.prototype=Object.create(P.prototype),F.exports=C})()},function(F,te,m){(function(){var P=m(91);/**
	 * Basic YCbCr->RGB conversion
	 *
	 * @author Brion Vibber <brion@pobox.com>
	 * @copyright 2014-2019
	 * @license MIT-style
	 *
	 * @param {YUVFrame} buffer - input frame buffer
	 * @param {Uint8ClampedArray} output - array to draw RGBA into
	 * Assumes that the output array already has alpha channel set to opaque.
	 */F.exports={convertYCbCr:function(g,C){var k=0|g.format.width,V=0|g.format.height,L=0|P(g.format.width/g.format.chromaWidth),$=0|P(g.format.height/g.format.chromaHeight),c=g.y.bytes,K=g.u.bytes,p=g.v.bytes,I=0|g.y.stride,T=0|g.u.stride,ne=0|g.v.stride,h=k<<2,q=0,Y=0,N=0,ae=0,de=0,fe=0,he=0,re=0,oe=0,Z=0,j=0,G=0,S=0,x=0,D=0,R=0,M=0,z=0;if(L==1&&$==1)for(he=0,re=h,z=0,R=0;R<V;R+=2){for(N=(Y=R*I|0)+I|0,ae=z*T|0,de=z*ne|0,D=0;D<k;D+=2)oe=0|K[ae++],G=(409*(Z=0|p[de++])|0)-57088|0,S=(100*oe|0)+(208*Z|0)-34816|0,x=(516*oe|0)-70912|0,j=298*c[Y++]|0,C[he]=j+G>>8,C[he+1]=j-S>>8,C[he+2]=j+x>>8,he+=4,j=298*c[Y++]|0,C[he]=j+G>>8,C[he+1]=j-S>>8,C[he+2]=j+x>>8,he+=4,j=298*c[N++]|0,C[re]=j+G>>8,C[re+1]=j-S>>8,C[re+2]=j+x>>8,re+=4,j=298*c[N++]|0,C[re]=j+G>>8,C[re+1]=j-S>>8,C[re+2]=j+x>>8,re+=4;he+=h,re+=h,z++}else for(fe=0,R=0;R<V;R++)for(M=0,q=R*I|0,ae=(z=R>>$)*T|0,de=z*ne|0,D=0;D<k;D++)oe=0|K[ae+(M=D>>L)],G=(409*(Z=0|p[de+M])|0)-57088|0,S=(100*oe|0)+(208*Z|0)-34816|0,x=(516*oe|0)-70912|0,j=298*c[q++]|0,C[fe]=j+G>>8,C[fe+1]=j-S>>8,C[fe+2]=j+x>>8,fe+=4}}})()},function(F,te){(function(){/**
* Convert a ratio into a bit-shift count; for instance a ratio of 2
* becomes a bit-shift of 1, while a ratio of 1 is a bit-shift of 0.
*
* @author Brion Vibber <brion@pobox.com>
* @copyright 2016
* @license MIT-style
*
* @param {number} ratio - the integer ratio to convert.
* @returns {number} - number of bits to shift to multiply/divide by the ratio.
* @throws exception if given a non-power-of-two
*/F.exports=function(m){for(var P=0,g=m>>1;g!=0;)g>>=1,P++;if(m!==1<<P)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+m;return P}})()},function(F,te,m){(function(){var P=m(49),g=m(93);function C(k){var V,L,$=this,c=C.contextForCanvas(k);if(c===null)throw new Error("WebGL unavailable");function K(D,R){var M=c.createShader(D);if(c.shaderSource(M,R),c.compileShader(M),!c.getShaderParameter(M,c.COMPILE_STATUS)){var z=c.getShaderInfoLog(M);throw c.deleteShader(M),new Error("GL shader compilation for "+D+" failed: "+z)}return M}var p,I,T,ne,h,q,Y,N,ae,de,fe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),he={},re={},oe={};function Z(D){return he[D]||(he[D]=c.createTexture()),he[D]}function j(D,R,M,z){var Q=Z(D);if(c.activeTexture(c.TEXTURE0),C.stripe){var ue=!he[D+"_temp"],pe=Z(D+"_temp");c.bindTexture(c.TEXTURE_2D,pe),ue?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,R/4,M,0,c.RGBA,c.UNSIGNED_BYTE,z)):c.texSubImage2D(c.TEXTURE_2D,0,0,0,R/4,M,c.RGBA,c.UNSIGNED_BYTE,z);var le=he[D+"_stripe"],ve=!le;ve&&(le=Z(D+"_stripe")),c.bindTexture(c.TEXTURE_2D,le),ve&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,R,1,0,c.RGBA,c.UNSIGNED_BYTE,function(Pe){if(oe[Pe])return oe[Pe];for(var Se=Pe,Ae=new Uint32Array(Se),De=0;De<Se;De+=4)Ae[De]=255,Ae[De+1]=65280,Ae[De+2]=16711680,Ae[De+3]=4278190080;return oe[Pe]=new Uint8Array(Ae.buffer)}(R)))}else c.bindTexture(c.TEXTURE_2D,Q),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.LUMINANCE,R,M,0,c.LUMINANCE,c.UNSIGNED_BYTE,z)}function G(D,R,M){var z=he[D];c.useProgram(L);var Q=re[D];Q||(c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,z),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,R,M,0,c.RGBA,c.UNSIGNED_BYTE,null),Q=re[D]=c.createFramebuffer()),c.bindFramebuffer(c.FRAMEBUFFER,Q),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,z,0);var ue=he[D+"_temp"];c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,ue),c.uniform1i(q,1);var pe=he[D+"_stripe"];c.activeTexture(c.TEXTURE2),c.bindTexture(c.TEXTURE_2D,pe),c.uniform1i(h,2),c.bindBuffer(c.ARRAY_BUFFER,p),c.enableVertexAttribArray(I),c.vertexAttribPointer(I,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,T),c.enableVertexAttribArray(ne),c.vertexAttribPointer(ne,2,c.FLOAT,!1,0,0),c.viewport(0,0,R,M),c.drawArrays(c.TRIANGLES,0,fe.length/2),c.bindFramebuffer(c.FRAMEBUFFER,null)}function S(D,R,M){c.activeTexture(R),c.bindTexture(c.TEXTURE_2D,he[D]),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.uniform1i(c.getUniformLocation(V,D),M)}function x(D,R){var M=K(c.VERTEX_SHADER,D),z=K(c.FRAGMENT_SHADER,R),Q=c.createProgram();if(c.attachShader(Q,M),c.attachShader(Q,z),c.linkProgram(Q),!c.getProgramParameter(Q,c.LINK_STATUS)){var ue=c.getProgramInfoLog(Q);throw c.deleteProgram(Q),new Error("GL program linking failed: "+ue)}return Q}return $.drawFrame=function(D){var R=D.format,M=!V||k.width!==R.displayWidth||k.height!==R.displayHeight;if(M&&(k.width=R.displayWidth,k.height=R.displayHeight,$.clear()),V||function(){if(C.stripe){L=x(g.vertexStripe,g.fragmentStripe),c.getAttribLocation(L,"aPosition"),T=c.createBuffer();var Q=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);c.bindBuffer(c.ARRAY_BUFFER,T),c.bufferData(c.ARRAY_BUFFER,Q,c.STATIC_DRAW),ne=c.getAttribLocation(L,"aTexturePosition"),h=c.getUniformLocation(L,"uStripe"),q=c.getUniformLocation(L,"uTexture")}V=x(g.vertex,g.fragment),p=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,p),c.bufferData(c.ARRAY_BUFFER,fe,c.STATIC_DRAW),I=c.getAttribLocation(V,"aPosition"),Y=c.createBuffer(),N=c.getAttribLocation(V,"aLumaPosition"),ae=c.createBuffer(),de=c.getAttribLocation(V,"aChromaPosition")}(),M){var z=function(Q,ue,pe){var le=R.cropLeft/pe,ve=(R.cropLeft+R.cropWidth)/pe,Pe=(R.cropTop+R.cropHeight)/R.height,Se=R.cropTop/R.height,Ae=new Float32Array([le,Pe,ve,Pe,le,Se,le,Se,ve,Pe,ve,Se]);c.bindBuffer(c.ARRAY_BUFFER,Q),c.bufferData(c.ARRAY_BUFFER,Ae,c.STATIC_DRAW)};z(Y,0,D.y.stride),z(ae,0,D.u.stride*R.width/R.chromaWidth)}j("uTextureY",D.y.stride,R.height,D.y.bytes),j("uTextureCb",D.u.stride,R.chromaHeight,D.u.bytes),j("uTextureCr",D.v.stride,R.chromaHeight,D.v.bytes),C.stripe&&(G("uTextureY",D.y.stride,R.height),G("uTextureCb",D.u.stride,R.chromaHeight),G("uTextureCr",D.v.stride,R.chromaHeight)),c.useProgram(V),c.viewport(0,0,k.width,k.height),S("uTextureY",c.TEXTURE0,0),S("uTextureCb",c.TEXTURE1,1),S("uTextureCr",c.TEXTURE2,2),c.bindBuffer(c.ARRAY_BUFFER,p),c.enableVertexAttribArray(I),c.vertexAttribPointer(I,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,Y),c.enableVertexAttribArray(N),c.vertexAttribPointer(N,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,ae),c.enableVertexAttribArray(de),c.vertexAttribPointer(de,2,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,fe.length/2)},$.clear=function(){c.viewport(0,0,k.width,k.height),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)},$.clear(),$}C.stripe=navigator.userAgent.indexOf("Windows")!==-1,C.contextForCanvas=function(k){var V={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return k.getContext("webgl",V)||k.getContext("experimental-webgl",V)},C.isAvailable=function(){var k,V=document.createElement("canvas");V.width=1,V.height=1;try{k=C.contextForCanvas(V)}catch(T){return!1}if(k){var L=k.TEXTURE0,$=k.createTexture(),c=new Uint8Array(16),K=C.stripe?1:4,p=C.stripe?k.RGBA:k.LUMINANCE,I=C.stripe?k.NEAREST:k.LINEAR;return k.activeTexture(L),k.bindTexture(k.TEXTURE_2D,$),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,I),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,I),k.texImage2D(k.TEXTURE_2D,0,p,K,4,0,p,k.UNSIGNED_BYTE,c),!k.getError()}return!1},C.prototype=Object.create(P.prototype),F.exports=C})()},function(F,te){F.exports={vertex:`precision lowp float;

attribute vec2 aPosition;
attribute vec2 aLumaPosition;
attribute vec2 aChromaPosition;
varying vec2 vLumaPosition;
varying vec2 vChromaPosition;
void main() {
    gl_Position = vec4(aPosition, 0, 1);
    vLumaPosition = aLumaPosition;
    vChromaPosition = aChromaPosition;
}
`,fragment:`// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js

precision lowp float;

uniform sampler2D uTextureY;
uniform sampler2D uTextureCb;
uniform sampler2D uTextureCr;
varying vec2 vLumaPosition;
varying vec2 vChromaPosition;
void main() {
   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.
   float fY = texture2D(uTextureY, vLumaPosition).x;
   float fCb = texture2D(uTextureCb, vChromaPosition).x;
   float fCr = texture2D(uTextureCr, vChromaPosition).x;

   // Premultipy the Y...
   float fYmul = fY * 1.1643828125;

   // And convert that to RGB!
   gl_FragColor = vec4(
     fYmul + 1.59602734375 * fCr - 0.87078515625,
     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,
     fYmul + 2.017234375   * fCb - 1.081390625,
     1
   );
}
`,vertexStripe:`precision lowp float;

attribute vec2 aPosition;
attribute vec2 aTexturePosition;
varying vec2 vTexturePosition;

void main() {
    gl_Position = vec4(aPosition, 0, 1);
    vTexturePosition = aTexturePosition;
}
`,fragmentStripe:`// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures

precision lowp float;

uniform sampler2D uStripe;
uniform sampler2D uTexture;
varying vec2 vTexturePosition;
void main() {
   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture
   // so we can upload them without expanding the bytes on IE 11
   // which doesn't allow LUMINANCE or ALPHA textures
   // The stripe textures mark which channel to keep for each pixel.
   // Each texture extraction will contain the relevant value in one
   // channel only.

   float fLuminance = dot(
      texture2D(uStripe, vTexturePosition),
      texture2D(uTexture, vTexturePosition)
   );

   gl_FragColor = vec4(fLuminance, fLuminance, fLuminance, 1);
}
`}},function(F,te,m){m.r(te);var P=m(2),g=m.n(P),C=m(3),k=m.n(C),V=m(0),L=m.n(V),$=m(61),c=m.n($),K=m(11),p=m.n(K),I=m(18),T=m.n(I),ne=m(28),h=m.n(ne),q=m(10),Y=m(23),N=q.a.get("HTTP.js",{level:2}),ae=function(){var Z=h()(T.a.mark(function j(G){var S;return T.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(G instanceof Blob)){x.next=5;break}return x.next=3,new Response(G).arrayBuffer();case 3:return S=x.sent,x.abrupt("return",new Uint8Array(S,0));case 5:case"end":return x.stop()}},j)}));return function(j){return Z.apply(this,arguments)}}(),de=function(Z){if(Z)return Object.entries(Z).reduce(function(j,G,S){var x=c()(G,2),D=x[0],R=x[1];return j+(S===0?D+"="+encodeURIComponent(R):"&"+D+"="+encodeURIComponent(R))},"")};function fe(Z,j){var G=(typeof Z.clone=="function"?Z.clone():void 0)||Z,S=function(x,D){var R={body:D,headers:function(M){return M.headers.entries?function(z){var Q=Object.create(Object.getPrototypeOf(z.headers)),ue=!0,pe=!1,le=void 0;try{for(var ve,Pe=z.headers.entries()[Symbol.iterator]();!(ue=(ve=Pe.next()).done);ue=!0){var Se=c()(ve.value,2),Ae=Se[0],De=Se[1];Q[Ae]=De}}catch(Ce){pe=!0,le=Ce}finally{try{ue||Pe.return==null||Pe.return()}finally{if(pe)throw le}}return Q}(M):function(z){var Q={},ue=z.headers.__headers__;for(var pe in ue)Q[pe]=ue[pe].join("");return Q}(M)}(x),response:x,status:x.status,statusText:x.statusText};return x.ok?Promise.resolve(R):Promise.reject(R)};return Z[j]().then(function(x){return S(G,x)})}function he(Z,j){var G=Z.headers.get("content-type"),S=Z.clone().body.getReader(),x=0,D=x,R=setInterval(function(){var M=50*(x-D);M<=1||(N.info("HTTP>handleResponse","".concat(D," | ").concat(x),"".concat(M.toFixed(2)," Bytes/s")),self.postMessage({type:"notice",method:"fetch",noticeType:"speed",data:{speed:M,intervalValue:20,lastReceived:D,bytesReceived:x}}),D=x)},20);return S.read().then(function M(z){return z.done?(clearInterval(R),function(){if(j==="ts"||j==="video")return fe(Z,"blob");if(G.includes("json"))return fe(Z,"json");if(G.includes("text"))return fe(Z,"text");if(G.includes("form"))return fe(Z,"formData");if(G.includes("video")||G.includes("image")||G.includes("octet-stream"))return fe(Z,"blob");try{return fe(Z,"text")}catch(Q){return Object(Y.a)(Q,"[HTTP>handleResponse:unknow content-type]",G,Z),Promise.resolve(Z)}}()):(x+=z.value.length,S.read().then(M))})}var re=null,oe=(re||(re=new(function(){function Z(G){g()(this,Z),L()(this,"options",{"content-type":"application/json;charset=UTF-8",cache:"no-cache",mode:"cors"}),Object.assign(this.options,G)}var j;return k()(Z,[{key:"setOptions",value:function(G){var S=Object.assign(this.options,G);S.url=function(x){var D=x.url,R=x.params;return R?D+"?"+de(R):D}(S),S.method=S.method||"get",S.headers=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},D=x.headers,R=D===void 0?{}:D,M=x.method,z=M===void 0?"get":M,Q=x.username,ue=x.password,pe=x.token,le=new Headers(R);if(Q||ue){if(!Q)throw new TypeError("username required for basic authentication");if(!ue)throw new TypeError("password required for basic authentication");var ve=(typeof win=="undefined"?"undefined":p()(win))==="object"&&win.btoa?btoa:function(Pe){return Pe};le.set("Authorization","Basic "+ve(Q+":"+ue))}return pe&&le.set("Authorization","Bearer "+pe),z==="get"||le.get("content-type")||le.set("content-type","application/json"),le}(S),S.body=function(x){var D=x.headers.get("content-type");if(D)return D.includes("json")?JSON.stringify(x.body):D.includes("x-www-form-urlencoded")?de(x.body):x.body}(S),delete S.username,delete S.password,delete S.token,this.options=S}},{key:"request",value:function(G){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;if(G)return this.setOptions(Object.assign({url:G},S)),fetch(this.options.url,this.options).then(function(D){return he(D,x)});N.error("[HTTP>request]","url is undefined","url:",G,"options:",S)}},{key:"fetch",value:function(G){function S(x){return G.apply(this,arguments)}return S.toString=function(){return G.toString()},S}(function(){var G=h()(T.a.mark(function S(x){var D,R,M,z,Q=arguments;return T.a.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(D=Q.length>1&&Q[1]!==void 0?Q[1]:{},R=Q.length>2?Q[2]:void 0,M=Q.length>3?Q[3]:void 0,x){ue.next=6;break}return N.wran("[HTTP>fetch]","url is undefined","url:",x,"options:",D),ue.abrupt("return");case 6:return this.setOptions(Object.assign({url:x},D)),N.info("[HTTP>fetch]","http fetch","url:",x,"options:",D),ue.next=10,fetch(x,D);case 10:(z=ue.sent).ok?z.text().then(function(pe){self.postMessage({type:"invoke",method:"fetch",fileType:M,name:R,data:pe})}):self.postMessage({result:"failed"});case 12:case"end":return ue.stop()}},S,this)}));return function(S){return G.apply(this,arguments)}}())},{key:"get",value:(j=h()(T.a.mark(function G(S){var x,D,R,M,z,Q=arguments;return T.a.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return x=Q.length>1&&Q[1]!==void 0?Q[1]:{},D=Q.length>2?Q[2]:void 0,R=Q.length>3?Q[3]:void 0,x.method="get",N.info("[HTTP>get]","http get","url:",S,"options:",x,"name:",D,"fileType:",R),z={type:"invoke",method:"get",fileType:R,name:D,url:S},ue.prev=6,ue.next=9,this.request.call(this,S,x,R);case 9:M=ue.sent,ue.next=15;break;case 12:ue.prev=12,ue.t0=ue.catch(6),N.error("[HTTP>get]","networks error","url:",S,"options:",x,"name:",D,"fileType:",R,"ex:",ue.t0);case 15:if(!M||!M.body){ue.next=24;break}if(z.data=M.body,R!=="ts"&&R!=="video"){ue.next=21;break}return ue.next=20,ae(z.data);case 20:z.arrayBuffer=ue.sent;case 21:z.arrayBuffer?self.postMessage(z,[z.arrayBuffer.buffer]):self.postMessage(z),ue.next=27;break;case 24:z.type="error",z.data=M,self.postMessage(z);case 27:case"end":return ue.stop()}},G,this,[[6,12]])})),function(G){return j.apply(this,arguments)})}]),Z}())({})),re);te.default=function(Z){Z.onmessage=function(j){var G=j.data,S=G.type,x=G.method;switch(S){case"invoke":oe[x].call(oe,G.url,G.options,G.name,G.fileType)}}}},function(F,te){F.exports=function(m){if(Array.isArray(m))return m}},function(F,te){F.exports=function(m,P){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(m)){var g=[],C=!0,k=!1,V=void 0;try{for(var L,$=m[Symbol.iterator]();!(C=(L=$.next()).done)&&(g.push(L.value),!P||g.length!==P);C=!0);}catch(c){k=!0,V=c}finally{try{C||$.return==null||$.return()}finally{if(k)throw V}}return g}}},function(F,te,m){var P=m(98);F.exports=function(g,C){if(g){if(typeof g=="string")return P(g,C);var k=Object.prototype.toString.call(g).slice(8,-1);return k==="Object"&&g.constructor&&(k=g.constructor.name),k==="Map"||k==="Set"?Array.from(g):k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?P(g,C):void 0}}},function(F,te){F.exports=function(m,P){(P==null||P>m.length)&&(P=m.length);for(var g=0,C=new Array(P);g<P;g++)C[g]=m[g];return C}},function(F,te){F.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(F,te,m){m.r(te);var P,g=m(2),C=m.n(g),k=m(3),V=m.n(k),L=m(9),$=function(){function y(u){C()(this,y),this.decode=u,this.result=[]}return V()(y,[{key:"openDecode",value:function(){var u=this,o=Module.addFunction(function(s,d,b,_,E,O,X,W,J){var ee=HEAPU8.subarray(s,s+_*W),be=HEAPU8.subarray(d,d+E*W/2),Le=HEAPU8.subarray(b,b+O*W/2),se={stride_y:_,stride_u:E,stride_v:O,width:X,height:W,buf_y:new Uint8Array(ee),buf_u:new Uint8Array(be),buf_v:new Uint8Array(Le),pts:J};u.result.push(se)});Module._openDecoder(o,1)}},{key:"decodeData",value:function(u,o){var s=u.length,d=Module._malloc(s);Module.HEAPU8.set(u,d),Module._decodeData(d,s,o),Module._free(d)}},{key:"flush",value:function(){for(Module._flushDecoder();this.checkData();)this.decode.getDecodeYUV()}},{key:"closeDecode",value:function(){Module._closeDecoder()}},{key:"getYUV",value:function(){var u=null;return this.result.length>0&&(u=this.result.shift()),u}},{key:"checkData",value:function(){return this.result.length>0}}]),y}(),c=function(){function y(u){C()(this,y),this.decode=u}return V()(y,[{key:"openDecode",value:function(){return _web_decoder_open()}},{key:"closeDecode",value:function(u){_web_decoder_close(u)}},{key:"decodeData",value:function(u,o,s){var d=u.length||0;Module.ccall("web_decoder_decode_frame","number",["number","array","number","number"],[s,u,d,o])}},{key:"flush",value:function(u){var o=this.decode;if(_web_decoder_decode_frame)for(;!(_web_decoder_decode_frame(u,null,0,0)<0||!_web_got_frame(u));)o.getDecodeYUV(u)}},{key:"getYUV",value:function(u){var o=_web_get_stride_y(u),s=_web_get_stride_u(u),d=_web_get_stride_v(u),b=_web_get_width(u),_=_web_get_height(u),E=_web_get_frame_y(u),O=_web_get_frame_u(u),X=_web_get_frame_v(u),W=parseInt(_web_got_frame_pts(u)*L.a*1e3),J=HEAPU8.subarray(E,E+o*_),ee=HEAPU8.subarray(O,O+s*_/2),be=HEAPU8.subarray(X,X+d*_/2);return{stride_y:o,stride_u:s,stride_v:d,width:b,height:_,buf_y:new Uint8Array(J),buf_u:new Uint8Array(ee),buf_v:new Uint8Array(be),pts:W}}},{key:"checkData",value:function(u){return _web_got_frame(u)}}]),y}(),K=function(){function y(){C()(this,y),this.p=null,this.ptsList=[],this.ptsOffset=0,this.fps=0,this.lastDuration=0,this.previousPTS=0,this.status=!1,this.yuvArray=[],this.decodeTool=null}return V()(y,[{key:"loadWASM",value:function(u){var o=u.data.libPath;self.Module={locateFile:function(s){return o+s}},self.importScripts(o+"libffmpeg.js"),self.Module.onRuntimeInitialized=function(){console.log("wasm loaded"),Module._web_decoder_open?self.decode.decodeTool=new c(self.decode,this.event):self.decode.decodeTool=new $(self.decode,this.event),self.decode.openDecode(),self.decode.onWasmLoaded()}}},{key:"openDecode",value:function(){try{this.status||(this.p=this.decodeTool.openDecode(),this.status=!0),console.log("opendecode")}catch(u){console.error(u)}}},{key:"closeDecode",value:function(){this.status&&(this.decodeTool.closeDecode(this.p),this.status=!1)}},{key:"push",value:function(u){var o=this;u.forEach(function(s){var d=s.PTS,b=s.data_byte,_=s.partEnd,E=s.lastTS,O=o.ptsList;o.insertSort(O,parseInt(d*L.a*1e3)),o.decodeTool.decodeData(b,d,o.p),o.decodeTool.checkData(o.p)&&o.getDecodeYUV(o.p,_,E)})}},{key:"getDecodeYUV",value:function(u,o,s){if(!this.reseting){var d=0;this.fps||(this.fps=this.getFPS());var b=this.decodeTool.getYUV(u),_=this.ptsList.shift();b.pts=_,this.previousPTS&&_?(d=parseInt(_-this.previousPTS),this.lastDuration=d):d=this.lastDuration,b.duration=d,b.fps=this.fps,_&&(this.previousPTS=_,this.yuvArray.push(b),this.yuvArray.length>10&&(self.postMessage({type:"decoded",data:this.yuvArray}),this.yuvArray=[])),o&&(this.yuvArray.length&&(self.postMessage({type:"decoded",data:this.yuvArray}),this.yuvArray=[]),self.postMessage({type:"partEnd",data:s}))}}},{key:"reset",value:function(){this.reseting=!0,this.ptsList=[],this.ptsOffset=0,this.previousPTS=0,this.fps=0,this.yuvArray=[],this.closeDecode(),this.openDecode(),self.postMessage({type:"resetEnd",data:Date.now()}),this.reseting=!1}},{key:"flush",value:function(){this.decodeTool.flush(this.p),this.yuvArray.length&&(self.postMessage({type:"decoded",data:this.yuvArray}),this.yuvArray=[]),this.closeDecode(),self.postMessage({type:"flushEnd",data:this.previousPTS})}},{key:"getFPS",value:function(){var u=this.ptsList;return u.length>=2?Math.round(1e3/(u[1]-u[0])):null}},{key:"onWasmLoaded",value:function(){self.postMessage({type:"dataProcessorReady"})}},{key:"insertSort",value:function(u,o){var s=u.length;if(s!==0){for(var d=0;d<s;d++)if(o<u[d]){for(var b=s;b>d;)u[b]=u[b-1],b--;return void(u[d]=o)}u.push(o)}else u.push(o)}}]),y}(),p=m(0),I=m.n(p);function T(y,u,o){return(T=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(s,d,b){var _=function(O,X){for(;!Object.prototype.hasOwnProperty.call(O,X)&&(O=re(O))!==null;);return O}(s,d);if(_){var E=Object.getOwnPropertyDescriptor(_,d);return E.get?E.get.call(b):E.value}})(y,u,o||y)}function ne(y){return function(u){if(Array.isArray(u)){for(var o=0,s=new Array(u.length);o<u.length;o++)s[o]=u[o];return s}}(y)||function(u){if(Symbol.iterator in Object(u)||Object.prototype.toString.call(u)==="[object Arguments]")return Array.from(u)}(y)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(y){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(y)}function q(y,u){return!u||h(u)!=="object"&&typeof u!="function"?Y(y):u}function Y(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function N(y,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(u&&u.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),u&&he(y,u)}function ae(y){var u=typeof Map=="function"?new Map:void 0;return(ae=function(o){if(o===null||(s=o,Function.toString.call(s).indexOf("[native code]")===-1))return o;var s;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(u!==void 0){if(u.has(o))return u.get(o);u.set(o,d)}function d(){return fe(o,arguments,re(this).constructor)}return d.prototype=Object.create(o.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),he(d,o)})(y)}function de(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function fe(y,u,o){return(fe=de()?Reflect.construct:function(s,d,b){var _=[null];_.push.apply(_,d);var E=new(Function.bind.apply(s,_));return b&&he(E,b.prototype),E}).apply(null,arguments)}function he(y,u){return(he=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o})(y,u)}function re(y){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)})(y)}function oe(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function Z(y,u){for(var o=0;o<u.length;o++){var s=u[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(y,s.key,s)}}function j(y,u,o){return u&&Z(y.prototype,u),o&&Z(y,o),y}(function(y){y.ERROR="ERROR",y.INFO="INFO",y.DATA="DATA",y.DEMUX_DATA="DEMUX_DATA",y.DONE="DONE"})(P||(P={}));var G,S=Object.create||function(y){var u=function(){};return u.prototype=y,new u},x=Object.keys||function(y){for(var u in y)Object.prototype.hasOwnProperty.call(y,u);return u},D=Function.prototype.bind||function(y){var u=this;return function(){return u.apply(y,arguments)}},R=10,M=function(){function y(){oe(this,y),this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=S(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}return j(y,[{key:"emit",value:function(u){for(var o=arguments.length,s=new Array(o>1?o-1:0),d=1;d<o;d++)s[d-1]=arguments[d];var b,_,E,O,X,W,J=u==="error";if(W=this._events)J=J&&W.error==null;else if(!J)return!1;if(J){if(arguments.length>1&&(b=arguments[1]),b instanceof Error)throw b;var ee=new Error('Unhandled "error" event. ('+b+")");throw ee.context=b,ee}if(!(_=W[u]))return!1;var be=typeof _=="function";switch(E=arguments.length){case 1:Q(_,be,this);break;case 2:ue(_,be,this,arguments[1]);break;case 3:pe(_,be,this,arguments[1],arguments[2]);break;case 4:le(_,be,this,arguments[1],arguments[2],arguments[3]);break;default:for(O=new Array(E-1),X=1;X<E;X++)O[X-1]=arguments[X];ve(_,be,this,O)}return!0}},{key:"on",value:function(u,o){return function(s,d,b){var _,E,O;if(typeof b!="function")throw new TypeError('"listener" argument must be a function');if((E=s._events)?(E.newListener&&(s.emit("newListener",d,b.listener?b.listener:b),E=s._events),O=E[d]):(E=s._events=S(null),s._eventsCount=0),O){if(typeof O=="function"?O=E[d]=[O,b]:O.push(b),!O.warned&&(_=function(W){return W._maxListeners===void 0?y.defaultMaxListeners:W._maxListeners}(s))&&_>0&&O.length>_){O.warned=!0;var X=new(function(W){function J(){return oe(this,J),q(this,re(J).apply(this,arguments))}return N(J,W),J}(ae(Error)))("Possible Dispatcher memory leak detected. "+O.length+' "'+String(d)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');X.name="MaxListenersExceededWarning",X.emitter=s,X.type=d,X.count=O.length,(typeof console=="undefined"?"undefined":h(console))==="object"&&console.warn&&console.warn("%s: %s",X.name,X.message)}}else O=E[d]=b,++s._eventsCount;return s}(this,u,o)}},{key:"once",value:function(u,o){if(typeof o!="function")throw new TypeError('"listener" argument must be a function');return this.on(u,function(s,d,b){var _={fired:!1,wrapFn:void 0,target:s,type:d,listener:b},E=D.call(Se,_);return E.listener=b,_.wrapFn=E,E}(this,u,o)),this}},{key:"off",value:function(u,o){return Pe.call(this,u,o)}},{key:"removeAllListeners",value:function(u){var o,s,d;if(!(s=this._events))return this;if(!s.off)return arguments.length===0?(this._events=S(null),this._eventsCount=0):s[u]&&(--this._eventsCount==0?this._events=S(null):delete s[u]),this;if(arguments.length===0){var b,_=x(s);for(d=0;d<_.length;++d)(b=_[d])!=="off"&&this.removeAllListeners(b);return this.removeAllListeners("off"),this._events=S(null),this._eventsCount=0,this}if(typeof(o=s[u])=="function")this.off(u,o);else if(o)for(d=o.length-1;d>=0;d--)this.off(u,o[d]);return this}},{key:"listeners",value:function(u){return Ae(this,u,!0)}},{key:"rawListeners",value:function(u){return Ae(this,u,!1)}},{key:"listenerCount",value:function(){return y.listenerCount.apply(this,arguments)}}],[{key:"listenerCount",value:function(u,o){return typeof u.listenerCount=="function"?u.listenerCount(o):De.call(u,o)}}]),y}();try{var z={};Object.defineProperty&&Object.defineProperty(z,"x",{value:0}),G=z.x===0}catch(y){G=!1}function Q(y,u,o){if(u)y.call(o);else for(var s=y.length,d=Ce(y,s),b=0;b<s;++b)try{d[b].call(o)}catch(_){console.error(_)}}function ue(y,u,o,s){if(u)y.call(o,s);else for(var d=y.length,b=Ce(y,d),_=0;_<d;++_)try{b[_].call(o,s)}catch(E){console.error(E)}}function pe(y,u,o,s,d){if(u)y.call(o,s,d);else for(var b=y.length,_=Ce(y,b),E=0;E<b;++E)try{_[E].call(o,s,d)}catch(O){console.error(O)}}function le(y,u,o,s,d,b){if(u)y.call(o,s,d,b);else for(var _=y.length,E=Ce(y,_),O=0;O<_;++O)try{E[O].call(o,s,d,b)}catch(X){console.error(X)}}function ve(y,u,o,s){if(u)y.apply(o,s);else for(var d=y.length,b=Ce(y,d),_=0;_<d;++_)try{b[_].apply(o,s)}catch(E){console.error(E)}}function Pe(y,u){var o,s,d,b,_;if(typeof u!="function")throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(o=s[y]))return this;if(o===u||o.listener===u)--this._eventsCount==0?this._events=S(null):(delete s[y],s.off&&this.emit("off",y,o.listener||u));else if(typeof o!="function"){for(d=-1,b=o.length-1;b>=0;b--)if(o[b]===u||o[b].listener===u){_=o[b].listener,d=b;break}if(d<0)return this;d===0?o.shift():function(E,O){for(var X=O,W=X+1,J=E.length;W<J;X+=1,W+=1)E[X]=E[W];E.pop()}(o,d),o.length===1&&(s[y]=o[0]),s.off&&this.emit("off",y,_||u)}return this}function Se(){if(!this.fired)switch(this.target.off(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var y=new Array(arguments.length),u=0;u<y.length;++u)y[u]=arguments[u];this.listener.apply(this.target,y)}}function Ae(y,u,o){var s=y._events;if(!s)return[];var d=s[u];return d?typeof d=="function"?o?[d.listener||d]:[d]:o?function(b){for(var _=new Array(b.length),E=0;E<_.length;++E)_[E]=b[E].listener||b[E];return _}(d):Ce(d,d.length):[]}function De(y){var u=this._events;if(u){var o=u[y];if(typeof o=="function")return 1;if(o)return o.length}return 0}function Ce(y,u){for(var o=new Array(u),s=0;s<u;++s)o[s]=y[s];return o}G?Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return R},set:function(y){if(typeof y!="number"||y<0||y!=y)throw new TypeError('"defaultMaxListeners" must be a positive number');R=y}}):M.defaultMaxListeners=R;var He=function(y){function u(){return oe(this,u),q(this,re(u).apply(this,arguments))}return N(u,y),u}(M),ft=Object.prototype.toString;function Ue(y){return!!y&&h(y)=="object"}function wt(y){return typeof y=="number"&&!isNaN(y)}function dt(y){return Ue(y)&&ft.call(y).toLowerCase()==="[object arraybuffer]"}var pt,Pt=function(){function y(){oe(this,y),this.list_=[]}return j(y,[{key:"clear",value:function(){var u=this.list_.length;u>0&&this.list_.splice(0,u),this.byteLength_=null}},{key:"toNewBytes",value:function(){for(var u=null,o=0;u===null;)try{o++,u=new Uint8Array(this.byteLength)}catch(_){if(o>50)throw _}for(var s=0,d=0;s<this.list_.length;s++){var b=this.list_[s];u.set(b,d),d+=b.byteLength}return u}},{key:"append",value:function(u){u instanceof y?this.list_=this.list_.concat(u.bufferList):this.list_.push(u),this.byteLength_=null}},{key:"cut",value:function(u){var o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=null;if(u>0&&!this.empty){for(var d=this.list_,b=0,_=0;d.length>0;){var E=d.shift();if(_!==0){var O=u-b;if(E.byteLength>=O){o&&s.set(E.subarray(0,O),b),(E=E.subarray(O)).byteLength>0&&d.unshift(E);break}o&&s.set(E,b),b+=E.byteLength;break}if(E.byteLength>=u){o&&(s=E.subarray(0,u)),E.byteLength>u&&(E=E.subarray(u),d.unshift(E));break}if(o){try{s=new Uint8Array(u)}catch(X){throw"alloc_memory_error@ cache buffer: ".concat(u," ").concat(X.message)}s.set(E,0)}b+=E.byteLength,_++}this.byteLength_=null}return s}},{key:"byteLength",get:function(){if(!wt(this.byteLength_)){for(var u=0,o=0;o<this.list_.length;o++)u+=this.list_[o].byteLength;this.byteLength_=u}return this.byteLength_}},{key:"bytes",get:function(){var u=this.bufferList,o=null;return u.length>0&&(o=u.length===0?u[0]:this.toNewBytes()),o}},{key:"empty",get:function(){return this.list_.length===0}},{key:"bufferList",get:function(){return this.list_}}]),y}(),_t=function(){function y(){oe(this,y),this.map_={}}return j(y,[{key:"push",value:function(u,o){Object.prototype.hasOwnProperty.call(this.map_,u)?this.map_[u].push(o):this.map_[u]=[o]}},{key:"get",value:function(u){var o=this.map_[u];return o?o.slice():null}},{key:"getAll",value:function(){var u=[];for(var o in this.map_)u.push.apply(u,this.map_[o]);return u}},{key:"remove",value:function(u,o){var s=this.map_[u];if(s)for(var d=0;d<s.length;++d)s[d]==o&&(s.splice(d,1),--d)}},{key:"clear",value:function(){this.map_={}}},{key:"forEach",value:function(u){for(var o in this.map_)u(o,this.map_[o])}}]),y}(),gn=function(){function y(u,o,s){oe(this,y),this.target=u,this.type=o,this.listener=s,this.target.addEventListener?this.target.addEventListener(o,s,!1):this.target.on&&this.target.on(o,s,!1)}return j(y,[{key:"off",value:function(){this.target.removeEventListener?this.target.removeEventListener(this.type,this.listener,!1):this.target.off&&this.target.off(this.type,this.listener,!1),this.target=null,this.listener=null}}]),y}(),B=function(){function y(){oe(this,y),this.bindingMap_=new _t}return j(y,[{key:"destroy",value:function(){this.removeAll(),this.bindingMap_=null}},{key:"on",value:function(u,o,s){if(this.bindingMap_){var d=new gn(u,o,s);return this.bindingMap_.push(o,d),this}}},{key:"once",value:function(u,o,s){this.on(u,o,function(d){this.off(u,o),s(d)}.bind(this))}},{key:"off",value:function(u,o){if(this.bindingMap_)for(var s=this.bindingMap_.get(o)||[],d=0;d<s.length;++d){var b=s[d];b.target==u&&(b.off(),this.bindingMap_.remove(o,b))}}},{key:"removeAll",value:function(){if(this.bindingMap_){for(var u=this.bindingMap_.getAll(),o=0;o<u.length;++o)u[o].off();this.bindingMap_.clear()}}}]),y}(),Ne=(typeof window=="undefined"?self:window).console,nt=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof importScripts!="undefined",Ke=">>>",Oe=new(function(y){function u(){var o;return oe(this,u),(o=q(this,re(u).call(this)))._enable=!1,o}return N(u,y),j(u,[{key:"log",value:function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];var b;nt?Oe.emit(this.MSG_NAME,"log",[].concat(s).join("")):this._enable&&(b=Ne.log).call.apply(b,[Ne,Ke].concat(s))}},{key:"debug",value:function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];var b;nt?Oe.emit(this.MSG_NAME,"debug",[].concat(s).join("")):this._enable&&Ne.debug&&(b=Ne.debug).call.apply(b,[Ne,Ke].concat(s))}},{key:"assert",value:function(){if(this._enable&&Ne.assert){for(var o,s=arguments.length,d=new Array(s),b=0;b<s;b++)d[b]=arguments[b];var _=d[0],E=Array.prototype.slice.call(d,1);E.unshift(Ke),(o=Ne.assert).call.apply(o,[Ne,_].concat(ne(E)))}}},{key:"warn",value:function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];var b;nt?Oe.emit(this.MSG_NAME,"warn",[].concat(s).join("")):this._enable&&(b=Ne.warn).call.apply(b,[Ne,Ke].concat(s))}},{key:"error",value:function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];var b;nt?Oe.emit(this.MSG_NAME,"error",[].concat(s).join("")):this._enable&&(b=Ne.error).call.apply(b,[Ne,Ke].concat(s))}},{key:"enable",get:function(){return this._enable},set:function(o){this._enable=o,this.MSG_NAME="__log__"}}]),u}(M)),rt=function(y){function u(){return oe(this,u),q(this,re(u).call(this))}return N(u,y),j(u,[{key:"pipe",value:function(o){return this.on("reset",function(){o.reset()}),this.on("data",function(s){o.push(s)}),this.on("done",function(s){o.flush(s)}),o}},{key:"unpipe",value:function(){return this.removeAllListeners("reset"),this.removeAllListeners("data"),this.removeAllListeners("done"),this}},{key:"push",value:function(o,s){this.emit("data",o)}},{key:"flush",value:function(o){this.emit("done",o)}},{key:"reset",value:function(){this.emit("reset")}}]),u}(M),xt=function(y){function u(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return oe(this,u),o=q(this,re(u).call(this)),s.debug&&(Oe.enable=!0),o.ctx_=new He,o.options_=s,o.cache_buffer_=new Pt,o}return N(u,y),j(u,[{key:"listenEndStream_",value:function(){var o=this;this.eventManager_=new B,this.eventManager_.on(this.endStream,"data",function(s){o.emit(P.DEMUX_DATA,s)}).on(this.endStream,"done",function(s){o.emit(P.DONE,s)}).on(this.ctx_,"error",function(s){o.emit(P.ERROR,s)})}},{key:"constraintPushData_",value:function(o){var s,d=null;return dt(o)||Ue(s=o)&&ft.call(s).toLowerCase()==="[object uint8array]"?d=dt(o)?new Uint8Array(o):o:(Oe.error("Data pushed is not an ArrayBuffer or Uint8Array: ".concat(o)),d)}},{key:"reset",value:function(){}},{key:"destroy",value:function(){this.unpipe(),this.endStream.unpipe(),this.eventManager_.removeAll()}}]),u}(rt);(function(y){y[y.WORKER_EXCEPTION=0]="WORKER_EXCEPTION",y[y.WORKER_MSG_EXCEPTION=1]="WORKER_MSG_EXCEPTION",y[y.TS_SYNC_BYTE=2]="TS_SYNC_BYTE",y[y.FLV_HEAD_SIGNATURE=3]="FLV_HEAD_SIGNATURE",y[y.FLV_NOT_EXPECTED_ADJACENT_DATA=4]="FLV_NOT_EXPECTED_ADJACENT_DATA"})(pt||(pt={}));var mn=pt;function Bt(y){var u=0;return ArrayBuffer.isView(y)&&(u=y.byteOffset,y=y.buffer),new DataView(y,u)}var it=function(){function y(){oe(this,y)}return j(y,[{key:"readUint8",value:function(u,o){return Bt(u).getUint8(o)}},{key:"readUint16",value:function(u,o){var s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return Bt(u).getUint16(o,s)}},{key:"readUint32",value:function(u,o){var s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return Bt(u).getUint32(o,s)}}]),y}(),bn=function(y){function u(o){var s;oe(this,u),(s=q(this,re(u).call(this))).table_id=o[0],s.section_syntax_indicator=o[1]>>7,s.section_length=(15&o[1])<<8|o[2],s.transport_stream_id=s.readUint16(o,3),s.version_number=o[5]>>1&31,s.current_next_indicator=o[5]&&1,s.section_number=o[6],s.last_section_number=o[7],s.network_PID=0;var d,b=0,_=s.section_length-4-5;for(s.pmtTable=[];b<_;b+=4)(d=s.readUint16(o,8+b))==0?(s.network_PID=(31&o[10+b])<<8|o[11+b],Oe.log("packet->network_PID %0x /n/n",s.network_PID)):s.pmtTable.push({programNum:d,program_map_PID:(31&o[10+b])<<8|o[11+b]});var E=s.section_length+3;return s.CRC_32=(255&o[E-4])<<24|(255&o[E-3])<<16|(255&o[E-2])<<8|255&o[E-1],s}return N(u,y),u}(it),Ge=function(y){function u(o){var s;if(oe(this,u),(s=q(this,re(u).call(this))).table_id=o[0],s.section_syntax_indicator=o[1]>>7,s.section_length=(15&o[1])<<8|o[2],s.program_number=s.readUint16(o,3),s.version_number=o[5]>>1&31,s.current_next_indicator=o[5]&&1,s.section_number=o[6],s.last_section_number=o[7],s.PCR_PID=(31&o[8])<<8|o[9],s.program_info_length=(15&o[10])<<8|o[11],s.program_info_length<0)return q(s);if(s.program_info_length>2)for(var d=0;d<s.program_info_length;)d+=o[13+d];var b=12+s.program_info_length,_=s.section_length-s.program_info_length-9-4,E=b+_;if(b>=E)return Oe.warn("es_section_pos < es_section_end ".concat(b,", ").concat(E)),q(s);s.pes_table=[];for(var O=0;O<_;){var X=o[b+O],W=8191&s.readUint16(o,b+O+1),J=4095&s.readUint16(o,b+O+3);if(s.pes_table.push({streamType:X,PID:W}),J>2)for(var ee=0,be=b+O+5;ee<J;)ee+=o[be+ee];O+=J+5}var Le=s.section_length+3;return s.CRC_32=(255&o[Le-4])<<24|(255&o[Le-3])<<16|(255&o[Le-2])<<8|255&o[Le-1],s}return N(u,y),j(u,[{key:"parse",value:function(){}}]),u}(it),Qe=function(y){function u(o){var s;oe(this,u),(s=q(this,re(u).call(this))).table_id=o[0],s.section_syntax_indicator=o[1]>>7,s.section_length=(15&o[1])<<8|o[2],s.transport_stream_id=s.readUint16(o,3),s.version_number=o[5]>>1&31,s.current_next_indicator=1&o[5],s.section_number=o[6],s.last_section_number=o[7],s.original_network_id=s.readUint16(o,8);var d=s.section_length-8-4;s.service_table=[];for(var b=0;b<d;){for(var _=0,E={service_id:s.readUint16(o,11),EIT_schedule_flag:2&o[13],EIT_present_following_flag:1&o[13],running_status:o[14]>>5,free_CA_mode:o[14]>>4&1,descriptors_loop_length:(15&o[14])<<8|o[15],provider_name:"",name:""};_<E.descriptors_loop_length;){var O=16+_,X=o[O],W=o[O+1];switch(X){case 72:var J=[],ee=o[O+3],be=0,Le=0,se=O+4;for(be=0;be<ee;be++)J.push(String.fromCharCode(o[se])),se+=1;E.provider_name=J.join("");var Xe=[],ke=o[se];for(se+=1,Le=0;Le<ke;Le++)Xe.push(String.fromCharCode(o[se])),se+=1;E.name=Xe.join("");break;default:Oe.warn("sdt section unhandled descriptor_tag ".concat(X))}_+=2+W}s.service_table.push(E),b+=5+E.descriptors_loop_length}return s}return N(u,y),u}(it),Fe=function y(){oe(this,y)},kn=function(){function y(u){oe(this,y),this.context=u,this.metadata=new Fe,this.pat_table=[],this.pes_streams=[]}return j(y,[{key:"reset",value:function(){this.metadata=new Fe,this.pat_table.splice(0,this.pat_table.length),this.pes_streams.splice(0,this.pes_streams.length)}},{key:"parse",value:function(u){u.PID===0?this._parsePat(u):u.PID===1||u.PID===2||3<=u.PID&&u.PID<=15||(u.PID===17?this._parseSdt(u):u.PID===this.currentProgramPID&&this._parsePmt(u))}},{key:"findTrack",value:function(u){for(var o=null,s=this.pes_streams,d=0;d<s.length;d++)if(s[d].id===u){o=s[d];break}return o}},{key:"_parsePat",value:function(u){var o;if(u.payload_unit_start_indicator){var s=u.payload[0];o=u.payload.subarray(s+1)}else o=u.payload;for(var d=new bn(o),b=0;b<d.pmtTable.length;b++)this._add_pid_to_pmt(d.pmtTable[b].programNum,d.pmtTable[b].program_map_PID);return d}},{key:"_add_pid_to_pmt",value:function(u,o){var s=this.pat_table;(function(d){for(var b,_=0;_<s.length;_++)if((b=s[_]).id===d)return{idx:_,item:b};return null})(u)||s.push({id:u,pid:o})}},{key:"_parsePmt",value:function(u){var o;if(u.payload_unit_start_indicator){var s=u.payload[0];o=u.payload.subarray(s+1)}else o=u.payload;for(var d=new Ge(o),b=0;b<d.pes_table.length;b++)this._add_pes_stream(d.pes_table[b],d);return d}},{key:"_add_pes_stream",value:function(u,o){var s=this.pes_streams;(function(d){for(var b,_=0;_<s.length;_++)if((b=s[_]).id===d)return{idx:_,item:b};return null})(u.PID)||s.push({id:u.PID,stream_type:u.streamType,pcr_pid:o.PCR_PID,duration:0,sps:[],pps:[],pixelRatio:[1,1],timescale:9e4,width:0,height:0})}},{key:"_parseSdt",value:function(u){var o;if(u.payload_unit_start_indicator){var s=u.payload[0];o=u.payload.subarray(s+1)}else o=u.payload;var d=new Qe(o);return d.service_table.length>0&&(this.metadata.service_name=d.service_table[0].name,this.metadata.service_provider=d.service_table[0].provider_name),d}},{key:"currentProgramPID",get:function(){for(var u=[],o=0;o<this.pat_table.length;o++)u.push(this.pat_table[o].pid);return u.length>0?u[0]:-1}}]),y}(),Ht=function(y){function u(o,s){var d;return oe(this,u),(d=q(this,re(u).call(this))).context=o,d.PSI=s,d.videoTrack=null,d.audioTrack=null,d.captionTrack=null,d}return N(u,y),j(u,[{key:"push",value:function(o){for(var s,d=o,b=0;b<d.length;b++)switch((s=d[b]).type){case"video":this._complexVideo(s);break;case"audio":this._complexAudio(s);break;case"caption":this._complexCaption(s)}}},{key:"flush",value:function(){this.emit("done"),this._clearStream()}},{key:"reset",value:function(){this._clearStream()}},{key:"_clearStream",value:function(){this.videoTrack=null,this.audioTrack=null,this.captionTrack=null}},{key:"_complexVideo",value:function(o){var s=this.PSI.findTrack(o.trackId);s&&(s.type="video",s.gops=o,s.firstDTS=o[0][0].dts,s.firstPTS=o[0][0].pts,s.duration=Number.POSITIVE_INFINITY,this.videoTrack=s,this.emit("data",{videoTrack:this.videoTrack}))}},{key:"_complexAudio",value:function(o){var s=this.PSI.findTrack(o.trackId);s&&(s.type="audio",s.frames=o,s.firstPTS=s.firstDTS=o[0].dts,s.duration=Number.POSITIVE_INFINITY,this.audioTrack=s,this.emit("data",{audioTrack:this.audioTrack}))}},{key:"_complexCaption",value:function(){}}]),u}(rt),at={mac:!1,iphone:!1,android:!1},Re={version:!1,CHROME:!1,SAFARI:!1,FIREFOX:!1,IE11:!1,IE:!1,EDGE:!1,WECHAT:!1},me=navigator.userAgent.toLowerCase(),Ze=/(edge)\/([\w.]+)/.exec(me)||/(opr)[/]([\w.]+)/.exec(me)||/(chrome)[ /]([\w.]+)/.exec(me)||/(firefox)[ /]([\w.]+)/.exec(me)||/(iemobile)[/]([\w.]+)/.exec(me)||/(version)(applewebkit)[ /]([\w.]+).*(safari)[ /]([\w.]+)/.exec(me)||/(webkit)[ /]([\w.]+).*(version)[ /]([\w.]+).*(safari)[ /]([\w.]+)/.exec(me)||/(webkit)[ /]([\w.]+)/.exec(me)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(me)||/(msie) ([\w.]+)/.exec(me)||me.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(me)||me.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(me)||[],wn=/(ipad)/.exec(me)||/(ipod)/.exec(me)||/(windows phone)/.exec(me)||/(iphone)/.exec(me)||/(kindle)/.exec(me)||/(silk)/.exec(me)||/(android)/.exec(me)||/(win)/.exec(me)||/(mac)/.exec(me)||/(linux)/.exec(me)||/(cros)/.exec(me)||/(playbook)/.exec(me)||/(bb)/.exec(me)||/(blackberry)/.exec(me)||[],Ie={version:void 0},Ye={browser:Ze[5]||Ze[3]||Ze[1]||"",version:Ze[2]||Ze[4]||"0",versionNumber:Ze[4]||Ze[2]||"0",platform:wn[0]||""};if(Ye.browser){Ie[Ye.browser]=!0;var vt=Ye.versionNumber.split(".");Ie.version={major:parseInt(Ye.versionNumber,10),string:Ye.version},vt.length>1&&(Ie.version.minor=parseInt(vt[1],10)),vt.length>2&&(Ie.version.build=parseInt(vt[2],10))}Re.version=Ie.version,Re.CHROME=!!Ie.chrome,Re.SAFARI=!!Ie.safari&&!Re.CHROME,Re.FIREFOX=!!Ie.firefox,Re.IE11=/rv:11/.test(me),Re.IE=!!Ie.msie||Re.IE11,Re.EDGE=!!Ie.edge,Re.WECHAT=/(wechat)|(micromessenger)/.test(me),at.mac=!!Ye.platform.mac,at.iphone=!!Ye.platform.iphone,at.android=!!Ye.platform.android;var Ft=Re,Pn=at,jt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Wt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],_n=function(y){function u(){return oe(this,u),q(this,re(u).call(this))}return N(u,y),j(u,[{key:"push",value:function(o){for(var s,d,b,_,E,O=o.pts,X=o.dts,W=o.payload,J=0,ee=0;J+5<W.length;)if(W[J]===255&&(246&W[J+1])==240){if(d=2*(1&~W[J+1]),s=(3&W[J+3])<<11|W[J+4]<<3|(224&W[J+5])>>5,E=9e4*(_=1024*(1+(3&W[J+6])))/Wt[(60&W[J+2])>>>2],b=J+s,W.byteLength<b)return;var be={pts:O+ee*E,dts:X+ee*E,sampleCount:_,audioObjectType:1+(W[J+2]>>>6&3),channelCount:(1&W[J+2])<<2|(192&W[J+3])>>>6,sampleRate:Wt[(60&W[J+2])>>>2],samplingFrequencyIndex:(60&W[J+2])>>>2,sampleSize:16,data:W.subarray(J+7+d,b)};if(this.emit("frame",be),W.byteLength===b)return W=void 0,void this.emit("done");ee++,W=W.subarray(b)}else J++}}]),u}(M),ze=function(y){function u(o){var s;return oe(this,u),(s=q(this,re(u).call(this))).PSI=o,s.trackId=null,s.codec=new _n,s.codec.on("frame",function(d){s.frames.push(d),s.frames.byteLength+=d.data.byteLength,s.frames.trackId=s.trackId}),s._newFrames(),s}return N(u,y),j(u,[{key:"push",value:function(o){o.stream_type===15&&(this.trackId=o.pid,this.codec.push({dts:o.pes.DTS,pts:o.pes.PTS,payload:o.pes.data_byte}))}},{key:"flush",value:function(){if(this.frames.length>0){var o=this.frames.length,s=this.frames[0],d=this.frames[o-1],b=d.sampleRate*d.sampleCount/9e4;this.frames.firstDTS=s.dts,this.frames.firstPTS=s.pts,this.frames.duration=o===1?b:b+(d.pts-s.pts),this._updateTrackMeta(s),this.emit("data",this.frames),this.reset(),this.emit("done")}}},{key:"reset",value:function(){this.trackId=null,this._newFrames()}},{key:"_newFrames",value:function(){this.frames=[],this.frames.type="audio",this.frames.byteLength=0,this.frames.duration=0,this.frames.firstDTS=0,this.frames.firstPTS=0}},{key:"_updateTrackMeta",value:function(o){var s=this.PSI.findTrack(this.trackId),d=function(b,_,E){var O,X,W=b;if(!(_>jt.length-1))return Ft.FIREFOX?_>=6?(b=5,X=new Array(4),O=_-3):(b=2,X=new Array(2),O=_):Pn.android?(b=2,X=new Array(2),O=_):(b=5,X=new Array(4),_>=6?O=_-3:(E===1&&(b=2,X=new Array(2)),O=_)),X[0]=b<<3,X[0]|=(14&_)>>1,X[1]|=(1&_)<<7,X[1]|=E<<3,b===5&&(X[1]|=(14&O)>>1,X[2]=(1&O)<<7,X[2]|=8,X[3]=0),{config:X,sampleRate:jt[_],channelCount:E,codec:"mp4a.40."+b,realCodec:"mp4a.40."+W};Oe.error("invalid sampling index:".concat(_))}(o.audioObjectType,o.samplingFrequencyIndex,o.channelCount);s.config=d.config,s.sampleRate=d.sampleRate,s.inputTimeScale=s.inputTimeScale||s.timescale,s.timescale=d.sampleRate,s.channelCount=d.channelCount,s.codec=d.codec,s.realCodec=d.realCodec,s.isAAC=!0}}]),u}(rt);function Tt(y){for(var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=0,d="",b=u;b<u+o;b++)s=7-b%8,d+=y[Math.floor(b/8)]>>s&1;return parseInt(d,2)}function We(y){for(var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=[],s=8*y.byteLength,d=!1,b=0,_=0,E="",O=u;O<s;O++)if(b=7-O%8,_=y[Math.floor(O/8)]>>b&1,!d){if(_!==0){d=!0,u=O;break}o.push(0)}for(var X=o.length+1,W=u;W<u+X;W++)b=7-W%8,E+=_=y[Math.floor(W/8)]>>b&1;return{bitLength:o.length+X,value:parseInt(E,2)-1}}var ie={readUEV:We,readSEV:function(y){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=We(y,u),s=o.value,d=Math.pow(-1,s+1)*Math.ceil(s/2);return{bitLength:o.bitLength,value:d}},readBit:Tt,readByte:function(y){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Tt(y,u,8)}},U=0;function Vt(y,u){for(var o,s=8,d=8,b=0;b<u;b++)d!=0&&(o=ie.readUEV(y,U),U+=o.bitLength,d=(s+o.value+256)%256),s=y[b]}var yt,gt,Je=function(y){function u(o){var s;switch(oe(this,u),(s=q(this,re(u).call(this))).forbidden_zero_bit=o[0]>>7,s.ref_idc=o[0]>>5&3,s.unit_type=31&o[0],s.data=function(d){for(var b,_=d.byteLength,E=[],O=1,X=new Uint8Array(0);O<_-2;)d[O]===0&&d[O+1]===0&&d[O+2]===3?(E.push(O+2),O+=2):O++;if(E.length===0)return d;b=_-E.length;try{X=new Uint8Array(b)}catch(J){throw"epsb alloc mem error ".concat(b)}var W=0;for(O=0;O<b;W++,O++)W===E[0]&&(W++,E.shift()),X[O]=d[W];return X}(o.subarray(1)),s.rawData=o,s.unit_type){case 1:break;case 2:case 3:case 4:case 5:break;case 7:s.sps=function(d){U=0;var b,_,E,O,X,W,J,ee=d[0],be=d[1],Le=d[2],se=d.subarray(3),Xe=0,ke=[1,1],et=1,mt=0,ot=!0,Ve=ie.readUEV(se,U);if(U+=Ve.bitLength,ee==100||ee==110||ee==122||ee==244||ee==44||ee==83||ee==86||ee==118||ee==128){var $e=ie.readUEV(se,U);U+=$e.bitLength,$e.value==3&&(U+=1);var bt=ie.readUEV(se,U);U+=bt.bitLength;var Be=ie.readUEV(se,U);if(U+=Be.bitLength,U+=1,Xe=ie.readBit(se,U),U+=1,Xe)for(var ut=0;ut<($e.value!=3?8:12);ut++){var we=ie.readBit(se,U);U+=1,we&&Vt(se,ut<6?16:64)}}var qe=ie.readUEV(se,U);U+=qe.bitLength;var lt=ie.readUEV(se,U),kt=lt.value;if(U+=lt.bitLength,kt===0)b=ie.readUEV(se,U),U+=b.bitLength;else if(kt===1){U+=1,_=ie.readSEV(se,U),U+=_.bitLength,E=ie.readSEV(se,U),U+=E.bitLength,O=ie.readUEV(se,U),U+=O.bitLength;for(var Kt,Qt=0;Qt<O.value;Qt++)Kt=ie.readSEV(se,U),U+=Kt.bitLength}var Zt=ie.readUEV(se,U);U+=Zt.bitLength,U+=1;var Jt=ie.readUEV(se,U);U+=Jt.bitLength;var en=ie.readUEV(se,U);U+=en.bitLength;var At=ie.readBit(se,U);U+=1,At||(U+=1),U+=1;var Ln=ie.readBit(se,U);U+=1;var Dt=0,tn=0,ct=0,Te=0;if(Ln){var nn=ie.readUEV(se,U);U+=nn.bitLength,Dt=nn.value;var Rt=ie.readUEV(se,U);U+=Rt.bitLength,tn=Rt.value;var Ot=ie.readUEV(se,U);U+=Ot.bitLength,ct=Ot.value;var rn=ie.readUEV(se,U);U+=rn.bitLength,Te=rn.value}var an=ie.readBit(se,U);if(U+=1,an){var Sn=ie.readBit(se,U);if(U+=1,Sn){var Mt=ie.readByte(se,U);switch(U+=8,Mt){case 1:ke=[1,1];break;case 2:ke=[12,11];break;case 3:ke=[10,11];break;case 4:ke=[16,11];break;case 5:ke=[40,33];break;case 6:ke=[24,11];break;case 7:ke=[20,11];break;case 8:ke=[32,11];break;case 9:ke=[80,33];break;case 10:ke=[18,11];break;case 11:ke=[15,11];break;case 12:ke=[64,33];break;case 13:ke=[160,99];break;case 14:ke=[4,3];break;case 15:ke=[3,2];break;case 16:ke=[2,1];break;case 255:var on=ie.readByte(se,U);U+=8;var sn=ie.readByte(se,U);U+=8;var Cn=ie.readByte(se,U);U+=8;var un=ie.readByte(se,U);U+=8,ke=[on<<8|sn,Cn<<8|un]}ke&&(et=ke[0]/ke[1]),Mt===255&&(U+=16,U+=16)}var An=ie.readBit(se,U);U+=1,An&&(U+=1);var ln=ie.readBit(se,U);if(U+=1,ln){X=ie.readBit(se,U,3),U+=3,U+=1;var cn=ie.readBit(se,U);U+=1,cn&&(U+=24)}var hn=ie.readBit(se,U);if(U+=1,hn){var fn=ie.readUEV(se,U);U+=fn.bitLength;var Dn=ie.readUEV(se,U);U+=Dn.bitLength}var Rn=ie.readBit(se,U);U+=1,Rn&&(W=ie.readBit(se,U,32),U+=32,J=ie.readBit(se,U,32),U+=32,ot=!!ie.readBit(se,U),U+=1,mt=J/(2*W))}return{payload:se,profile_idc:ee,profile_compatibility:be,level_idc:Le,sps_id:Ve.value,log2_max_frame_num_minus4:lt.value,pic_order_cnt_type:kt,log2_max_pic_order_cnt_lsb_minus4:b?b.value:0,width:Math.ceil((16*(Jt.value+1)-2*Dt-2*tn)*et),height:(2-At)*(en.value+1)*16-2*ct-2*Te,pixelRatio:ke,video_format:X,fps:mt,fixedFPS:ot}}(s.data);break;case 8:s.pps=function(d){var b,_=0,E=d,O=[],X=0;_+=ie.readUEV(E,_).bitLength,_+=ie.readUEV(E,_).bitLength,_+=1,_+=1;var W=ie.readUEV(E,_);if(_+=W.bitLength,W.value>0){var J=ie.readUEV(E,_);_+=J.bitLength;var ee=0;switch(J.value){case 0:for(ee=0;ee<=J.value;ee++)_+=ie.readUEV(E,_).bitLength;break;case 2:for(ee=0;ee<=J.value;ee++)_+=ie.readUEV(E,_).bitLength,_+=ie.readUEV(E,_).bitLength;break;case 3:case 4:case 5:_+=1,_+=ie.readUEV(E,_).bitLength;break;case 6:_+=(b=ie.readUEV(E,_)).bitLength;var be=Math.ceil(Math.log2(W.value+1));for(X=0;X<=b.value;X++)O.push(ie.readBit(E,_,be)),_+=be}}return _+=ie.readUEV(E,_).bitLength,_+=ie.readUEV(E,_).bitLength,_+=1,_+=1,_+=ie.readSEV(E,_).bitLength,_+=ie.readSEV(E,_).bitLength,_+=ie.readSEV(E,_).bitLength,_+=1,_+=1,_+=1,{sliceGroupNum:W.value+1}}(s.data);break;case 6:s.sei=(s.data,{});break;case 9:s.primary_pic_type=s.data[0]>>5}return s}return N(u,y),u}(it),Et=function(y){function u(){var o;return oe(this,u),(o=q(this,re(u).call(this))).cachedBytes=null,o}return N(u,y),j(u,[{key:"push",value:function(o){var s,d=0,b=0,_=0,E=o.pts,O=o.dts,X=o.payload,W=o.naluSizeLength;if(this.cachedBytes){try{s=new Uint8Array(this.cachedBytes.byteLength+X.byteLength)}catch(lt){throw"h264 alloc mem error ".concat(this.cachedBytes.byteLength,"/").concat(X.byteLength)}s.set(this.cachedBytes),s.set(X,this.cachedBytes.byteLength)}else s=X;if(W){var J=0,ee=0,be=0;do{ee=0;for(var Le=0;Le<W;Le++)ee|=s[J+Le]<<8*(W-Le-1);(be=(J+=W)+ee)>s.length&&(be=s.length);var se=s.subarray(J,be),Xe=new Je(se);Xe.pts=E,Xe.dts=O,this.emit("nalu",Xe),J=be}while(J<s.length)}else{var ke=s.byteLength-1,et=0;do{if(s[ke]!==0)break;et++,ke--}while(ke>0);et>=3&&(s=s.subarray(0,ke+1));do{var mt=s[d]<<24|s[d+1]<<16|s[d+2]<<8|s[d+3],ot=s.length-d>=4?mt:-1,Ve=0,$e=d===s.length-1;if(ot>>8==1?Ve=3:ot===1&&(Ve=4),Ve===3||Ve===4||$e){var bt=b+_,Be=$e&&et>=3;if(d>b&&(!$e||Be)){var ut=s.subarray(bt,Be?d+1:d),we=new Je(ut);we.pts=E,we.dts=O,this.emit("nalu",we),b=d}$e&&(et<3?(this.cachedBytes=s.subarray(b),this.cachedBytes.pts=E,this.cachedBytes.dts=O,this.cachedBytes.startCodeLength=_):this.cachedBytes=null),d===b&&(_=Ve),d+=Ve||1}else d++}while(d<s.length)}if(this.cachedBytes){var qe=new Je(this.cachedBytes.subarray(this.cachedBytes.startCodeLength));qe.pts=this.cachedBytes.pts,qe.dts=this.cachedBytes.dts,this.emit("nalu",qe),this.cachedBytes=null}this.emit("done")}},{key:"reset",value:function(){this.cachedBytes=null}}]),u}(M),xn=function(y){function u(o){var s;return oe(this,u),(s=q(this,re(u).call(this))).PSI=o,s.trackId=null,s.currentFrame=[],s.codec=new Et,s._newGop(),s._newGops(),s.codec.on("nalu",function(d){if(d.unit_type===7){var b=s.PSI.findTrack(s.trackId),_=function(E){for(var O="avc1.",X=[E.profile_idc,E.profile_compatibility,E.level_idc],W=0;W<X.length;W++){var J=X[W].toString(16);J.length<2&&(J="0"+J),O+=J}return{codec:O}}(d.sps);b.codec=_.codec,b.width=d.sps.width,b.height=d.sps.height,b.profileIdc=d.sps.profile_idc,b.profileCompatibility=d.sps.profile_compatibility,b.levelIdc=d.sps.level_idc,b.pixelRatio=d.sps.pixelRatio,b.sps=[d.rawData]}else d.unit_type===8&&(s.PSI.findTrack(s.trackId).pps=[d.rawData]);s._grouping(d)}),s}return N(u,y),j(u,[{key:"push",value:function(o){var s=o.stream_type,d=o.pes,b=o.pid;if(s===27||s===36){this.trackId=b;var _={pts:d.PTS,dts:d.DTS,payload:d.data_byte};this.codec.push(_)}}},{key:"flush",value:function(){this.currentFrame.length>0&&((!this.currentFrame.duration||this.currentFrame.duration<=0)&&(this.currentFrame.duration=this.prevFrame.duration||0),this._pushFrameIntoGop(),this.currentFrame=[]),this.gop.length>0&&this._pushGopIntoGroup()}},{key:"reset",value:function(){this.codec.reset(),this.currentFrame=[],this._newGop(),this._newGops()}},{key:"_grouping",value:function(o){o.unit_type===9?(this.currentFrame.length>0&&(this.currentFrame.duration=o.dts-this.currentFrame.dts,this.gop.length>0&&this.currentFrame.keyframe&&(this.gop.trackId=this.trackId,this._pushGopIntoGroup()),this.currentFrame.keyframe||this.gop.length>0?this._pushFrameIntoGop():Oe.warn("h264 codec drop frame")),this.prevFrame=this.currentFrame,this.currentFrame=[],this.currentFrame.keyframe=!1,this.currentFrame.byteLength=0,this.currentFrame.naluCount=0,this.currentFrame.pts=o.pts,this.currentFrame.dts=o.dts):(o.unit_type===5&&(this.currentFrame.keyframe=!0),this.currentFrame.byteLength+=o.rawData.byteLength,this.currentFrame.naluCount++,this.currentFrame.push(o)),this.currentFrame.duration=o.dts-this.currentFrame.dts}},{key:"_newGop",value:function(){this.gop=[],this.gop.duration=0,this.gop.naluCount=0,this.gop.byteLength=0}},{key:"_pushFrameIntoGop",value:function(){this.gop.push(this.currentFrame),this.gop.duration+=this.currentFrame.duration,this.gop.byteLength+=this.currentFrame.byteLength,this.gop.naluCount+=this.currentFrame.naluCount}},{key:"_newGops",value:function(){this.gops=[],this.gops.type="video",this.gops.duration=0,this.gops.naluCount=0,this.gops.byteLength=0,this.gops.frameLength=0,this.gops.firstDTS=0}},{key:"_pushGopIntoGroup",value:function(){var o=this.gop[0];this.gops.trackId=this.trackId,this.gops.duration+=this.gop.duration,this.gops.byteLength+=this.gop.byteLength,this.gops.naluCount+=this.gop.naluCount,this.gops.frameLength+=this.gop.length,this.gops.firstDTS=o.dts,this.gops.firstPTS=o.pts,this.gops.push(this.gop),this.emit("data",this.gops),this._newGop(),this._newGops(),this.emit("done")}}]),u}(rt),Bn=function(y){function u(o,s){var d,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return oe(this,u),(d=q(this,re(u).call(this))).context=o,d.PSI=s,d.options=b,d.tracks=[],d.adtsStream=new ze(s),d.avcStream=new xn(s),d.streams=[d.adtsStream,d.avcStream],b.decodeCodec&&(d.avcStream.on("data",function(_){var E=b.config.stubTime;if(wt(E)){var O=(_.firstPTS+_.duration)/9e4;if(O<E)return void Oe.warn("drop avc gop, start/end/stubTime(".concat(_.firstPTS,"/").concat(O,"/").concat(E,")"))}d.tracks.push(_),d.emit("data",d.tracks),d.tracks=[],d.adtsStream.flush()}),d.adtsStream.on("data",function(_){var E=b.config.stubTime;if(wt(E)){var O=(_.firstPTS+_.duration)/9e4;if(O<E)return void Oe.warn("drop adts, start/end/stubTime(".concat(_.firstPTS,"/").concat(O,"/").concat(E,")"))}d.tracks.push(_),d.emit("data",d.tracks),d.tracks=[]})),d}return N(u,y),j(u,[{key:"push",value:function(o){var s=this.options,d=this.adtsStream,b=this.avcStream,_=o.stream_type;if(s.decodeCodec)switch(_){case 27:case 36:b.push(o);break;case 15:d.push(o);break;default:Oe.warn("ts elementary encounter unknown stream type ".concat(_))}else this.emit("data",o)}},{key:"flush",value:function(){for(var o=this.streams,s=this.tracks,d=0;d<this.streams.length;d++)o[d].flush();s.length>0&&this.emit("data",s),this.emit("done"),s.splice(0,s.length)}},{key:"reset",value:function(){this.tracks=[];for(var o=0;o<this.streams.length;o++)this.streams[o].reset();this.emit("reset")}}]),u}(rt),Lt=function(y){function u(o){var s;return oe(this,u),(s=q(this,re(u).call(this))).start_code_prefix=s.readUint16(o,0)<<8|o[2],s.stream_id=o[3],s.packet_length=s.readUint16(o,4),s.data_alignment_indicator=4&o[6],s.copyright=2&o[6],s.PTS_DTS_flags=o[7]>>6,s.ESCR_flag=32&o[7],s.ES_rate_flag=16&o[7],s.trick_mode_flag=8&o[7],s.additional_copy_info_flag=4&o[7],s.CRC_flag=2&o[7],s.extension_flag=1&o[7],s.header_data_length=o[8],s.PTS=0,(2&s.PTS_DTS_flags)==2&&(s.PTS=s.calcTimestamp_(o,9)),s.DTS=s.PTS,(1&s.PTS_DTS_flags)==1&&(s.DTS=s.calcTimestamp_(o,14)),s.data_byte=o.subarray(9+s.header_data_length),s}return N(u,y),j(u,[{key:"calcTimestamp_",value:function(o,s){return 536870912*(14&o[s])+(o[s+1]<<22)+(o[s+2]>>1<<15)+(o[s+3]<<7)+(o[s+4]>>1)}},{key:"valid",value:function(){var o=this.start_code_prefix;return o[0]===0&&o[1]===0&&o[2]===1}}]),u}(it),zt=function(y){function u(o,s){var d;return oe(this,u),(d=q(this,re(u).call(this))).context=o,d.PSI=s,d.PID=null,d.cache_buffer=new Pt,d}return N(u,y),j(u,[{key:"push",value:function(o){o.PID>255&&o.PID<8191&&(this.PSI.currentProgramPID==-1?this._pushPacket(o):this.PSI.currentProgramPID!==o.PID&&(o.payload_unit_start_indicator===1&&this._assembleOnePES(),this._pushPacket(o)))}},{key:"flush",value:function(){this._assembleOnePES(),this.emit("done")}},{key:"reset",value:function(){this._clearCached(),this.emit("reset")}},{key:"_clearCached",value:function(){this.PID=null,this.cache_buffer.clear()}},{key:"_pushPacket",value:function(o){var s=this.cache_buffer.empty;s&&o.payload_unit_start_indicator===0||(s&&(this.PID=o.PID),this.cache_buffer.append(o.payload))}},{key:"_assembleOnePES",value:function(){if(!this.cache_buffer.empty){var o;try{o=this.cache_buffer.toNewBytes()}catch(_){throw"pes alloc mem err ".concat(this.cache_buffer.byteLength)}var s=new Lt(o),d=this.PSI.findTrack(this.PID);if(d){var b={pid:d.id,stream_type:d.stream_type,pcr_pid:d.pcr_pid,pes:s};this.emit("data",b)}this._clearCached()}}}]),u}(rt),Xt=function(y){function u(o){var s;if(oe(this,u),(s=q(this,re(u).call(this))).sync_byte=o[0],s.transport_error_indicator=o[1]>>7,s.payload_unit_start_indicator=o[1]>>6&1,s.transport_priority=o[1]>>>5&1,s.PID=8191&s.readUint16(o,1),s.tsc=o[3]>>6,s.afc=o[3]>>4&3,s.continuity_counter=15&o[3],s.has_payload=1&s.afc,s.has_adaptation=2&s.afc,s.has_payload)if(s.has_adaptation){var d=o[4];s.payload=o.subarray(5+d)}else s.payload=o.subarray(4);return s}return N(u,y),j(u,[{key:"valid",value:function(){return this.sync_byte===71&&this.has_payload===1}}]),u}(it),Tn=function(y){function u(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return oe(this,u),(o=q(this,re(u).call(this,s))).psi_=new kn(o.ctx_),o.pesStream_=new zt(o.ctx_,o.psi_),o.elementaryStream_=new Bn(o.ctx_,o.psi_,s),o.complexStream_=new Ht(o.ctx_,o.psi_),o.pipe(o.pesStream_),o.pesStream_.pipe(o.elementaryStream_),o.elementaryStream_.pipe(o.complexStream_),T(re(u.prototype),"listenEndStream_",Y(o)).call(Y(o)),o}return N(u,y),j(u,[{key:"push",value:function(o,s){var d=s.done,b=this.options_,_=this.ctx_,E=this.cache_buffer_,O=this.psi_,X=T(re(u.prototype),"constraintPushData_",this).call(this,o),W=E.byteLength,J=null;for(b.config=s,Oe.log("hls demux received ".concat(X.byteLength," bytes, cache ").concat(W," bytes. ").concat(d?"chunk done":"")),E.append(X);E.byteLength>=188;){var ee=E.cut(188);if(ee){var be=new Xt(ee);if(!be.valid()){var Le="Encounter invalid ts packet, packet_length(".concat(ee.length,"), cache_length(").concat(this.cache_buffer_.byteLength,"), has_payload(").concat(be.has_payload,"), data(").concat(ee,")");Oe.error(Le),this.reset(),_.emit("error",mn.TS_SYNC_BYTE,Le,{startByte:J,endByte:J+ee.byteLength});break}O.parse(be),this.emit("data",be),J+=ee.byteLength}}E.empty&&d&&this.emit("done")}},{key:"reset",value:function(){this.cache_buffer_.clear(),this.emit("reset")}},{key:"endStream",get:function(){var o=this.elementaryStream_;return this.options_.decodeCodec&&(o=this.complexStream_),o}}]),u}(xt);(function(y){y[y.HEAD=0]="HEAD",y[y.BODY=1]="BODY"})(yt||(yt={})),function(y){y[y.SCRIPT_DATA=18]="SCRIPT_DATA",y[y.VIDEO=9]="VIDEO",y[y.AUDIO=8]="AUDIO"}(gt||(gt={}));var St,Ct;(function(y){y[y.AAC=10]="AAC"})(St||(St={})),function(y){y[y.MONO=0]="MONO",y[y.STEREO=1]="STEREO"}(Ct||(Ct={}));var Gt;(function(y){y[y.SEQUENCE_HEAD=0]="SEQUENCE_HEAD",y[y.AAC_RAW=1]="AAC_RAW"})(Gt||(Gt={}));var Yt;(function(y){y[y.SEQUENCE_HEAD=0]="SEQUENCE_HEAD",y[y.NALU=1]="NALU",y[y.SEQUENCE_END=2]="SEQUENCE_END"})(Yt||(Yt={}));var $t=new Et;$t.on("nalu",function(y){});var qt;(function(y){y[y.AVC=7]="AVC"})(qt||(qt={}));var En=function(){function y(u){C()(this,y),I()(this,"previousPes",null),I()(this,"maxAudioPTS",0),I()(this,"maxVideoPTS",0),u?(this.init(),this.dataArray=[],this.videoArray=[],this.audioArray=[],this.decode=u):console.error("class TsDemux need pass decode parmas")}return V()(y,[{key:"init",value:function(){var u=this;try{this.demuxer=new Tn({enableWorker:!1,debug:!1,onlyDemuxElementary:!0}),this.demuxer.on(P.DEMUX_DATA,function(o){o instanceof Array?(u.dataArray.push(o),u.demuxed(u.dataArray),u.dataArray=[]):u.dataArray.push(o)}),this.demuxer.on(P.DONE,function(o){var s={};u.demuxed(u.dataArray),u.dataArray=[],u.previousPes.partEnd=!0,u.previousPes.lastTS=u.isLast,u.isLast?(u.maxPTS=Math.min(u.maxAudioPTS,u.maxVideoPTS),s.audioEnd=!0,u.audioQueue(s),self.postMessage({type:"demuxedAAC",data:u.audioArray}),u.audioArray=[],self.postMessage({type:"maxPTS",data:{maxAudioPTS:u.maxAudioPTS,maxVideoPTS:u.maxVideoPTS}})):(self.postMessage({type:"demuxedAAC",data:u.audioArray}),u.audioArray=[]),u.decode.push(u.videoArray),u.videoArray=[],u.previousPes=null})}catch(o){console.error("init demuxer failed.")}}},{key:"push",value:function(u){this.demuxer.push(u,{done:!0})}},{key:"demuxed",value:function(u){var o=this;u.forEach(function(s){o.tsDemuxed(s)})}},{key:"tsDemuxed",value:function(u){var o=u.stream_type,s=u.pes||{};switch(o){case 36:this.videoQueue(s);break;case 3:case 15:case 17:s.PTS=Math.round(s.PTS*L.a*1e3),this.maxAudioPTS=Math.max(s.PTS,this.maxAudioPTS),this.audioQueue(s)}}},{key:"audioQueue",value:function(u){this.audioArray.push(u)}},{key:"videoQueue",value:function(u){this.previousPes=u,this.maxVideoPTS=Math.max(this.maxVideoPTS,u.PTS),this.videoArray.push(u)}},{key:"destroy",value:function(){this.demuxer.destroy()}}]),y}();self.decode=new K,self.demuxer=new En(self.decode),te.default=function(y){y.onmessage=function(u){var o=u.data,s=o.type,d=o.data,b=o.isLast;switch(s){case"startDemux":y.demuxer.isLast=b,y.demuxer.push(d);break;case"loadwasm":y.decode.loadWASM(u);break;case"flush":y.decode.flush()}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(F,te,m){F.exports=m(163)},function(F,te,m){F.exports=m(85).default}])})})(zr);const Xr=Ir(Hn);const Gr={class:"h265player",id:"video"},Yr=Hr({__name:"index",setup(It){return Fr(()=>{new Xr(document.querySelector("#video"),{sourceURL:"https://omc3i.codesandbox.io/ts/playlist.m3u8",libPath:`${window.location.origin}/js/h265-wasm/`,autoPlay:!1})}),(cr,F)=>(jr(),Wr("div",Gr))}});const qr=Vr(Yr,[["__scopeId","data-v-e6457bb0"]]);export{qr as default};

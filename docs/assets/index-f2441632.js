import{l as I,m as N,n as B,k as F,f as M,o as T,p as U,q as J,r as L,g as j,s as q,h as H}from"./vendor-bdc55dd3.js";import{d as O,a as u,k as A,l as Q,S as t,Q as a,m as s,a5 as v,M as W,ah as C,ai as S,e as z,P as G}from"./@vue-83231dd6.js";import{_ as k}from"./index-6be28e0b.js";const K=async o=>{try{await navigator.clipboard.writeText(o),I.success("Page URL copied to clipboard")}catch(d){console.error("Failed to copy: ",d)}},g=o=>(C("data-v-f5fdf386"),o=o(),S(),o),X={class:"card-header"},Y={class:"card-header__title"},Z=g(()=>s("h3",null,"用户1操作区",-1)),ee=g(()=>s("p",{class:"margin-top-10"},"点击create offer，生成SDP offer，把下面生成的offer复制给用户2",-1)),ae=g(()=>s("div",{class:"card-header"},[s("div",{class:"card-header__title"},[s("h3",null,"用户2操作区")]),s("p",{class:"margin-top-10"}," 将上方用户1生成的offer粘贴到下方，点击create answer生成SDP answer，然后将生成的答案复制给下方用户1 ")],-1)),te=g(()=>s("div",{class:"card-header"},[s("div",{class:"card-header__title"},[s("h3",null,"用户1操作区")]),s("p",{class:"margin-top-10"},"将用户2生成的SDP answer粘贴到下方，然后点击add answer")],-1)),oe=O({__name:"offer-form",props:{localOffer:null,remoteAnswer:null},emits:["createOffer","createAnswer","addAnswer"],setup(o,{emit:d}){const i=u(""),f=u(""),w=y=>{K(y)};return(y,e)=>{const p=F,m=N,h=B;return A(),Q(W,null,[t(h,{shadow:"always"},{header:a(()=>[s("div",X,[s("div",Y,[Z,t(p,{type:"primary",onClick:e[0]||(e[0]=l=>d("createOffer"))},{default:a(()=>[v("create offer")]),_:1})]),ee])]),default:a(()=>[t(m,{value:o.localOffer,disabled:"",placeholder:"点击上方create offer",class:"input-with-select"},{append:a(()=>[t(p,{onClick:e[1]||(e[1]=l=>w(o.localOffer)),disabled:!o.localOffer},{default:a(()=>[v("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(h,{shadow:"always",class:"margin-top-10"},{header:a(()=>[ae]),default:a(()=>[t(m,{placeholder:"请粘贴用户1 SDP offer",modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value=l),clearable:"",class:"input-with-select"},{append:a(()=>[t(p,{disabled:!i.value,onClick:e[2]||(e[2]=l=>d("createAnswer",i.value))},{default:a(()=>[v("create answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),t(m,{placeholder:"SDP answer",value:o.remoteAnswer,disabled:"",class:"margin-top-10"},{append:a(()=>[t(p,{onClick:e[4]||(e[4]=l=>w(o.remoteAnswer)),disabled:!o.remoteAnswer},{default:a(()=>[v("复制")]),_:1},8,["disabled"])]),_:1},8,["value"])]),_:1}),t(h,{shadow:"always",class:"margin-top-10"},{header:a(()=>[te]),default:a(()=>[t(m,{placeholder:"请粘贴用户1 SDP offer",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l),clearable:"",class:"input-with-select"},{append:a(()=>[t(p,{onClick:e[5]||(e[5]=l=>d("addAnswer",f.value)),disabled:!f.value},{default:a(()=>[v("add answer")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})],64)}}});const se=k(oe,[["__scopeId","data-v-f5fdf386"]]),D=o=>(C("data-v-3e2600ac"),o=o(),S(),o),le=D(()=>s("h2",{class:"p2p-subtitle margin-bottom-10"},"本地摄像头",-1)),ne=D(()=>s("h2",{class:"p2p-subtitle margin-bottom-10"},"用户2摄像头",-1)),re=O({__name:"index",setup(o){const d=u(),i=u(),f=u(""),w=u(""),y=u(""),e=new RTCPeerConnection,p=async()=>{const n=d.value,r=i.value,_=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});n.srcObject=_,_.getTracks().forEach(c=>{e.addTrack(c,_)}),e.ontrack=c=>{r.srcObject=c.streams[0]}},m=async()=>{const n=await e.createOffer();await e.setLocalDescription(n),e.onicecandidate=async r=>{r.candidate&&(w.value=JSON.stringify(e.localDescription))}},h=async n=>{if(!n)return;const r=JSON.parse(n);e.onicecandidate=async c=>{if(c.candidate){const b=JSON.stringify(e.localDescription);y.value=b}},await e.setRemoteDescription(r);const _=await e.createAnswer();await e.setLocalDescription(_)},l=async n=>{if(!n)return;const r=JSON.parse(n);e.currentRemoteDescription||e.setRemoteDescription(r)};return z(()=>{p()}),(n,r)=>{const _=M,c=T,b=U,E=J,V=L,x=j,P=q,R=H;return A(),G(R,null,{default:a(()=>[t(_,{class:"p2p-header"},{default:a(()=>[v("Webrtc-P2P通话")]),_:1}),t(x,null,{default:a(()=>[t(b,null,{default:a(()=>[t(c,{span:16},{default:a(()=>[t(b,null,{default:a(()=>[t(c,{span:12,class:"p2p-video"},{default:a(()=>[le,s("video",{class:"p2p-video__dom",ref_key:"localRef",ref:d,autoplay:"",playsinline:"",muted:""},null,512)]),_:1}),t(c,{span:12,class:"p2p-video"},{default:a(()=>[ne,s("video",{class:"p2p-video__dom",ref_key:"remoteRef",ref:i,autoplay:"",playsinline:""},null,512)]),_:1})]),_:1})]),_:1}),t(c,{span:8},{default:a(()=>[t(V,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=$=>f.value=$)},{default:a(()=>[t(E,{title:"本地操作区域-打开2个tab页",name:"1"},{default:a(()=>[t(se,{localOffer:w.value,remoteAnswer:y.value,onCreateOffer:m,onCreateAnswer:h,onAddAnswer:l},null,8,["localOffer","remoteAnswer"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(P)]),_:1})}}});const fe=k(re,[["__scopeId","data-v-3e2600ac"]]);export{fe as default};
